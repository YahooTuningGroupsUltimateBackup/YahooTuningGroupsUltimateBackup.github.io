<!DOCTYPE html>
            <html>
            <head>
            <meta charset="utf-8">
                <meta name="viewport"
            content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
                <meta http-equiv="x-ua-compatible" content="ie=edge">
                <title>Yahoo Tuning Groups Ultimate Backup tuning my micro.CAL program</title>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            </head>
            <body>
            </body>
            </html>
        <a href="/tuning">back to list</a><h1>my micro.CAL program</h1><h3><a id=2164 href="#2164">ðŸ”—</a>Joe Monzo &#x3C;joe_monzo@xxxxxxx.xxxx&#x3E;</h3><span>3/31/1999 11:45:04 PM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>***************************************<br/>    ***************************************<br/>    **                                   **<br/>    **      ATTENTION CAKEWALK USERS     **<br/>    **                                   **<br/>    ***************************************<br/>    ***************************************</p><p>Especially those (like me) who do step-time,<br/>one-note-at-a-time sequencing right on the computer.</p><p>----------------------------</p><p>Below is a working version 1.0 of my &quot;<a href="http://micro.CAL">micro.CAL</a>&quot;<br/>Cakewalk Application Language microtonal input<br/>program.</p><p>It allows the user to input, step-time, microtonal<br/>notes into a MIDI or Cakewalk file.</p><p>Right now I only have microtonal input capability for<br/>numerator and denominator of ratios.  I&apos;m working on<br/>prime-factor input, and also ETs. (actually ETs were<br/>already crudely implemented before I made it JI).</p><p>Also in the works is a better note-duration input<br/>interface, more like musical notation (1/4-notes,<br/>1/8-notes, tuplets, etc.)</p><p>The program takes your input of 12-Eq degree of tonic,<br/>start time, duration (in timebase ppq units), and numerator<br/>and denominator of ratio, and inserts a MIDI-note with<br/>the proper pitch-bend into your Cakewalk file.</p><p>It only does one note per run right now.</p><p>CAL uses only integer math and does not have logarithms,<br/>so I had to work around both of those limitations.</p><p>The integer math was easy - just multiply all the<br/>important numbers by 10^4 or 10^6, then divide back down<br/>at the end.  But actually, this was where the problem<br/>lay which stopped the program from running - it was<br/>&quot;seeing&quot; 10000 as an integer data-type and truncating<br/>the calculation.  It works fine now.</p><p>The lack of logarithms was a little more difficult,<br/>and I solved it by using Ellis&apos;s augmented bimodulus<br/>calculation as presented in his translation of Helmholtz,<br/>_On the Sensations of Tone_, p. 447.  It is accurate<br/>to within less than 2 cents.</p><p>Everything in the program between the &quot;do&quot; under<br/>START PROGRAM and the closing parenthesis as the end<br/>should be *indented*.  If you paste this into Cakewalk<br/>or a text editor and a word or line is not indented,<br/>an email program along the way has added a carriage<br/>return at the end of the preceeding line.  Delete this,<br/>so that the non-indented words end up at the end of the<br/>previous line where they belong.  Otherwise the program<br/>may not run.</p><p>CAL&apos;s syntax is like a combination of C and LISP:<br/>lots of parentheses.  Indenting helps keep track of them.</p><p>Anyone is welcome to add their own improvements, or<br/>implement mine, for that matter.  I&apos;ve left in many<br/>comments and also some commented-out code that works to<br/>some extent.  Feel free to finish it.  One important note -<br/>if you send *me* an improvement, make sure it will work<br/>on my machine - I&apos;m running Cakewalk 2.01 Pro for Windows<br/>and this is CAL version 21 (it&apos;s dinosaur software).<br/>If you include parts of the language that were added in<br/>a later version of CAL, it won&apos;t run for me.</p><p>There are four &quot;pause&quot; statements that have been<br/>commented out.  They are for debugging purposes and<br/>are clearly marked.  The double-semicolons may be removed<br/>if you would like CAL to furnish this information to you<br/>while you are improving the program.</p><p>Enjoy!</p><p>-monzo</p><p>;;===================================================<br/>;;  B E G I N N I N G   O F    P R O G R A M<br/>;;===================================================<br/>;;<br/>;; <a href="http://MICRO.CAL">MICRO.CAL</a>  v. 1.0 (c) 1999 by Joe Monzo<br/>;;<br/>;; 1999-3-25<br/>;;<br/>;; CAL routine to calculate pitch-bend from a ratio<br/>;;   and insert it, with a note, into a Cakewalk file<br/>;;<br/>;; The user may change the NOW time for the insertion.<br/>;;<br/>;; - still needs if-then for &quot;ET or JI?&quot; routines<br/>;; - still needs ratio calculation procedure for ETs<br/>;; - figure out how to indicate octaves with exp2<br/>;; - a loop is necessary, so whole phrases can be entered<br/>;;<br/>;;====================================================<br/>;; 1999-3-31 *** THIS VERSION WORKS  ****<br/>;;<br/>;;====================================================<br/>;; START PROGRAM</p><p>(do</p><p>   ;;================================<br/>   ;; DECLARATIONS</p><p>   ;;--------------------------------------------<br/>   ;; Declare constants</p><p>&#x9;(long bendcalc (/ (* 2 1000000) 8192))&#x9;;; 2 multiplied for int math<br/>&#x9;(dword bimodulus1 3477)<br/>&#x9;(dword multiplier 10000)<br/>&#x9;(dword bimodulus (* bimodulus1 multiplier))&#x9;;; Ellis&apos;s bimodulus 3477<br/>multiplied for int math<br/>&#x9;&#x9;<br/>   ;;--------------------------------------------<br/>   ;; Declare variables for user input</p><p>&#x9;(dword Time Now)     ;; these are all simply<br/>&#x9;(int ScaleSize 12)   ;; default initial values -<br/>&#x9;(int Degree 0)       ;; they can be changed<br/>&#x9;(int MaxDegree 11)   ;;<br/>&#x9;(int WhlAmt 0)       ;;<br/>&#x9;(int Duration 120)   ;;</p><p>&#x9;(word numerator 1)<br/>&#x9;(word denom 1)</p><p>&#x9;;; These variables will be used when<br/>&#x9;;; prime-factor notation is implemented<br/>&#x9;;;<br/>&#x9;;; (int exp2 0)<br/>&#x9;;; (int exp3 0)<br/>&#x9;;; (int exp5 0)<br/>&#x9;;; (int exp7 0)<br/>&#x9;;; (int exp11 0)<br/>&#x9;;; (int exp13 0)</p><p>   ;;--------------------------------------------<br/>   ;; declare variables for cents calculation<br/>&#x9;(word larger 0)<br/>&#x9;(word smaller 0)<br/>&#x9;(long cents 0)<br/>&#x9;(long centsadd 0)</p><p>   ;;--------------------------------------------<br/>   ;; declare variables for pitch-bend calculation</p><p>&#x9;(long semitones)<br/>&#x9;(long hisemitones)<br/>&#x9;(long closest12eq)<br/>&#x9;(long eqerror)<br/>&#x9;(long pitchbend)<br/>&#x9;(int midinote 60)<br/>&#x9;(int tonic 0)</p><p>   ;;========================<br/>   ;; INPUT&#x9;</p><p>   ;;--------------------------------------------<br/>   ;; User input<br/>&#x9;<br/>&#x9;;;---------------<br/>&#x9;;; timing info<br/>&#x9;<br/>&#x9;(getInt tonic &quot;Key or tonic (0=C, 1=Db, 2=D, 3=Eb, 4=E, 5=F, 6=F#, 7=G,<br/>8=Ab, 9=A, 10=Bb, 11=B) :&quot; 0 11)<br/>&#x9;(getTime Time &quot;Starting Time of note:&quot;)<br/>&#x9;(getInt Duration &quot;Duration (240 = half, 120 = quarter, 60 = 8th, 40 =<br/>triplet 8th, 30 = 16th, 20 = triplet 16th):&quot; 1 4800)</p><p>&#x9;;;----------------<br/>&#x9;;; ET or JI?<br/>&#x9;<br/>&#x9;;; THIS STILL NEEDS TO BE DONE for combined ET/JI version</p><p>&#x9;;;----------------<br/>&#x9;;; ET section now used only in ET-only version of program<br/>&#x9;;;<br/>&#x9;;;(getInt ScaleSize &quot;Number of EQ steps in scale:&quot; 5 72)<br/>&#x9;;;(= MaxDegree (- ScaleSize 1))</p><p>&#x9;;;(getInt Degree &quot;What is the Degree of this note:&quot; 0 MaxDegree)</p><p>&#x9;;;----------------<br/>&#x9;;; JI section - to be combined with ET in future version</p><p>&#x9;(getWord numerator &quot;Numerator of ratio:&quot; 1 65000)<br/>&#x9;(getWord denom &quot;Denominator of ratio:&quot; 1 65000)</p><p>    ;;========================<br/>    ;; CALCULATIONS</p><p>    ;;--------------------------------------------<br/>    ;; calculate cents, without logarithms<br/>    ;; using Ellis&apos;s augmented bimodulus method<br/>    ;; see Helmholtz, &quot;On the Sensations of Tone&quot;, p 447</p><p>    ;; THIS IS BASIC - I DON&apos;T KNOW HOW TO GOTO IN CAL:<br/>    ;;IF numerator = denom THEN cents = 0: GOTO ending:</p><p>    ;; First determine which is larger and which is smaller,<br/>    ;; the numerator or the denominator.</p><p>&#x9;(if (&gt; numerator denom)<br/>&#x9;&#x9;(do<br/>&#x9;&#x9;&#x9;(= larger numerator)<br/>&#x9;&#x9;&#x9;(= smaller denom)<br/>&#x9;&#x9;)<br/>        )</p><p>&#x9;(if (&lt; numerator denom)<br/>&#x9;&#x9;(do<br/>&#x9;&#x9;&#x9;(= smaller numerator)<br/>&#x9;&#x9;&#x9;(= larger denom)<br/>&#x9;&#x9;)<br/>        )</p><p>&#x9;(if (= numerator denom)<br/>&#x9;&#x9;(do<br/>&#x9;&#x9;&#x9;(= smaller numerator)<br/>&#x9;&#x9;&#x9;(= larger denom)<br/>&#x9;&#x9;)<br/>        )</p><p>&#x9;;;*******************************************************<br/>&#x9;;;FOR DEBUGGING - TO BE DELETED<br/>&#x9;;;(pause &quot;larger = &quot; larger &quot;smaller = &quot; smaller)<br/>&#x9;;;*******************************************************<br/>&#x9;</p><p>    ;;&gt; &quot;If the greater number of the ratio be more than twice<br/>    ;;&gt; the smaller, divide the greater (or else multiply the less)<br/>    ;;&gt; by 2 until the greater number is not more than twice<br/>    ;;&gt; the smaller.&quot; [to octave-reduce] [-Ellis]</p><p>&#x9;(while (&gt; larger (* 2 smaller) )</p><p>&#x9;&#x9;(if (== (% larger 2) 0)</p><p>&#x9;&#x9;&#x9;(do (= larger (/ larger 2) ) )<br/>&#x9;&#x9;&#x9;(do (= smaller (* smaller 2) ) )<br/>&#x9;&#x9;&#x9;<br/>&#x9;&#x9;)<br/>&#x9;)</p><p>    ;;&gt; &quot;If the reduced interval ratio be such that 3 times<br/>    ;;&gt; the larger number is greater than 4 times the smaller,<br/>    ;;&gt; but twice the larger number is less than 3 times the<br/>    ;;&gt; smaller number, then multiply the larger number by 3,<br/>    ;;&gt; and the smaller number by 4, for a new interval ratio,<br/>    ;;&gt; and add 498 cents to the result.&quot;  [-Ellis]</p><p>&#x9;(while (&gt; (* 3 larger) (* 4 smaller) )</p><p>&#x9;&#x9;(if (&lt; (* 2 larger) (* 3 smaller) )</p><p>&#x9;&#x9;&#x9;(do<br/>&#x9;&#x9;&#x9;&#x9;(= larger (* 3 larger) )<br/>&#x9;&#x9;&#x9;&#x9;(= smaller (* 4 smaller) )<br/>&#x9;&#x9;&#x9;&#x9;(= cents (* 498 multiplier) )<br/>&#x9;&#x9;&#x9;)</p><p>&#x9;&#x9;&#x9;(do<br/>&#x9;&#x9;&#x9;&#x9;(= larger (* 2 larger) )<br/>&#x9;&#x9;&#x9;&#x9;(= smaller (* 3 smaller) )<br/>&#x9;&#x9;&#x9;&#x9;(= cents (* 702 multiplier) )<br/>&#x9;&#x9;&#x9;)<br/>&#x9;&#x9;)<br/>&#x9;)</p><p>&#x9;;;*******************************************************<br/>&#x9;;;FOR DEBUGGING - TO BE DELETED<br/>&#x9;;;(pause &quot;cents = &quot; cents)<br/>&#x9;;;*******************************************************<br/>&#x9;</p><p>    ;;&gt; &quot;Multiply 3477 by the difference of the numbers of the<br/>    ;;&gt; reduced interval ratio, and divide the result by their<br/>    ;;&gt; sum to the nearest whole number, . . .&quot; [-Ellis]<br/>    ;;<br/>    ;; 3477 must be multiplied by 10^4 for integer math</p><p>&#x9;(do<br/>&#x9;&#x9;(= centsadd<br/>&#x9;&#x9;&#x9;(/<br/>&#x9;&#x9;&#x9;&#x9;(* (- larger smaller) bimodulus)<br/>&#x9;&#x9;&#x9;&#x9;(+ larger smaller)<br/>&#x9;&#x9;&#x9;)<br/>&#x9;&#x9;)<br/>&#x9;)</p><p>&#x9;;;*******************************************************<br/>&#x9;;;FOR DEBUGGING - TO BE DELETED<br/>&#x9;;;(pause &quot;larger = &quot; larger &quot;smaller = &quot; smaller &quot;centsadd = &quot;<br/>centsadd)<br/>&#x9;;;*******************************************************<br/>&#x9;</p><p>    ;;&gt; &quot;. . . and if the quotient is more than 450 add 1.&quot;  [-Ellis]</p><p>&#x9;(if (&gt; centsadd (* 450 multiplier) )<br/>&#x9;&#x9;(do<br/>&#x9;&#x9;&#x9;(= centsadd (+ centsadd (* 1 multiplier) ) )<br/>&#x9;&#x9;)<br/>&#x9;)</p><p>    ;;&gt; &quot;To the result add the numbers of cents from [above].&quot;  [-Ellis]</p><p>&#x9;(do<br/>&#x9;&#x9;(= cents (+ cents centsadd) )<br/>&#x9;)</p><p>   ;;--------------------------------------------<br/>   ;; calculate pitch-bend and midi-note<br/>   ;;<br/>   ;; all numbers multiplied by 10^6 for integer math<br/>   ;; MIDI-notes calculated from &quot;middle-C&quot;</p><p>&#x9;(do&#x9;<br/>&#x9;&#x9;(= semitones cents)<br/>&#x9;&#x9;(= hisemitones (+ cents 500000) )<br/>&#x9;&#x9;(= closest12eq (- hisemitones (% hisemitones 1000000) ) )<br/>&#x9;&#x9;(= eqerror (- semitones closest12eq) )<br/>&#x9;&#x9;(= pitchbend (/ eqerror bendcalc) )<br/>&#x9;&#x9;(= midinote (+ (+ 60 tonic) (/ closest12eq 1000000) ) )<br/>&#x9;)</p><p>&#x9;;;*******************************************************<br/>&#x9;;;FOR DEBUGGING - TO BE DELETED<br/>&#x9;;;(pause &quot;closest12eq = &quot; closest12eq &quot; eqerror + &quot; eqerror)<br/>&#x9;;;*******************************************************<br/>&#x9;<br/>   ;;========================<br/>   ;; OUTPUT</p><p>   ;;--------------------------------------------&#x9;<br/>   ;; Insert the new event into Cakewalk file</p><p>&#x9;(do<br/>&#x9;&#x9;(insert Time 1 WHEEL pitchbend)<br/>&#x9;&#x9;(insert (+ Time 1) 1 NOTE midinote 64 Duration)<br/>&#x9;)</p><p>)&#x9;</p><p>;; END PROGRAM<br/>;;=======================================================<br/>;;              E N D    O F   P R O G R A M<br/>;;=======================================================</p><p>Get Your Private, Free Email at <a href="http://www.hotmail.com">http://www.hotmail.com</a></p></div>
                <script>
                    let monospace = false
                    $('button').on('click', function () {
                      if (monospace) {
                        $('p').css("font-family", "")
                      } else {
                        $('p').css("font-family", "monospace")
                      }
                      monospace = !monospace
                    })
                </script>
            
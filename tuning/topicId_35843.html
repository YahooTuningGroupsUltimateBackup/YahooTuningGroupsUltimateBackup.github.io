<a href="/tuning">back to list</a><h1>RE: Pitch Detection</h1><h3>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>3/21/2002 4:19:37 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Paul,</p><p>As you&apos;ll see from my SD measurements, the SD seems to be<br/>about 0.5 cents, so occasional values 1 cent out are to<br/>be expected.</p><p>The method of taking account of all the partials and using<br/>those to adjust the frequency of the fundamental seems<br/>to achieve getting on for another order of magnitude<br/>in the precision.</p><p>BTW the earlier results using Jain&apos;s method may seem poor,<br/>but they are far better than FFT using just the nearest bin size.<br/>I used to need to do an FFT of, say, maybe a minute or so<br/>in order to get decent frequency measurements using the nearest<br/>bin size approach.</p><p>This is a good exercise for the new FFT features in<br/>FTS actually, and as you see, has lead to a new idea for<br/>improving the accuracy of the FFT frequency detection.</p><p>Thanks for the suggestion to try it :-).</p><p>Robert</p></div><h3>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>3/22/2002 10:02:09 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Fran&iuml;&iquest;&half;ois</p><p>&gt; &gt; Perhaps weighting them all evenly is a reasonable compromise between<br/>&gt; &gt; preferring the higher ones as the more exact measurements,<br/>&gt; &gt; and preferring<br/>&gt; &gt; the lowest ones as possibly more likely to be exact multiples of the<br/>&gt; &gt; pitch for real timbres.</p><p>&gt; That looks like an excellent idea!! I will probably try to use it on my<br/>&gt; natural voice analysis. Up to now, I made no such weighting, I made a manual<br/>&gt; confidence interval estimation based on the broadness of the peak, divide it<br/>&gt; by N (the harmonic number) ant take the &quot;most reliable&quot;. Perhaps the<br/>&gt; weighting method you propose may be of some help to increase the accuracy of<br/>&gt; my measurement.</p><p>That&apos;s an interesting idea. I may well adopt it too.</p><p>The approaches could be combined, e.g. weight<br/>the partials inversely by the width of the peak. One can measure that as<br/>the width at say, 20 Db quieter than the peak, or whatever.</p><p>I&apos;ll probably eventually add various weighting schemes, plus also an option<br/>to restrict to first n partials for user defined n.</p><p>With the mean value technique the broader peaks may also be more reliable than<br/>they were with the other peak interpolation methods, as it depends on as much<br/>of the peak as one wants to include.</p><p>- e.g sometimes if you look at the top of a broad peak you will find a<br/>series of small peaklets (to coin a word) or summits, and then the<br/>highest of those is often off-centre.</p><p>When one takes account of more of the population of the broad peak, then<br/>you find that the frequency detected may be between two of the small<br/>peaklets.</p><p>Another idea is that instead of taking the FFT values as the population,<br/>it may be better to take the log of the FFT values.</p><p>Another thing I will probably add in is to look for stretched or compressed<br/>partials. Idea is that one could measure how much the partial gets stretched<br/>by per octave and use that to divide the partials down to the same frequency<br/>as the fundamental.</p><p>I wonder how clear the idea of taking the mean of the population is?</p><p>The idea is that you think of the FFT values near a peak (e.g. down to<br/>10 percent of the height of the peak) as a population distribution.</p><p>You could think of each FFT value as a number of votes for that<br/>particular frequency. So to find the total, you multiply each frequency<br/>bin by the number of votes for that frequency. Add the results for<br/>all the bins. Then at the end, divide by the total number of votes to<br/>get the mean value.</p><p>I wonder if that is how we beat the pitch resolution limit<br/>- rather easier than peak interopolation.</p><p>Then, since we hear logarithmically in volume, and are pretty<br/>good at detecting pitch (and since it is the way that we hear pitch<br/>that is most interest to us anyway), I wonder if one might<br/>get better results by using the logarithm of the number of votes<br/>for each frequency bin instead.</p><p>Another thought, if one can&apos;t go down far enough because one has<br/>several close together peaks, then one should go down as far<br/>as the shallowest valley (to either side) and then use that<br/>as the minimum number of votes to take account of. Otherwise,<br/>the peak that is nearest to another one will get biased because<br/>the reading will include some of its values too.</p><p>In fact, probably one should stop a bit short of the valley, as it<br/>is often getting asymmetrical by that point.</p><p>Anyway I&apos;m sure there will be lots of subtleties to it eventually,<br/>but it seems to be on the right track somehow...</p><p>&gt; &gt; looks like you&apos;re nailing it now. note that this does not violate the<br/>&gt; &gt; classical uncertainty principle, since here it&apos;s *given* that the<br/>&gt; &gt; signal is to be interpreted as frequencies unchanging over time<br/>&gt; &gt; (while in many situations that wouldn&apos;t be the case), plus it&apos;s<br/>&gt; &gt; *given* that the partials are exactly harmonic (while in many<br/>&gt; &gt; situations *that* wouldn&apos;t be the case).<br/>&gt; &gt;<br/>&gt; &gt; congratulations on your achievement here!</p><p>&gt; I can only share Paul&apos;s enthousiasm for your excellent work on this.</p><p>Thanks to you both - it&apos;s appreciated.</p><p>Robert</p></div>
<a href="/tuning">back to list</a><h1>FTS developments (was: Improvisation on pitches from a recording of a song)</h1><h3>Yahya Abdal-Aziz &#x3C;yahya@melbpc.org.au&#x3E;</h3><span>4/17/2005 8:17:25 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Robert,</p><p>You replied to Carl onlist as below; I&apos;ve inserted<br/>my thoughts inline after the marker [YA].</p><p>Regards,<br/>Yahya</p><p>________________________________________________________________________<br/>   Date: Sat, 16 Apr 2005 11:11:53 +0100<br/>   From: &quot;Robert Walker&quot; &lt;robertwalker@...&gt;<br/>Subject: Re: Improvisation on pitches from a recording of a song</p><p>Hi Carl,</p><p>&gt; It never gives two simultaneous pitches, does it?  If it doesn&apos;t,<br/>&gt; the volume part of the triple is not needed in technique.</p><p>No, you are right, it&apos;s strictly monophonic. I do have an frequency<br/>spectrum type pitch tracking<br/>option as well which could find multiple pitches. That one isn&apos;t that good<br/>at finding the  starts and ends of notes. However what you can do with FTS<br/>is to edit the  results after it finds the notes - can other wave to midi<br/>programs do this?</p><p>[YA]  Yes, it is a feature of the Professional version of Widisoft.<br/>You can add, merge and suppress notes from analysis, tho I found the<br/>editing interface is not the most intuitive ...  The display is interesting<br/>too, in that it tries to show both pitch and amplitude (or loudness).<br/>Colours are user-definable, including those for bar-lines, which can be<br/>set automatically or by user tapping.</p><p>FTS shows blue vertical lines on the recording for all the note  boundaries<br/>it found - and you can click anywhere to add or remove them,<br/>then get it to refind all the frequencies for the notes again,<br/>using just the note boundaries you have marked out yourself.</p><p>If you do that then the frequency spectrum (FFT) version of the note finding<br/>is pretty good at getting the exact pitches also,<br/>because it uses peak interpolation methods to refine the estimate of<br/>the pitch at the peak. With various tweaks, it is now roughly comparable<br/>with the exact wave count in its precision though the exact wave count has a<br/>slight edge I think. Both it seems can find pitch accurate to a few<br/>hundredths of a cent<br/>or so for computer generated steady pitched notes of a second or so. The<br/>wave counting routinely manages better than a hundredth of a cent for a one<br/>second note if the waveform is suitable  - e.g. computer generated exact<br/>pitches of a regular waveform  shapge.</p><p>So if you want exact pitches, and aren&apos;t too bothered about the exact<br/>rhythm,<br/>it makes sesnse to analyse rich timbres in FTS using FFT with user<br/>interaction<br/>to find the note boundaries.</p><p>So one could do that, and then it could find more than one simultaneous<br/>pitch<br/>as it could then find all the partials for all those<br/>notes if one wanted them.</p><p>[YA]  I think it was Widisoft that had FFT as its &quot;basic&quot; algorithm,<br/>with a choice of three other &quot;advanced&quot; settings.  Are they doing<br/>anything you haven&apos;t tried?</p><p>At present it just tries to match a harmonic series<br/>to them to find the note, and that part isn&apos;t particularly configurable yet,<br/>you<br/>just have to try it as it is. But you can get it to show its analysis of a<br/>particular note - and later I can have a go at refining it somewhat. I<br/>could at any rate easily get it to output all the simultaneous pitches it<br/>finds<br/>as it goes along the recording to make data for anyone who wants to analyse<br/>them as they please.</p><p>But I don&apos;t have any plans at all to attempt polyphony, have made a design<br/>decision in advance just not to attempt that. The task seems a hard one<br/>- my hunch is that it is a sort of pattern recognition thing like<br/>understanding speech or recognising faces which are both things that<br/>are particularly hard to program. You need to reckon to devote all your<br/>programming<br/>and research time to the task for some yeaars if you expect to get anywhere<br/>at<br/>all in those areas I think.</p><p>[YA]  You could well be right!  8-o  I feel that perhaps neural net<br/>techniques may prove more effective in recognising timbres, which<br/>are of course subject to variations between individual instruments<br/>of the same name, and the same instrument in different acoustical<br/>settings.</p><p>The ear can hear a whole jumble of partials and instantly pick out that it<br/>consists of say a basson, oboe and violin playing a chord, while a program<br/>will have a much harder time of that because how would it tell which<br/>partials belong with which instruments? Maybe by fitting harmonic series for<br/>harmonic partials, but there may be some inharmonicity and the notes may be<br/>very well also be played in near to harmonic series type harmonies with each<br/>other. So, maybe really it would need a bank of templates of likely sounds<br/>which it could then try and match against the recording, so you could tell<br/>it that it uses such and such instruments, e.g. a guitar, or may have one in<br/>it, and it could then look for the characterstic fingerprints of that<br/>instrument.</p><p>[YA]  Using a sampled instrument to provide templates for matching<br/>might limit the effectiveness of recognition, because of the variations<br/>I mentioned earlier.  Do you have, for example, useful techniques for<br/>filtering out the effects of room acoustics?  I suspect that to do so<br/>might lose the baby with the bathwater!  Yet as you say, we humans<br/>are adept at discriminating different components of the whole<br/>soundscape, and assigning them to the correct instruments.  Part of<br/>this is doubtless due to familiarity - a learning effect - which is why<br/>I think neural nets may give a workable approach.  The best software<br/>along these lines for, eg human face recognition is very good indeed.<br/>Another part of our discriminatory ability is doubtless due to the<br/>fact that we hear stereophonically, through two ears which have<br/>systematic frequency response differences.  Using these two<br/>instruments together, differentially, enables us to get a 3D fix on<br/>the source of a particular partial.  I&apos;d bet even with all your<br/>experience of oboes, flutes, violas and violins, placed just SO in the<br/>orchestra, if you (a) close your eyes and (b) block your right ear,<br/>you&apos;d find it much harder to discern when any one of them<br/>contributed to a particular chord.  Unless a pitch recognition system<br/>uses stereo input data, can it hope to do as well as a trained human?</p><p>I think if one were ever to be presented with an orchestra consisting of<br/>entirely unfamiliar instruments, it&apos;s possible it might take one quite a<br/>while to learn to recognise them - if there were no familiar ones in the<br/>orchestra<br/>at all to get you started. Because the same partials could be divided up<br/>in different ways. E.g. a flute and oboe in unison could just as easily<br/>be a single  &quot;flute oboe&quot; instrument say. Or e.g. the sound of a<br/>car or a door creaking could be made up of a large number of instruments<br/>playing quiet sounds, and I&apos;m not sure, if one were unfamiliar with<br/>doors, that one would know that that complex sound was a single thing rather<br/>than the unison of several things played at once well synchronised.</p><p>So that&apos;s the situation that the computer program  faces, no instruments<br/>are familiar to it at all, unless you can figure out how to program it to<br/>recognise them. It could listen to a bell and hear ten tuning forks<br/>played at differnt pitches and volumes simultaneously.</p><p>[YA]  I reckon you should just let it learn for itself!</p><p>I think when it comes to it once these polyphonic programs are a bit<br/>more advanced they will surely have to build in experience of timbres<br/>of real instruments into them in order to follow polyphonic lines<br/>in complex musical textures. That&apos;s my hunch anyway.</p><p>Anyway it would be too much for me to attempt that as well, so yes, I&apos;m<br/>specialising on monophonic lines in FTS.</p><p>&gt; &gt;I don&apos;t do anything about weighting by the duration of the pitches,<br/>&gt; &gt;but one could do that too, especially since longer duration pitches<br/>&gt; &gt;are perhaps likely to be pitched more exactly, or heard with more<br/>&gt; &gt;exactness of pitch too, I mean a grace note of just a hundredth of<br/>&gt; &gt;a second for instance may not be so exactly pitched as a one second<br/>&gt; &gt;note for instance.</p><p>&gt; Indeed.  And in fact, portamenti, glissandi, and even legato note<br/>&gt; transitions should not contribute to the scale analysis in my view.</p><p>Rightio. Another thing to bear in mind as well is that the<br/>pitch detection is more accurate the longer the note is<br/>so very short grace notes may not be recognised quite so<br/>accurately by FTS. Depending that is on the quality of<br/>the recording, the better the quality then the more easily<br/>it will be able to detect shorter notes.</p><p>The bird song recordings I tested it with have all<br/>been 8-bit just because that&apos;s what I found on the<br/>web sites of bird song I tried, though I didn&apos;t look<br/>very far, surely there must be other ones with higher<br/>resolution recordings.</p><p>BTW I&apos;ve just done some more tweaking and fixed a bug,<br/>and as a result it is getting the robin song better<br/>now, see what you think:</p><p><a href="http://www.robertinventor.com/Robin_v2.mid">http://www.robertinventor.com/Robin_v2.mid</a></p><p>On Celeste for a bit of fun :-).</p><p>compare with the original 8 bit recording:<br/>on this page:<br/><a href="http://www.scricciolo.com/eurosongs/canti.htm">http://www.scricciolo.com/eurosongs/canti.htm</a></p><p>European Robin Erithacus rubecula:</p><p><a href="http://www.scricciolo.com/eurosongs/Erithacus.rubecula.wav">http://www.scricciolo.com/eurosongs/Erithacus.rubecula.wav</a></p><p>[YA]  Thanks for this link!</p><p>The one thing FTS can&apos;t do at the moment is to deal<br/>with repeated notes with very brief rests between them.<br/>It just runs them all together treating the rest between<br/>the notes as a bit of interference in the signal. The thing is that it<br/>pays no attention to the amplitude particularly, except to ignore<br/>all information below a threshold to deal with noise.</p><p>You notice that in the robin clip that the first high<br/>note is just a single pitch rather than a repeated<br/>one. It should repeat it twice, each time with a<br/>rapid decay with a fast tremulo effect, if one<br/>listens to the recording slowed down. The Celeste<br/>helps there by being a short duration note at least<br/>- it actually just plays a single long note through<br/>all that part of the song so if you play it on e.g.<br/>whistle it puts a lot of emphasis on the note<br/>and it changes the perceived shape of the melody line<br/>rather a lot at that point. So playing on<br/>Celeste helps to make the melody line sound<br/>more similar.</p><p>Actually it would be pretty easy to<br/>just extract a volume envelope for the entire<br/>recording and superimpose that on the pitches<br/>played - play the pitches all at the same volume<br/>on say a whistle, or oboe or whatever depending<br/>on the bird, and then use the midi expression controller<br/>on top of that to match the original volumes<br/>of the recording exactly.</p><p>I may give that a go, which will get the<br/>subtleties of tremulo at least though not<br/>vibrato or glissandi of course, and it will deal with repeated<br/>notes at least as far as the effect on the listener<br/>is concerened. They use vibrato of course,<br/>but not quite as much as one might expect,<br/>many of the songs use just pitch glissandi<br/>and then some tremulo now and again, or<br/>alteratively a little in the way of vibrato.<br/>The glissandi too aren&apos;t continuous, some<br/>notes are discrete steady pitches, and<br/>others are glissandi and if you listen to it<br/>slowly, it really doesn&apos;t run that many<br/>notes together either. It&apos;s quite a bit like<br/>human speech, with phrases with gaps between<br/>them.</p><p>It&apos;s clear that birds do have faster reactions than<br/>humans and live a bit faster, and I wonder if<br/>they could be so very much faster that they<br/>can actually hear all those details in their songs<br/>as they sing... It is interesting to speculate.<br/>I don&apos;t know how one could find out,.</p><p>[YA]  There&apos;s probably much that is essential,<br/>and some that is accidental and unimportant, in<br/>the songs and other vocalisations of any bird.<br/>Based on Darwinian evolutionary theory, we should<br/>expect each sound a bird makes to perform a useful<br/>function that enhances its chances of survival.<br/>Whether advertising for a mate with a characteristic<br/>song; crying to scare off a predator (as we saw a<br/>family of Australian magpies do yesterday to a<br/>Lesser Australian Raven); or keeping in contact<br/>with other members of family or flock; in each<br/>case, only some part of the sound is essential, as we<br/>can tell by the fact that variations of each are still<br/>effective. ...  So I think it&apos;s likely that birds CAN<br/>hear almost anything we can extract from their<br/>song with modern tools, at least down to a limit that<br/>is, say, proportionate to their &quot;rate of living&quot;.  Maybe<br/>a bird that lives seven years instead of seventy would<br/>discriminate events ten times shorter?  There&apos;s an<br/>approximate &quot;law&quot; that each bird and animal has a<br/>lifetime of about the same number of heartbeats.</p><p>Some birds have a lot of vibrato.<br/>The curlew has a continuous vibrato,<br/>and the meadow pipit also has a lot of vibrato<br/>of the ones I&apos;ve done.</p><p>BTW if you listen to the robin slowed down<br/>it sings quite a few very steady discrete pitches though it does<br/>have some legato / portamento type glissandi<br/>- but lots of very steady notes amongst it.</p><p>[YA]  I think that&apos;s where much new music is to be made -<br/>with melodies that move VERY much faster than we&apos;re<br/>used to.  The implications for harmonic music are, of<br/>course, that the harmonies ought to progress similarly<br/>faster; if not, it&apos;s possible to write quite beautiful music<br/>in a &quot;melismatic&quot; style, but that has the effect of separating<br/>melody from accompaniment in a figure-ground way; not<br/>always what one wants ...  Imagine a classical orchestra<br/>delivering homophonic music with harmonies changing<br/>20 times a second!  Maybe the players can&apos;t do it; maybe<br/>our PCs can ...</p><p>&gt; Plus, duration-based analysis could even tell us something about<br/>&gt; melodies played on keyboard instruments.  There, it isn&apos;t needed to<br/>&gt; distinguish note transitions from scale tones, but it could tell us<br/>&gt; something about central vs. passing/auxillary tones -- even<br/>&gt; &quot;diatonic&quot; melodies rarely use all 7 notes equally.</p><p>&gt; &gt;So maybe one could take that into account. I could add an option to<br/>&gt; &gt;FTS to print out all the pitches found as pitch / volume / duration<br/>&gt; &gt;triples for anyone to analyse as they please using their own software<br/>&gt; &gt;too.</p><p>&gt; That would be great!</p><p>Done! I&apos;ve done it so it saves them as a comma separated values<br/>file so it shows up in database programs, and should be easy for<br/>a program to read.</p><p>[YA]  Wow!  A responsive software supplier!  :-)</p><p>&gt; &gt;Well it is visible in the interface but as three rows of<br/>&gt; &gt;numbers - you could just use those too copy / paste and use them<br/>&gt; &gt;as input to ones program.</p><p>&gt; It does this now?  What&apos;s the download url?</p><p>I&apos;m just getting it ready now with the new changes and<br/>will upload it and let you know when it is ready.</p><p>Done - I&apos;ve just send the url to you privately.</p><p>Note to everyone else:</p><p>This update isn&apos;t ready for release quite yet.<br/>it will be quite soon. Meanwhile<br/>if you are very keen just ask and you can try<br/>it out and see what you make of the feature.<br/>However I like to know who is testing it out<br/>at this stage.</p><p>Iit is definitely in a state  of flux, this particular<br/>feature at least, and may possibly change, may not work in quite<br/>the same way when it comes to the release as it does<br/>right now. You may spend some time tweaking the<br/>settings to get it to work well with some particular<br/>isntrument then with the next upload everything gets<br/>chanaged and you have to start again, for instance.</p><p>But if you are keen to give it a go anyway let me know.<br/>BTW it does install as a separate program so you<br/>don&apos;t need to worry about it interfering with your<br/>installation of FTS 2.4 if you have that already.<br/>I plan to keep it like that for the release because<br/>there has been quite a change in some sections and<br/>some users may well want to run both programs<br/>concurrently until they get used to 3.0.<br/>Hopefully they will feel it has improved and<br/>it is easier to find ones way around it<br/>though with even more features there<br/>is yet more to distract one on ones searh to<br/>find out how to do some particular thing<br/>:-).</p><p>Robert</p><p>[YA]  Robert, doubtless at some time in the near<br/>future I would like to try out your innovations.<br/>But I think I&apos;d better wait a little for the dust<br/>to settle ... :-)</p><p>________________________________________________________________________</p><p>--<br/>No virus found in this outgoing message.<br/>Checked by AVG Anti-Virus.<br/>Version: 7.0.308 / Virus Database: 266.9.15 - Release Date: 16/4/05</p></div>
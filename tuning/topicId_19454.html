<a href="/tuning">back to list</a><h1>Quantitative Gesualdo</h1><h3><a id=19454 href="#19454">ðŸ”—</a>graham@microtonal.co.uk</h3><span>2/26/2001 1:49:00 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>To further my investigations into Gesualdo&apos;s use of accidentals, I&apos;ve<br/>written a Python script to do the conversion from 12 pitch classes to note<br/>names.  It uses the following rules:</p><p>1) Gamut from Gb to B#<br/>2) For each chord, choose the version with the smallest span on the spiral<br/>of fifths.<br/>3) Where more than one equally good chord lies within the gamut, choose<br/>the one which has the smallest average interval on the spiral of fifths<br/>between it and the previous chord.<br/>4) Seed with a D for rule 3.</p><p>These are rough equivalents of the rules I gave before, when I forgot<br/>about the last one.  They&apos;re expressed differently to be easier to<br/>program.</p><p>Gesualdo used a gamut of Cb to B#.  I had to leave out the Cb to get the<br/>cadence of Merce grido piangendo to work.  This is a fudge.  The Bb chord<br/>would more logically be an A#, but that Cx lies outside the gamut.  The B<br/>chord that follows would then prefer to be a Cb after the B.  Probably<br/>chords that would prefer to be outside the gamut would have to be given<br/>special treatment, but there&apos;s only this one example so far.</p><p>About the ending of Merce grido piangendo.  The words are &quot;Io moro, io<br/>moro&quot;.  Of the 11 &quot;moro&quot;s, 5 are a chromatic semitone and 3 a minor third.<br/> There&apos;s only one diatonic semitone, D#-E in the bass, where  &quot;io mo-&quot; is<br/>a chromatic semitone.  There are also a couple of whole tone &quot;moro&quot;s,<br/>where &quot;io...ro&quot; is a chromatic semitone.  So I think Gesualdo may have<br/>been deliberately aiming for chromatic semitones here.  There are also a<br/>couple on &quot;mora&quot; in the comma pump.  And a couple more on &quot;morte&quot; in an<br/>interesting passage from another piece (although he also uses a lot of<br/>diatonic semitones there, including the only run of two diatonic semitones<br/>I&apos;ve seen so far).  There seems to be a pattern...</p><p>There&apos;s no need to tell the program about 5-limit harmony: the spiral of<br/>fifths is enough.</p><p>Rule 3 barely works.  The last chord in the Merce grido piangendo diesis<br/>pump was originally tuned wrong when I had it as G#-B#-D# after E-G-B.<br/>Changing it to G B E B then G# D# G# B# fixed this because the minor third<br/>G#-B dominated the wolf G-B#.  I hadn&apos;t noticed that wolf before.</p><p>I had much less trouble with Margo&apos;s examples.  So if Paul thinks he has<br/>one that breaks my rules, I suggest he supply it.  Anything with a Cb or<br/>an augmented sixth would break the current rules.  I can supply the Python<br/>code on request, but won&apos;t here so it doesn&apos;t fill everybody&apos;s mailboxes.</p><p>Note that the same algorithm could be used to tune MIDI files into quarter<br/>comma meantone.  It might work better if it could look forwards as well as<br/>backwards, and maybe an existing at-leisure algorithm could be hacked to<br/>do that.</p><p>                 Graham</p></div><h3><a id=19460 href="#19460">ðŸ”—</a>Dave Keenan &#x3C;D.KEENAN@UQ.NET.AU&#x3E;</h3><span>2/26/2001 4:41:52 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In tuning@y..., graham@m... wrote:<br/>&gt; To further my investigations into Gesualdo&apos;s use of accidentals,<br/>I&apos;ve<br/>&gt; written a Python script to do the conversion from 12 pitch classes<br/>to note<br/>&gt; names.  It uses the following rules:<br/>&gt;<br/>&gt; 1) Gamut from Gb to B#<br/>&gt; 2) For each chord, choose the version with the smallest span on the<br/>spiral<br/>&gt; of fifths.<br/>&gt; 3) Where more than one equally good chord lies within the gamut,<br/>choose<br/>&gt; the one which has the smallest average interval on the spiral of<br/>fifths<br/>&gt; between it and the previous chord.<br/>&gt; 4) Seed with a D for rule 3.</p><p>My adaptive meantone algorithm differs in several ways.</p><p>1. It doesn&apos;t limit the gamut in advance. But it takes Eb to G# as the<br/>seed and then shifts its choice of 12 notes up and down the chain<br/>according to certain rules. It assumes the 12 remain contiguous on<br/>the chain (no gaps). At the end of the piece you could of course look<br/>back and see what the gamut was. It is quite possible that the actual<br/>gamut did not span more than 12 notes, although the algorithm&apos;s choice<br/>of 12 had shifted back and forth several times.</p><p>2. We only compare chord spans with the current choice of 12 and the<br/>two either side. We reject any that result in a chromatic semitone (or<br/>inversion or octave extension thereof). I refer to the presence of a<br/>simultaneous chromatic semitone in the code as the &quot;overloading&quot; of a<br/>nominal.</p><p>So we try to eliminate chromatic semitones, and the only way they can<br/>get thru is if their elimination would require shifting our choice of<br/>12 by more than 2 fifths up or down. Of course this maximum key-shift<br/>is a parameter that can easily be changed.</p><p>3. When equally good (small span, no overloads) chords are available<br/>within a keyshift of +-2 then those that require the smallest shift<br/>are favoured, and for shifts of the same amount, a shift up (by a<br/>fifth) is favoured over a shift down.</p><p>4. The _state_ of the algorithm may dependent on more than just the<br/>previous chord.</p><p>To a first approximation the state is what diatonic key we are in. But<br/>it is more general than merely major or minor (melodic or harmonic or<br/>sharp IV). What it records as is the last modifier (natural, sharp,<br/>flat, double-sharp etc) that it applied to each of the 7 nominals.<br/>These will not necessarily be a contiguous 7 notes on the chain of<br/>fifths, but they will be within a contiguous chain of 12.</p><p>So in a sense it assumes that at any point in time the composer has<br/>some heptatonic scale in mind. The consequences of it really being<br/>_less_ than heptatonic (e.g. pentatonic) are insignificant. The<br/>consequences of it really being _more_ than heptatonic are at least a<br/>graceful degradation the more notes you add. Of course totally<br/>chromatic 12 note pieces will result in total confusion and<br/>ridiculous excursions on the chain of fifths.</p><p>...<br/>&gt; There&apos;s no need to tell the program about 5-limit harmony: the<br/>spiral of<br/>&gt; fifths is enough.</p><p>I decided this too.</p><p>...<br/>&gt; Note that the same algorithm could be used to tune MIDI files into<br/>quarter<br/>&gt; comma meantone.  It might work better if it could look forwards as<br/>well as<br/>&gt; backwards, and maybe an existing at-leisure algorithm could be<br/>hacked to<br/>&gt; do that.</p><p>Mine&apos;s not at-leisure, but you might be interested to try it.</p><p>It&apos;s written in C at<br/><a href="http://uq.net.au/~zzdkeena/Music/Sweetener.cp.txt">http://uq.net.au/~zzdkeena/Music/Sweetener.cp.txt</a></p><p>The routine of interest is called &quot;AdaptForChord&quot;.</p><p>It will help to know that wherever the word &quot;fifth&quot; occurs in a<br/>variable or function name, it stands for &quot;position of a note on the<br/>chain of fifths relative to D=0&quot;.</p><p>Regards,<br/>-- Dave Keenan</p></div><h3><a id=19598 href="#19598">ðŸ”—</a>Graham Breed &#x3C;graham@microtonal.co.uk&#x3E;</h3><span>3/1/2001 6:09:40 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Dave Keenan wrote:</p><p>&gt; My adaptive meantone algorithm differs in several ways.<br/>&gt;<br/>&gt; 1. It doesn&apos;t limit the gamut in advance. But it takes Eb to G# as<br/>the<br/>&gt; seed and then shifts its choice of 12 notes up and down the chain<br/>&gt; according to certain rules. It assumes the 12 remain contiguous on<br/>&gt; the chain (no gaps). At the end of the piece you could of course<br/>look<br/>&gt; back and see what the gamut was. It is quite possible that the<br/>actual<br/>&gt; gamut did not span more than 12 notes, although the algorithm&apos;s<br/>choice<br/>&gt; of 12 had shifted back and forth several times.</p><p>I need to limit the gamut to give a Bb chord at the start of bar 32 or<br/>Merce grido piangendo.  And also, once that&apos;s tuned to Bb, for the<br/>next chord to be a B.</p><p>A more sophisticated algorithm may be able to overcome this fudge.  I<br/>note that between the Bb an B, the second highest voice moves from D<br/>to B.  So if you constrain chords such that each part moves by direct<br/>intervals no more complex than an chromatic semitone, that should fix<br/>it.  I haven&apos;t done this as my program doesn&apos;t know about parts, and<br/>would be more complex if it did.</p><p>In MIDI terms, a part would be a track in the file or a channel in the<br/>live input.</p><p>You also have to know about rests.  The middle voice moves by a<br/>augmented second in bar 28 of Merce grido piangendo, but rests for a<br/>semibreve in between.</p><p>The F#m-Bb progression might work if the cadence from bar 30 were<br/>constrained to begin with G and and with E.  That would require some<br/>notion of key center, and the ability to work backwards.</p><p>&gt; 2. We only compare chord spans with the current choice of 12 and the<br/>&gt; two either side. We reject any that result in a chromatic semitone<br/>(or<br/>&gt; inversion or octave extension thereof). I refer to the presence of a<br/>&gt; simultaneous chromatic semitone in the code as the &quot;overloading&quot; of<br/>a<br/>&gt; nominal.</p><p>Minimizing the span on the spiral of fifths would also tend to avoid<br/>chromatic semitones.</p><p>&gt; 3. When equally good (small span, no overloads) chords are available<br/>&gt; within a keyshift of +-2 then those that require the smallest shift<br/>&gt; are favoured, and for shifts of the same amount, a shift up (by a<br/>&gt; fifth) is favoured over a shift down.</p><p>This is relative to the &quot;state&quot; below?</p><p>&gt; So in a sense it assumes that at any point in time the composer has<br/>&gt; some heptatonic scale in mind. The consequences of it really being<br/>&gt; _less_ than heptatonic (e.g. pentatonic) are insignificant. The<br/>&gt; consequences of it really being _more_ than heptatonic are at least<br/>a<br/>&gt; graceful degradation the more notes you add. Of course totally<br/>&gt; chromatic 12 note pieces will result in total confusion and<br/>&gt; ridiculous excursions on the chain of fifths.</p><p>As Gesualdo does use enharmonic equivalents fairly close together, I<br/>was assuming this kind of thing wouldn&apos;t work.  Indeed, I&apos;m not sure<br/>if those diesis pumps would work with your method.  The music is<br/>chromatic, but not arbitrarily so.  Otherwise, a neat meantone<br/>solution may not exist.</p><p>Okay, take G-Am7-Em-G7-Em-G#.  There&apos;s no C in that progression, so<br/>what&apos;s to stop the G# being written G#-C-D#?  It wouldn&apos;t lead to a<br/>chromatic semitone anywhere.</p><p>My rules are sort of what I&apos;d expect for 5-limit meantone, but<br/>optmised to get Gesualdo to work.  The simpest method, especially for<br/>real-time operation, would be to remember the key center as a weighted<br/>average.  For each new note, take the spot on the spiral of fifths<br/>nearest to that center, and adjust the average to take account of the<br/>new note.  This wouldn&apos;t work for Gesualdo, as you would get different<br/>results depending on which notes were played first in a chord.</p><p>Adding the 7-ness does seem to complicate the algorithm.  As you&apos;re<br/>working with MIDI data, you shouldn&apos;t need to worry about note names<br/>at all.</p><p>&gt; &gt; Note that the same algorithm could be used to tune MIDI files into<br/>&gt; quarter<br/>&gt; &gt; comma meantone.  It might work better if it could look forwards as<br/>&gt; well as<br/>&gt; &gt; backwards, and maybe an existing at-leisure algorithm could be<br/>&gt; hacked to<br/>&gt; &gt; do that.<br/>&gt;<br/>&gt; Mine&apos;s not at-leisure, but you might be interested to try it.<br/>&gt;<br/>&gt; It&apos;s written in C at<br/>&gt; <a href="http://uq.net.au/~zzdkeena/Music/Sweetener.cp.txt">http://uq.net.au/~zzdkeena/Music/Sweetener.cp.txt</a></p><p>It looks like it could be hacked to work with UNIX MIDI, but still<br/>needs a specific synthesizer to receive the pitch bends.  I might be<br/>able to write the same kind of thing from scratch, but I&apos;ll see how<br/>you&apos;re collating MIDI data into chord.</p><p>I&apos;ve placed my code at &lt;<a href="http://www.microtonal.co.uk/gesualdo.zip">http://www.microtonal.co.uk/gesualdo.zip</a>&gt;.<br/>It&apos;s shorter, but then it doesn&apos;t have to do any MIDIness.</p><p>&gt; The routine of interest is called &quot;AdaptForChord&quot;.<br/>&gt;<br/>&gt; It will help to know that wherever the word &quot;fifth&quot; occurs in a<br/>&gt; variable or function name, it stands for &quot;position of a note on the<br/>&gt; chain of fifths relative to D=0&quot;.</p><p>That&apos;s the same measure I&apos;m using, which should make the methods<br/>comparable.  I&apos;ll see if I can plug your algorithm into my script and<br/>test it on the Gesualdo examples.</p><p>                    Graham</p></div><h3><a id=19622 href="#19622">ðŸ”—</a>Dave Keenan &#x3C;D.KEENAN@UQ.NET.AU&#x3E;</h3><span>3/1/2001 6:13:24 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In tuning@y..., &quot;Graham Breed&quot; &lt;graham@m...&gt; wrote:<br/>&gt; I need to limit the gamut to give a Bb chord at the start of bar 32<br/>or<br/>&gt; Merce grido piangendo.  And also, once that&apos;s tuned to Bb, for the<br/>&gt; next chord to be a B.</p><p>I should point out that I haven&apos;t looked at any Gesualdo piece and<br/>don&apos;t really have time to start. But if you want to feed me some<br/>tricky chord sequences I&apos;ll see if I can explain how my algorithm<br/>would handle them. That is, if you don&apos;t manage to insert my algorithm<br/>into your existing framework and let it speak for itself.</p><p>My algorithm has had very little testing.</p><p>&gt; In MIDI terms, a part would be a track in the file or a channel in<br/>the<br/>&gt; live input.</p><p>My code currently assumes it&apos;s getting live data from a keyboard on a<br/>single channel.</p><p>&gt; You also have to know about rests.</p><p>My intention was to detect short periods of no activity and if the key<br/>centre (middle-fifth, e.g D in C major) is more than 7 fifths away<br/>from D, to pull it back by 12 (an enharmonic whatsit) so it&apos;s less<br/>than 5 away.</p><p>&gt; Minimizing the span on the spiral of fifths would also tend to avoid<br/>&gt; chromatic semitones.</p><p>Sure. But I think sometimes it doesn&apos;t, and I am willing to _increase_<br/>the span of a chord if I have to, to get rid of chromatic semitones.</p><p>&gt; &gt; 3. When equally good (small span, no overloads) chords are<br/>available<br/>&gt; &gt; within a keyshift of +-2 then those that require the smallest<br/>shift<br/>&gt; &gt; are favoured, and for shifts of the same amount, a shift up (by a<br/>&gt; &gt; fifth) is favoured over a shift down.<br/>&gt;<br/>&gt; This is relative to the &quot;state&quot; below?</p><p>Yes. In my algorithm, the most important summary of the &quot;state&quot; (the<br/>imagined heptatonic scale) is the &quot;midfifth&quot;, which is not the mean of<br/>the seven, but approximately the median (rounding 0.5&apos;s down), with<br/>some messy exceptions (See the start of &quot;AdaptForFifth&quot;).</p><p>&gt; As Gesualdo does use enharmonic equivalents fairly close together, I<br/>&gt; was assuming this kind of thing wouldn&apos;t work.</p><p>Maybe not. Gimme a chord/note sequence.</p><p>&gt;  Indeed, I&apos;m not sure<br/>&gt; if those diesis pumps would work with your method.</p><p>Ah, no. Diesis pumps will send if off the end every time, unless it<br/>can use a rest to fall back towards the D centre. Why would one want<br/>to tune music with diesis pumps in meantone?</p><p>My algorithm doesn&apos;t do 31-tET wraparound since it assumes the<br/>tone-generator&apos;s tuning table can&apos;t handle more than +-64 cents. But<br/>it could be modified to do so. Does Gesualdo require it?</p><p>&gt;  The music is<br/>&gt; chromatic, but not arbitrarily so.  Otherwise, a neat meantone<br/>&gt; solution may not exist.</p><p>Indeed.</p><p>&gt; Okay, take G-Am7-Em-G7-Em-G#.  There&apos;s no C in that progression,</p><p>Err. What about in the Am7? Are you saying he spells its third as B#,<br/>or does he omit the third? Or did you mean to say there&apos;s no C#?</p><p>My algorithm would give the same result whether you have a C in there<br/>or not, because there is an F which never gets replaced (in the<br/>heptatonic &quot;state&quot;) by an F#, and F is lower on the chain of fifths<br/>than C.</p><p>It will also give the same result whether there&apos;s a C# in there or<br/>not.</p><p>&gt; so<br/>&gt; what&apos;s to stop the G# being written G#-C-D#?  It wouldn&apos;t lead to a<br/>&gt; chromatic semitone anywhere.</p><p>When we come to the G# chord, the lowest &quot;fifth&quot; in the &quot;state&quot; is F<br/>and the highest is G#, so midfifth is E and our choice of 12 is F to<br/>A#. We only need to move our centre up by 2 positions to encompass the<br/>B# and so the algorithm _does_ discover that it can reduce the span of<br/>the chord by spelling it G#-B#-D#.</p><p>It doesn&apos;t care that there&apos;s a chromatic semitone between the B in the<br/>previous chord and the B#.</p><p>After the G# chord our minfifth is F (-3) and maxfifth is B# (10) so<br/>midfifth will be B (3) and the choice of 12 is (always 6 up and 5 down<br/>from midfifth) C thru E#. So although we decided to use a B# for that<br/>chord, a repetition of that note alone would still be rendered as C.<br/>It&apos;s the fact that we still haven&apos;t seen an F# that holds us back.</p><p>&gt; My rules are sort of what I&apos;d expect for 5-limit meantone, but<br/>&gt; optmised to get Gesualdo to work.  The simpest method, especially<br/>for<br/>&gt; real-time operation, would be to remember the key center as a<br/>weighted<br/>&gt; average.  For each new note, take the spot on the spiral of fifths<br/>&gt; nearest to that center, and adjust the average to take account of<br/>the<br/>&gt; new note.</p><p>I fear this is too simple to work for much at all.</p><p>&gt;This wouldn&apos;t work for Gesualdo, as you would get<br/>different<br/>&gt; results depending on which notes were played first in a chord.</p><p>Yes. Chords need to be treated as a whole.</p><p>&gt; Adding the 7-ness does seem to complicate the algorithm.</p><p>Next-to-impossible because of the ambiguity of the tritone.</p><p>&gt;  As you&apos;re<br/>&gt; working with MIDI data, you shouldn&apos;t need to worry about note names<br/>&gt; at all.</p><p>Not sure what you mean here.</p><p>&gt; It looks like it could be hacked to work with UNIX MIDI, but still<br/>&gt; needs a specific synthesizer to receive the pitch bends.</p><p>Why not just make it spit out the spellings in ASCII. There&apos;s already<br/>code there to do that (used in testing)</p><p>&gt; I might be<br/>&gt; able to write the same kind of thing from scratch, but I&apos;ll see how<br/>&gt; you&apos;re collating MIDI data into chord.</p><p>Hmm. Don&apos;t assume that what I did actually works properly.</p><p>&gt; I&apos;ve placed my code at &lt;<a href="http://www.microtonal.co.uk/gesualdo.zip">http://www.microtonal.co.uk/gesualdo.zip</a>&gt;.<br/>&gt; It&apos;s shorter, but then it doesn&apos;t have to do any MIDIness.</p><p>I haven&apos;t looked at yours yet. Maybe you could just write some code so<br/>you can feed my algorithm notes in ASCII (e.g. chord per line) and get<br/>the<br/>spellings out in ASCII.</p><p>&gt;I&apos;ll see if I can plug your algorithm into my script<br/>and<br/>&gt; test it on the Gesualdo examples.</p><p>Thanks. That would be much appreciated. Don&apos;t hesitate to ask for<br/>clarifications by email. I know how much I hate having to read other<br/>people&apos;s code.</p><p>Regards,<br/>-- Dave Keenan</p></div><h3><a id=19640 href="#19640">ðŸ”—</a>Graham Breed &#x3C;graham@microtonal.co.uk&#x3E;</h3><span>3/2/2001 2:48:00 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Dave Keenan wrote:</p><p>&gt; I should point out that I haven&apos;t looked at any Gesualdo piece and<br/>&gt; don&apos;t really have time to start. But if you want to feed me some<br/>&gt; tricky chord sequences I&apos;ll see if I can explain how my algorithm<br/>&gt; would handle them. That is, if you don&apos;t manage to insert my<br/>algorithm<br/>&gt; into your existing framework and let it speak for itself.</p><p>They&apos;re in the zip file with the program.</p><p>&gt; &gt; Minimizing the span on the spiral of fifths would also tend to<br/>avoid<br/>&gt; &gt; chromatic semitones.<br/>&gt;<br/>&gt; Sure. But I think sometimes it doesn&apos;t, and I am willing to<br/>_increase_<br/>&gt; the span of a chord if I have to, to get rid of chromatic semitones.</p><p>I&apos;m sure I&apos;ve see examples of such chords in sheet music.  I&apos;ll keep<br/>my eyes open from now on.  Maybe in Wagner.  You never get actual<br/>chromatic semitones, but sometimes diminished or augmented octaves.  I<br/>might even have seen one in Gesualdo, but not in one of the passages I<br/>have a copy of.  I didn&apos;t take much notice of it, as I was only<br/>interested in mistuned consonances at that time.  I didn&apos;t have an<br/>algorithm that cared about the spellings of dissonances.</p><p>&gt; Yes. In my algorithm, the most important summary of the &quot;state&quot; (the<br/>&gt; imagined heptatonic scale) is the &quot;midfifth&quot;, which is not the mean<br/>of<br/>&gt; the seven, but approximately the median (rounding 0.5&apos;s down), with<br/>&gt; some messy exceptions (See the start of &quot;AdaptForFifth&quot;).</p><p>So that will tend to a diatonic scale.</p><p>&gt; &gt;  Indeed, I&apos;m not sure<br/>&gt; &gt; if those diesis pumps would work with your method.<br/>&gt;<br/>&gt; Ah, no. Diesis pumps will send if off the end every time, unless it<br/>&gt; can use a rest to fall back towards the D centre. Why would one want<br/>&gt; to tune music with diesis pumps in meantone?</p><p>I should point out that only one voice moves by a diesis in these<br/>progressions.  So they&apos;re not really analagous to comma pumps.</p><p>&gt; My algorithm doesn&apos;t do 31-tET wraparound since it assumes the<br/>&gt; tone-generator&apos;s tuning table can&apos;t handle more than +-64 cents. But<br/>&gt; it could be modified to do so. Does Gesualdo require it?</p><p>Oh no, it can work fine as an open spiral of fifths for &lt;ducks&gt; 12<br/>pitch classes.</p><p>&gt; &gt; Okay, take G-Am7-Em-G7-Em-G#.  There&apos;s no C in that progression,<br/>&gt;<br/>&gt; Err. What about in the Am7?</p><p>&lt;shuffling of paper&gt;</p><p>Yes, there it is.  Of course, it&apos;s the note that forms the diesis with<br/>the B# later on.</p><p>&gt; My algorithm would give the same result whether you have a C in<br/>there<br/>&gt; or not, because there is an F which never gets replaced (in the<br/>&gt; heptatonic &quot;state&quot;) by an F#, and F is lower on the chain of fifths<br/>&gt; than C.</p><p>Ah, so it&apos;s still a chain of fifths thing.</p><p>&gt; &gt; so<br/>&gt; &gt; what&apos;s to stop the G# being written G#-C-D#?  It wouldn&apos;t lead to<br/>a<br/>&gt; &gt; chromatic semitone anywhere.<br/>&gt;<br/>&gt; When we come to the G# chord, the lowest &quot;fifth&quot; in the &quot;state&quot; is F<br/>&gt; and the highest is G#, so midfifth is E and our choice of 12 is F to<br/>&gt; A#. We only need to move our centre up by 2 positions to encompass<br/>the<br/>&gt; B# and so the algorithm _does_ discover that it can reduce the span<br/>of<br/>&gt; the chord by spelling it G#-B#-D#.</p><p>That sounds similar to what I&apos;m doing.</p><p>&gt; It doesn&apos;t care that there&apos;s a chromatic semitone between the B in<br/>the<br/>&gt; previous chord and the B#.</p><p>Would it care that Ab-C-Eb is closer on the spiral of fifths?</p><p>Ab-Eb-Bb-F--C--G--D--A--E--B--F#-C#-G#-D#-A#-E#-B#<br/>1  1*       1  2        2* 2        3  3*       3</p><p>I suppose not if the *s refer to the median fifths.  I knew I could<br/>fudge it if I taught the program about root progressions.  The median<br/>fifth seems to be a good simplification.</p><p>&gt; After the G# chord our minfifth is F (-3) and maxfifth is B# (10) so<br/>&gt; midfifth will be B (3) and the choice of 12 is (always 6 up and 5<br/>down<br/>&gt; from midfifth) C thru E#. So although we decided to use a B# for<br/>that<br/>&gt; chord, a repetition of that note alone would still be rendered as C.<br/>&gt; It&apos;s the fact that we still haven&apos;t seen an F# that holds us back.</p><p>Oh, but this is min and max fifth.  That doesn&apos;t always work, and can<br/>be ambiguous (there&apos;s an example in Anchor che per amarti).  Which is<br/>why I average the fifths instead.  But that&apos;s only for one chord at a<br/>time, right?  So you do this *and* check for overloads.  I take all<br/>chords with the smallest span, and then use the previous chord to<br/>choose between them.</p><p>&gt; &gt; Adding the 7-ness does seem to complicate the algorithm.<br/>&gt;<br/>&gt; Next-to-impossible because of the ambiguity of the tritone.<br/>&gt;<br/>&gt; &gt;  As you&apos;re<br/>&gt; &gt; working with MIDI data, you shouldn&apos;t need to worry about note<br/>names<br/>&gt; &gt; at all.<br/>&gt;<br/>&gt; Not sure what you mean here.</p><p>I mean the 7 note scales shouldn&apos;t be needed.  Although the stuff in<br/>your code about note names seems to be for something else.</p><p>&gt; &gt; It looks like it could be hacked to work with UNIX MIDI, but still<br/>&gt; &gt; needs a specific synthesizer to receive the pitch bends.<br/>&gt;<br/>&gt; Why not just make it spit out the spellings in ASCII. There&apos;s<br/>already<br/>&gt; code there to do that (used in testing)</p><p>If it could read them in as well, that&apos;d be perfect.</p><p>&gt; &gt; I&apos;ve placed my code at &lt;<a href="http://www.microtonal.co.uk/gesualdo.zip">http://www.microtonal.co.uk/gesualdo.zip</a>&gt;.<br/>&gt; &gt; It&apos;s shorter, but then it doesn&apos;t have to do any MIDIness.<br/>&gt;<br/>&gt; I haven&apos;t looked at yours yet. Maybe you could just write some code<br/>so<br/>&gt; you can feed my algorithm notes in ASCII (e.g. chord per line) and<br/>get<br/>&gt; the<br/>&gt; spellings out in ASCII.</p><p>Chord per line is what I already work with.</p><p>&gt; &gt;I&apos;ll see if I can plug your algorithm into my script<br/>&gt; and<br/>&gt; &gt; test it on the Gesualdo examples.<br/>&gt;<br/>&gt; Thanks. That would be much appreciated. Don&apos;t hesitate to ask for<br/>&gt; clarifications by email. I know how much I hate having to read other<br/>&gt; people&apos;s code.</p><p>I&apos;ll see if I get time.  It&apos;s looking like, although the method of<br/>choosing chords is different, that won&apos;t be important until I find<br/>chords that would naturally be degenerate.  If the next bit is to<br/>compare the medians, presumably I need to put the steps on the spiral<br/>of fifths into a list, remove duplicates, sort it, and take the middle<br/>one.  If there are an even number of notes, take the nearest of the<br/>middle pair to the mean.  Would that work?</p><p>                     Graham</p></div><h3><a id=19641 href="#19641">ðŸ”—</a>Dave Keenan &#x3C;D.KEENAN@UQ.NET.AU&#x3E;</h3><span>3/2/2001 5:30:19 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In tuning@y..., &quot;Graham Breed&quot; &lt;graham@m...&gt; wrote:<br/>&gt; They&apos;re in the zip file with the program.</p><p>Ok. Got&apos;em.</p><p>&gt; &gt; &gt; Minimizing the span on the spiral of fifths would also tend to<br/>&gt; avoid<br/>&gt; &gt; &gt; chromatic semitones.<br/>&gt; &gt;<br/>&gt; &gt; Sure. But I think sometimes it doesn&apos;t, and I am willing to<br/>&gt; _increase_<br/>&gt; &gt; the span of a chord if I have to, to get rid of chromatic<br/>semitones.<br/>&gt;<br/>&gt; I&apos;m sure I&apos;ve see examples of such chords in sheet music.</p><p>There&apos;s one in bar 85 of Fur Elise for what that&apos;s worth. A-G#-D-F. It<br/>would span less if it were spelled A-Ab-D-F, but my algorithm wont<br/>allow it if the G# is in reach (i.e. no more than two fifths outside<br/>the current choice of 12).</p><p>&gt; &gt; Yes. In my algorithm, the most important summary of the &quot;state&quot;<br/>(the<br/>&gt; &gt; imagined heptatonic scale) is the &quot;midfifth&quot;, which is not the<br/>mean<br/>&gt; of<br/>&gt; &gt; the seven, but approximately the median (rounding 0.5&apos;s down),<br/>with<br/>&gt; &gt; some messy exceptions (See the start of &quot;AdaptForFifth&quot;).<br/>&gt;<br/>&gt; So that will tend to a diatonic scale.</p><p>Not sure what you mean here. The &quot;state&quot; will usually correspond to a<br/>diatonic, yes. But quite often it will represent a &quot;melodic&quot; minor.<br/>i.e. Am with the G# instead of the G (and no F#). And it also seems<br/>common to have what I call a #IV minor. e.g. Am with G# and D# instead<br/>of G and D (and no F#). But it can be any kind of bizarre heptatonic<br/>having no chromatic semitones.</p><p>&gt; I should point out that only one voice moves by a diesis in these<br/>&gt; progressions.  So they&apos;re not really analagous to comma pumps.</p><p>Ok. That should be fine then.</p><p>&gt; Ah, so it&apos;s still a chain of fifths thing.</p><p>Oh sure. Sorry I didn&apos;t make that clear.</p><p>&gt; That sounds similar to what I&apos;m doing.</p><p>Yes. It&apos;s very similar, I only outlined the differences.</p><p>&gt; Would it care that Ab-C-Eb is closer on the spiral of fifths?</p><p>Oops! I goofed. It _will_ choose Ab-C-Eb. When I manually converted<br/>G-Am7-Em-G7-Em-G# to sets of notes I wrote G#&apos;s in the Em&apos;s for some<br/>dumb reason. So I thought my algorithm had already seen a G# before it<br/>got to the G# chord. This would have placed the median fifth of the<br/>&quot;state&quot; (the current chromatic-free heptatonic scale) closer to<br/>G#-B#-D#. But without that, it has to shift up 4 places to find<br/>G#-B#-D# but only down 1 place to find Ab-C-Eb.</p><p>It seems to me that any reasonable algorithm would choose Ab in this<br/>case. What _is_ the argument for choosing G# (other than &quot;That&apos;s what<br/>Gesualdo did&quot;)?</p><p>&gt; Oh, but this is min and max fifth.  That doesn&apos;t always work, and<br/>can<br/>&gt; be ambiguous (there&apos;s an example in Anchor che per amarti).</p><p>I was referring to the max and min fifths in the current &quot;state&quot;, not<br/>the chord. Sorry I don&apos;t have time to explain it better.</p><p>&gt;  Which<br/>is<br/>&gt; why I average the fifths instead.  But that&apos;s only for one chord at<br/>a<br/>&gt; time, right?  So you do this *and* check for overloads.</p><p>I compare spans *and* check for overloads. Yes.</p><p>&gt;If the next bit is to<br/>&gt; compare the medians, presumably I need to put the steps on the<br/>spiral<br/>&gt; of fifths into a list, remove duplicates, sort it, and take the<br/>middle<br/>&gt; one.  If there are an even number of notes, take the nearest of the<br/>&gt; middle pair to the mean.  Would that work?</p><p>I think you might be misunderstanding me here.</p><p>I&apos;ll see if I can find time to hand-simulate my algorithm on those<br/>Gesualdo segments you have provided. Is there a particular one you&apos;d<br/>like me to do next?</p><p>Here&apos;s Anchor che per amarti</p><p>Gesualdo      My algorithm<br/>F# F# C# A#   F# F# C# A#<br/>G E B B       G E B B<br/>Bb E G D      A# E G D<br/>Bb D G D      A# D G D<br/>A E A C#      A E A C#</p><p>Mine wont find the smaller-spanning Bb in the third and fourth chords<br/>unless I increase the allowable key-shift (when looking for smaller<br/>spans) from +-2 up to +-3. This may be an argument for doing so.</p><p>-- Dave Keenan</p></div><h3><a id=19648 href="#19648">ðŸ”—</a>Graham Breed &#x3C;graham@microtonal.co.uk&#x3E;</h3><span>3/2/2001 6:58:16 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Dave Keenan wrote:</p><p>&gt; Not sure what you mean here. The &quot;state&quot; will usually correspond to<br/>a<br/>&gt; diatonic, yes. But quite often it will represent a &quot;melodic&quot; minor.<br/>&gt; i.e. Am with the G# instead of the G (and no F#). And it also seems<br/>&gt; common to have what I call a #IV minor. e.g. Am with G# and D#<br/>instead<br/>&gt; of G and D (and no F#). But it can be any kind of bizarre heptatonic<br/>&gt; having no chromatic semitones.</p><p>If &quot;midfifth&quot; is the most important part of the state, that will give<br/>a diatonic scale as the nearest pitches.  I can&apos;t work out how else<br/>the state is specified.</p><p>&gt; &gt; Would it care that Ab-C-Eb is closer on the spiral of fifths?<br/>&gt;<br/>&gt; Oops! I goofed. It _will_ choose Ab-C-Eb. When I manually converted<br/>&gt; G-Am7-Em-G7-Em-G# to sets of notes I wrote G#&apos;s in the Em&apos;s for some<br/>&gt; dumb reason. So I thought my algorithm had already seen a G# before<br/>it<br/>&gt; got to the G# chord. This would have placed the median fifth of the<br/>&gt; &quot;state&quot; (the current chromatic-free heptatonic scale) closer to<br/>&gt; G#-B#-D#. But without that, it has to shift up 4 places to find<br/>&gt; G#-B#-D# but only down 1 place to find Ab-C-Eb.<br/>&gt;<br/>&gt; It seems to me that any reasonable algorithm would choose Ab in this<br/>&gt; case. What _is_ the argument for choosing G# (other than &quot;That&apos;s<br/>what<br/>&gt; Gesualdo did&quot;)?</p><p>When I originally looked at the score, I didn&apos;t even realize this was<br/>ambiguous.</p><p>I&apos;ll name the voices bottom to top as bass, baritone, tenor, alto,<br/>soprano.  They might be wrong, but I can&apos;t keep on saying &quot;second<br/>voice up&quot; and the like.</p><p>The tenor and alto both move by a major third.  B-D# and E-G#<br/>respectively.  The baritone and soprano move by chromatic semitones,<br/>and the bass is silent.  All you need is to stop voices moving by more<br/>complex intervals than a chromatic semitone.</p><p>My algorithm happens to get it right because B is doubled in the first<br/>chord, and G# in the second.  So the minor third G#-B dominates the<br/>progression.  Originally, I programmed the progression from the chord<br/>names instead of the score, and it was wrong.</p><p>If you put it on a 5-limit lattice</p><p>        B#<br/>       / \<br/>      G#--D#<br/>     / \ /<br/>    E---B<br/>   / \ /<br/>  C---G<br/> / \ /<br/>Ab--Eb</p><p>it&apos;s merely ambiguous: three connections each.</p><p>It would come out right if you counted thirds as more important than<br/>fifths.  That&apos;s a bit ad-hoc, but it works surprisingly often.<br/>Probably because thirds are more likely to be direct intervals in a<br/>single voice.</p><p>&gt; &gt;If the next bit is to<br/>&gt; &gt; compare the medians, presumably I need to put the steps on the<br/>&gt; spiral<br/>&gt; &gt; of fifths into a list, remove duplicates, sort it, and take the<br/>&gt; middle<br/>&gt; &gt; one.  If there are an even number of notes, take the nearest of<br/>the<br/>&gt; &gt; middle pair to the mean.  Would that work?<br/>&gt;<br/>&gt; I think you might be misunderstanding me here.</p><p>Yes, which is a shame because it came out right.</p><p>&gt; I&apos;ll see if I can find time to hand-simulate my algorithm on those<br/>&gt; Gesualdo segments you have provided. Is there a particular one you&apos;d<br/>&gt; like me to do next?</p><p>Merce grido is the real challenge.</p><p>&gt; Here&apos;s Anchor che per amarti<br/>&gt;<br/>&gt; Gesualdo      My algorithm<br/>&gt; F# F# C# A#   F# F# C# A#<br/>&gt; G E B B       G E B B<br/>&gt; Bb E G D      A# E G D<br/>&gt; Bb D G D      A# D G D<br/>&gt; A E A C#      A E A C#<br/>&gt;<br/>&gt; Mine wont find the smaller-spanning Bb in the third and fourth<br/>chords<br/>&gt; unless I increase the allowable key-shift (when looking for smaller<br/>&gt; spans) from +-2 up to +-3. This may be an argument for doing so.</p><p>It&apos;s actually Tu piangi filli mia that has the ambiguous progression.<br/> Take</p><p>D A D F<br/>B B D# F#</p><p>The second chord could be Cb Cb Eb Gb.  Taking the spans on the spiral<br/>of fifths, they&apos;re equidistant.</p><p>Cb-Gb-Db-Ab-Eb-Bb-F--C--G--D--A--E--B--F#-C#-G#-D#<br/>*  *        *     0        0  0     +  +        +</p><p>I stopped using the span because an integer measure will always give<br/>this ambiguity.  You said you resolved it by preferring steps up to<br/>steps down, which will work here (right?).  I decided to take the<br/>mean, so it isn&apos;t an integer and less likely to be ambiguous.  The<br/>median I misunderstood you as suggesting also gives the right answer.</p><p>Considering only 5-limit intervals makes it obvious that the right<br/>answer really is right!</p><p>            Graham</p></div>
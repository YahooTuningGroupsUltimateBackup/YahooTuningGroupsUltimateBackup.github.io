<a href="/tuning">back to list</a><h1>Re: Semi convergents</h1><h3><a id=19763 href="#19763">ðŸ”—</a>Robert Walker &#x3C;robert_walker@rcwalker.freeserve.co.uk&#x3E;</h3><span>3/3/2001 9:35:27 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Dave,</p><p>Thanks for the suggestion.</p><p>I notice that Manuel has a command to find the semi-convergents<br/>in SCALA</p><p>ratio/stern 250.0</p><p>and indeed, my one is leaving quite a few out - definitely a bug.</p><p>Thanks for noticing this.</p><p>There were two things going on.</p><p>First, my series begins 1/1, so when you are approximating to<br/>250 cents, it will leave out the semi-convergents 2/1 and 3/2.</p><p>Secondly, there was a bug in the code.</p><p>I introduced it while optimising the javascript to be a little faster.</p><p>Code read:</p><p>...<br/>   // here approx &gt;= x<br/>   // so 1- x/approx &lt; approx/x - 1<br/>   // check for x/approx-1 &lt; diff, and if this fails<br/>   // the new approx must be at least as far away as the previous one<br/>   //<br/>   if(x*denom/denum-1&lt;diff)// no need for Math.abs(..) as it should be the right way round<br/>...</p><p>Should have been:</p><p>   // Note that if x &gt;1, then x/approx -1 &lt; x-approx &lt;  1-approx/x,<br/>   //<br/>   if(1-x*denom/denum&lt;diff)// no need for Math.abs(..) as it should be the right way round<br/>....</p><p>Fixed now.</p><p>Plus also fixed the confusing comment in the code, and made sure x is<br/>always &gt;1 by inverting it (and then inverting the ratios again on output)<br/>if you use program to find a ratio for a negative number of cents.</p><p>I&apos;ll have to look into semi-convergents and see how they work.</p><p>Checking it again with Scala, I find that it still misses out some<br/>of the semi-convergents.</p><p>However, looking at the paper, the semi-convergents<br/>[t0,t1,....,1],[t0,t1,....,2],...,[t0,t1,....,tkm1-1]<br/>(using tkm1 for t subscript k-1)<br/>are the best approximants to x from below, for k even,<br/>and from above, for k odd.</p><p>This means that one can still expect to miss some out if one<br/>looks only for the closest possible approximants, as a ratio<br/>that is the best from above may be further away than the<br/>most recent one that was best from below.</p><p>Indeed, looking at the Scala results, one finds, for 250 cents:</p><p>R  22/19  253.8049 cents  2.11.19^-1  [1;6,3]<br/>Distance:  3.805 cents<br/>L  37/32  251.3440 cents  2^-5.37  [1;6,2,2]<br/>Distance:  1.344 cents<br/>L  52/45  250.3039 cents  2^2.3^-2.5^-1.13  [1;6,2,3]<br/>Distance:  0.304 cents<br/>L  67/58  249.7298 cents  2^-1.29^-1.67  [1;6,2,4]<br/>Distance: -0.270 cents<br/>R  119/103  249.9807 cents  7.17.103^-1  [1;6,2,3,2]<br/>Distance: -0.019 cents<br/>R  171/148  250.0790 cents  2^-2.3^2.19.37^-1  [1;6,2,3,3]<br/>Distance:  0.079 cents<br/>L  290/251  250.0386 cents  2.5.29.251^-1  [1;6,2,3,2,2]<br/>Distance:  0.039 cents<br/>L  409/354  250.0218 cents  2^-1.3^-1.59^-1.409  [1;6,2,3,2,3]<br/>Distance:  0.022 cents<br/>L  528/457  250.0125 cents  2^4.3.11.457^-1  [1;6,2,3,2,4]<br/>Distance:  0.013 cents<br/>L  647/560  250.0067 cents  2^-4.5^-1.7^-1.647  [1;6,2,3,2,5]<br/>Distance:  0.007 cents<br/>L  766/663  250.0026 cents  2.3^-1.13^-1.17^-1.383  [1;6,2,3,2,6]<br/>Distance:  0.003 cents<br/>L  885/766  249.9997 cents  2^-1.3.5.59.383^-1  [1;6,2,3,2,7]</p><p>Notice that after 171/148, at -0.019 cents the next distance<br/>is 0.079 cents, which indeed is closer than the previous closest<br/>ratio from above at 0.304 cents, but further away than 171/148.</p><p>So my program is going to miss that one out.</p><p>Also it will miss the next two, and the next one you can expect<br/>it to find is 528/457, which indeed it does (now anyway, after<br/>fixing the bug)/</p><p>The semi-convergents look useful.</p><p>I wonder if one can prove that there are no other better<br/>approximants between them - seems fairly likely somehow, but<br/>would need to check up.</p><p>Also wonder if there is any way of forming a continued fraction<br/>like approximation that only produces ratios that are n-limit,<br/>or that involve a particular set of primes, or if there is<br/>any way to extend these useful continued fraction type results<br/>to n-limit ratios.</p><p>Robert</p></div>
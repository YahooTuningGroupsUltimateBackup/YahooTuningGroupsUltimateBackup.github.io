<a href="/tuning">back to list</a><h1>[tuning] Scala sequence file note frequency in hertz?</h1><h3><a id=85360 href="#85360">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/8/2009 10:50:05 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>I&apos;m bussy writing an algorithm that automatically generates Just Intonation<br/>chord progressions.<br/>I&apos;ve just finished the most simple form of my algorithm, it outputs a scala<br/>sequence file with notes specified in frequency between parentheses.<br/>Like this for instance:<br/>5280  note (505.679012)  480<br/>5760  note (568.888889)  480</p><p>Now I thought when one specifies note (xx.xx) that one is giving the<br/>frequency in hertz to be played.<br/>Yet Scala renders nonsense pitches in the output when I do &quot;transform<br/>sequence to midi file&quot;, and I can&apos;t figure out why.<br/>Am I wrong in thinking &quot;note (xx.xx)&quot; is for note pitches in hertz?<br/>Or did I do something else wrong?<br/>Or is this a bug in Scala?</p><p>Any help would be greatly apreciated as this one is driving me crazy.<br/>I really want to hear the output of my algorithm.</p><p>Many thanks!<br/>Marcel</p></div><h3><a id=85361 href="#85361">ðŸ”—</a>Petr Par&#xED;zek &#x3C;p.parizek@...&#x3E;</h3><span>12/8/2009 11:10:03 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Marcel.</p><p>If you use decimal points, then these are cents, not ratios.</p><p>Petr</p></div><h3><a id=85362 href="#85362">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/8/2009 2:06:49 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Petr,</p><p>If you use decimal points, then these are cents, not ratios.<br/>&gt;<br/>&gt; Petr<br/>&gt;</p><p>Yes you are right.<br/>Thank you!</p><p>I wanted to write the frequency in Hertz, but it seems that this can&apos;t be<br/>done in the &quot;note&quot; statement.<br/>I&apos;ve come up with the following solution by using the frequency statement:<br/>0  frequency 300.000000<br/>0  note c  480<br/>480  frequency 166.666667<br/>480  note c  480<br/>960  frequency 250.000000<br/>960  note c  1440<br/>2400  frequency 187.500000<br/>2400  note c  480<br/>2880  frequency 266.666667<br/>2880  note c  480<br/>3360  frequency 250.000000<br/>3360  note c  960</p><p>Works perfectly now :)<br/>Will post the first algorithm and a few mp3 files soon.</p><p>Marcel</p></div><h3><a id=85363 href="#85363">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/8/2009 5:20:11 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>The most messy code ever written (I&apos;m not a programmer) but it&apos;s working :)<br/>Here the first output of my algorithm for those interested.</p><p><a href="http://www.develde.net/">http://www.develde.net/</a></p><p>It&apos;s completely random only following certain basic harmonic and modulation<br/>rules comming from my harmonic permuation JI theory.<br/>The 5limit output is most interesting for now.<br/>The 6limit output I still have to limit the permutations a bit in certain<br/>ways as right now it gives ugly chromatic voices making the melodies too<br/>hard to follow through all this random movement.<br/>Will write more interesting and musical algorithms soon.</p><p>Marcel</p></div><h3><a id=85364 href="#85364">ðŸ”—</a>Petr Par&#xED;zek &#x3C;p.parizek@...&#x3E;</h3><span>12/8/2009 9:12:59 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Marcel wrote:</p><p>&gt; I wanted to write the frequency in Hertz, but it seems that this can&apos;t be done<br/>&gt; in the &quot;note&quot; statement.</p><p>Why should absolute frequencies be better than frequency ratios?</p><p>&gt; I&apos;ve come up with the following solution by using the frequency statement:</p><p>Wow, let me laugh a bit, this is really weird! :-D I&apos;ve never ever seen a sequence file like this. But ... Well, you&apos;ve got what you wanted, of course, that&apos;s undeniable.</p><p>Petr</p></div><h3><a id=85365 href="#85365">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/8/2009 9:26:17 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt; Why should absolute frequencies be better than frequency ratios?<br/>&gt;</p><p>It was easyer for me to write the algorithm this way.<br/>It modulates randomly all over the place and the ratios could get really<br/>big.<br/>This way I don&apos;t have to do a lot of math for the ratios but simply use the<br/>previous chord to calculate the frequencies of the current chord.</p><p>&gt; I&apos;ve come up with the following solution by using the frequency statement:<br/>&gt;<br/>&gt; Wow, let me laugh a bit, this is really weird! :-D I&rsquo;ve never ever seen a<br/>&gt; sequence file like this. But ... Well, you&rsquo;ve got what you wanted, of<br/>&gt; course, that&rsquo;s undeniable.<br/>&gt;<br/>&gt; Petr<br/>&gt;<br/>Hehe yeah it looks weird indeed :)<br/>Looks like Scala&apos;s sequence format wasn&apos;t ment for this. But the great thing<br/>about Scala is that even if it wasn&apos;t ment for something in advance there&apos;s<br/>usually a way to still do it! Love Scala!</p><p>I put an mp3 up on my site <a href="http://www.develde.net">www.develde.net</a> of the algorithm output which I<br/>optimised a bit just now.<br/>It sounds like real music to me :)</p><p>Marcel</p></div><h3><a id=85366 href="#85366">ðŸ”—</a>Petr Par&#xED;zek &#x3C;p.parizek@...&#x3E;</h3><span>12/8/2009 9:49:35 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt; It modulates randomly all over the place and the ratios could get really big.<br/>&gt; This way I don&apos;t have to do a lot of math for the ratios but simply use the previous chord to<br/>&gt; calculate the frequencies of the current chord.</p><p>Hmmm, .. I don&rsquo;t know; I sttill think ratios allow much greater versatility than absolute frequencies do. For example, if we decide for a starting frequency of 90Hz and we want to use 166.6667Hz in the piece, then the first thing which comes to my mind is the fact that the frequency in question could be multiplied by 3 and therefore the entire ratio could be multiplied by 3, which would result in 500/270, and it&rsquo;s just upon your own choice if you decide to write 500/270 or 50/27. Similarly, if the fractional part of an absolute frequency value ends with something like &bdquo;142857142857..&ldquo; or &bdquo;857142857142&ldquo;, then the first thing which comes to my mind (I mean, without any great thinking, it just pops up in my head) is that I can multiply the ratio by 7.</p><p>&gt; I put an mp3 up on my site <a href="http://www.develde.net">www.develde.net</a> of the algorithm output which I optimised<br/>&gt; a bit just now.</p><p>Thanx, maybe I&rsquo;ll get some time for it during the weekend.</p><p>Petr</p></div><h3><a id=85367 href="#85367">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/8/2009 10:17:29 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt; Hmmm, .. I don&rsquo;t know; I sttill think ratios allow much greater versatility<br/>&gt; than absolute frequencies do. For example, if we decide for a starting<br/>&gt; frequency of 90Hz and we want to use 166.6667Hz in the piece, then the first<br/>&gt; thing which comes to my mind is the fact that the frequency in question<br/>&gt; could be multiplied by 3 and therefore the entire ratio could be multiplied<br/>&gt; by 3, which would result in 500/270, and it&rsquo;s just upon your own choice if<br/>&gt; you decide to write 500/270 or 50/27. Similarly, if the fractional part of<br/>&gt; an absolute frequency value ends with something like &bdquo;142857142857..&ldquo; or<br/>&gt; &bdquo;857142857142&ldquo;, then the first thing which comes to my mind (I mean, without<br/>&gt; any great thinking, it just pops up in my head) is that I can multiply the<br/>&gt; ratio by 7.</p><p>Yes you&apos;re right.<br/>It doesn&apos;t much matter in the end.<br/>Except, for ratios i&apos;d have to use 2 variables to store it and work with it.<br/>For frequencies only one.<br/>I have to work with a seperate permutation array anyway because of how the<br/>algorithm works.</p><p>Btw I&apos;m making a php page where one can control many aspects of the<br/>algorithm, and hope to make many outputs available in several formats, also<br/>direct midi tuned by pitchbends.<br/>In time hope to make a sourceforge project out of it where several people<br/>can collaborate on working on the algorithm.<br/>Perhaps you&apos;d be interested too? :)<br/>I&apos;ll let know when I&apos;ve gotten a bit further with it.</p><p>Marcel</p></div><h3><a id=85368 href="#85368">ðŸ”—</a>Mike Battaglia &#x3C;battaglia01@...&#x3E;</h3><span>12/9/2009 4:00:25 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt;<br/>&gt; Btw I&apos;m making a php page where one can control many aspects of the<br/>&gt; algorithm, and hope to make many outputs available in several formats, also<br/>&gt; direct midi tuned by pitchbends.<br/>&gt; In time hope to make a sourceforge project out of it where several people<br/>&gt; can collaborate on working on the algorithm.<br/>&gt; Perhaps you&apos;d be interested too? :)<br/>&gt; I&apos;ll let know when I&apos;ve gotten a bit further with it.<br/>&gt;</p><p>I am certainly interested. I wrote a javascript MIDI library a while ago<br/>actually that operates on data URIs and might be suited for this purpose,<br/>unless a free and easy PHP MIDI library is already available.</p><p>But seriously man, what are you doing here? I&apos;d love to see this algorithm.<br/>It sounds great and I&apos;d love to see if it can be extended to 7-limit just or<br/>tempered tunings as well. It seems like you have a predefined list of<br/>chords, and that you just move from each chord to a random adjacent one with<br/>a common tone, but with some rules (V always goes to I, etc) while figuring<br/>out the voice leading on the spot. It would be neat to extend that to some<br/>of the more interesting chords I like to use in plain old simple 12-tet.</p><p>The truly remarkable thing about this is that you have created a very clever<br/>algorithm for a computer to generate fluid-sounding and natural chord<br/>progressions, microtonal or not -- it would be nice to hear an explanation<br/>of how your algorithm works at least.</p></div><h3><a id=85369 href="#85369">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/9/2009 12:42:23 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Mike,</p><p>I am certainly interested. I wrote a javascript MIDI library a while ago<br/>&gt; actually that operates on data URIs and might be suited for this purpose,<br/>&gt; unless a free and easy PHP MIDI library is already available.<br/>&gt;</p><p>Ok great! :)<br/>It&apos;s my greatest wish to work together with people on this.<br/>I just did it in php now because i did a few things in it many years ago so<br/>was atleast a bit familiar, and <a href="http://php.net">php.net</a> is a great help in figuring out how<br/>to write something.<br/>But javascript is fine too.<br/>I do belief that php also has a midi output 3rd party script, i one ran<br/>across it but haven&apos;t looked for it again yet.</p><p>&gt; But seriously man, what are you doing here? I&apos;d love to see this algorithm.<br/>&gt; It sounds great and I&apos;d love to see if it can be extended to 7-limit just or<br/>&gt; tempered tunings as well.<br/>&gt;</p><p>In time I think it can be extended to 7-limit, it&apos;s all about permutation<br/>rules.<br/>For tempered tunings, it seems possible but the basis of the algorithm is<br/>JI. Take away the JI and there is no algorithm as it&apos;s all about the pure<br/>harmonic series and it&apos;s permutations.<br/>But one can offcourse temper the output of the algorithm after it has<br/>generated the music.</p><p>&gt; It seems like you have a predefined list of chords, and that you just move<br/>&gt; from each chord to a random adjacent one with a common tone, but with some<br/>&gt; rules (V always goes to I, etc) while figuring out the voice leading on the<br/>&gt; spot.<br/>&gt;</p><p>Yes right now there&apos;s a sort of predefined list of chords, as there are only<br/>a limited number of permutations possible.<br/>But no functional hamonic rules yet whatsoever :) These can easily come<br/>later though.<br/>Also right now there&apos;s no use of octave equivalence, and it&apos;s not using all<br/>the permutations possible yet (will write more permutation possibilities<br/>soon), it&apos;s ony the first attempt to write some of my theory in an<br/>algorithm, and a rushed attempt.<br/>Also right now it only does &quot;pure&quot; permutations but no combinations of<br/>permutations (which will expand the possible number of chords to almost<br/>infinite), as I don&apos;t yet know exactly how this works and how to make sense<br/>of it. I do know that the individual voices are very important and can think<br/>of some rules to allow infinite chords and octave equivalence while keep<br/>voices pure diatonic etc but it gets very difficult here, something for<br/>later.</p><p>&gt; It would be neat to extend that to some of the more interesting chords I<br/>&gt; like to use in plain old simple 12-tet.<br/>&gt;</p><p>It can do it :) But later.</p><p>&gt;<br/>&gt; The truly remarkable thing about this is that you have created a very<br/>&gt; clever algorithm for a computer to generate fluid-sounding and natural chord<br/>&gt; progressions, microtonal or not -- it would be nice to hear an explanation<br/>&gt; of how your algorithm works at least.<br/>&gt;</p><p>I&apos;m making the website that explain the theory and the algorithm etc soon.<br/>(but first next few days I wish to impement a few more things in the<br/>algorithm and make a few more songs)<br/>I can&apos;t paste it all here and have it make sense.<br/>I&apos;ll do so anyhow, but I warn you it&apos;s messy :) (and very incomplete<br/>according to my theory)</p><p>Here it comes:</p><p>&lt;?php</p><p>$num_chords = 720;<br/>$harm_limit = 5;<br/>$v1_start_freq = 100;<br/>$low_freq = 73;<br/>$high_freq = 940;<br/>$tempo = 128;<br/>$notelength = 480;</p><p>$harmony[0][0] = $v1_start_freq;<br/>$hold[0][0] = 1;<br/>for ($i = 1; $i &lt; $harm_limit; $i++) {<br/>    $harmony[0][$i] = $v1_start_freq * ($i +1);<br/>    $hold[0][$i] = 1;<br/>}</p><p>for ($i = 1; $i &lt; $num_chords; $i++) {<br/>    $permseed = range(2, $harm_limit);<br/>    shuffle($permseed);<br/>    $permchord[0] = 1;<br/>    $permutation = 1;<br/>    foreach ($permseed as $perm) {<br/>        $permprev = $permutation - 1;<br/>        $permdiv = $perm - 1;<br/>        $permchord[$permutation] =  ($permchord[$permprev] / $permdiv ) *<br/>$perm;<br/>        $permutation++;<br/>    }<br/>    $modvoice = rand(0, ($harm_limit -1));<br/>    $modfactor = $harmony[$i-1][$modvoice] / $permchord[$modvoice];<br/>    $v = 0;<br/>    foreach ($permchord as $permvoice) {<br/>        $harmony[$i][$v] = $permvoice * $modfactor;<br/>        $hold[$i][$v] = 1;<br/>        $prev = $i -1;<br/>        if ( $harmony[$i][$v] == $harmony[$prev][$v]) {<br/>            $hold[$i][$v] = 0;<br/>        }<br/>        $v++;<br/>    }<br/>    if ($harmony[$i][0] &lt; $low_freq) {<br/>        $i--;<br/>    }<br/>    if ($harmony[$i][$harm_limit-1] &gt; $high_freq) {<br/>        $i--;<br/>    }<br/>}<br/>for ($v = $harm_limit -1; $v &gt;= 0; $v--) {<br/>    $holdcount = 1;<br/>    for ($i = $num_chords -1; $i &gt;= 0; $i--) {<br/>        if ($hold[$i][$v] == 1) {<br/>            $hold[$i][$v] = $holdcount;<br/>            $holdcount = 1;<br/>        }<br/>        if ($hold[$i][$v] == 0) {<br/>            $holdcount++;<br/>        }<br/>    }<br/>}<br/>for ($v = 0; $v &lt; $harm_limit; $v++) {<br/>    $track = $v +1;<br/>    echo &quot;0  track $track\n&quot;;<br/>    echo &quot;0  program 58\n&quot;;<br/>    for ($i = 0; $i &lt; $num_chords; $i++) {<br/>        if ($hold[$i][$v] != 0) {<br/>            $holdnotelength = $notelength * $hold[$i][$v];<br/>            $seq_measure = $i * 480;<br/>            echo $seq_measure .&quot;  frequency &quot;;<br/>            printf(&quot;%f&quot;, $harmony[$i][$v]);<br/>            echo &quot;\n&quot;;<br/>            echo $seq_measure .&quot;  note c  $holdnotelength\n&quot;;<br/>        }<br/>    }<br/>    echo &quot;\n&quot;;<br/>}<br/>?&gt;</p><p>This is the one that generated the mp3.<br/>Again, it&apos;s messy, incomplete and written fast just to give an output that I<br/>can hear soon. It&apos;s not a good representation of my theory yet.<br/>Ohyeah and don&apos;t mind the variable names, i was feeling a bit silly :p<br/>But I think it&apos;d be better to wait a few weeks till i have the site ready<br/>that will explain everything in an easy to understand way.<br/>And I&apos;ll have thought of good ways to work together with people on this.<br/>Though if you allready have ideas and suggestions be free to share! :)</p><p>Marcel</p></div><h3><a id=85373 href="#85373">ðŸ”—</a>Graham Breed &#x3C;gbreed@...&#x3E;</h3><span>12/10/2009 4:02:41 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Marcel de Velde &lt;m.develde@...&gt; wrote:</p><p>&gt;     if ($harmony[$i][0] &lt; $low_freq) {<br/>&gt;         $i--;<br/>&gt;     }<br/>&gt;     if ($harmony[$i][$harm_limit-1] &gt; $high_freq) {<br/>&gt;         $i--;<br/>&gt;     }</p><p>Shouldn&apos;t the array be sorted at this point?</p><p>Anyway, for whatever it&apos;s worth, I re-wrote the script in<br/>Python:</p><p><a href="http://x31eq.com/marcel.py">http://x31eq.com/marcel.py</a></p><p>I don&apos;t know if it&apos;s working right but it outputs something<br/>that looks valid.</p><p>                      Graham</p></div><h3><a id=85374 href="#85374">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/10/2009 5:42:00 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Graham,</p><p>&gt; if ($harmony[$i][0] &lt; $low_freq) {<br/>&gt; &gt; $i--;<br/>&gt; &gt; }<br/>&gt; &gt; if ($harmony[$i][$harm_limit-1] &gt; $high_freq) {<br/>&gt; &gt; $i--;<br/>&gt; &gt; }<br/>&gt;<br/>&gt; Shouldn&apos;t the array be sorted at this point?<br/>&gt;</p><p>This part only checks wether the lowest voice isn&apos;t lower than the given<br/>$low_freq and then if the highest voice isn&apos;t higher than the given<br/>$high_freq<br/>If one of the voices in this chord is indeed too low or too high it simply<br/>does $i-- and starts building a random chord again, this loop continues till<br/>the chord &quot;behaves&quot; and isn&apos;t either too low or too high anymore.<br/>I set the $low_freq to 73 hertz and the $high_freq to 940 hertz because the<br/>choir sound I used doesn&apos;t go any lower or higher.<br/>I have no idea what sorting an array means :) I&apos;m not really a programmer as<br/>you can see hehe.</p><p>&gt;<br/>&gt; Anyway, for whatever it&apos;s worth, I re-wrote the script in<br/>&gt; Python:<br/>&gt;<br/>&gt; <a href="http://x31eq.com/marcel.py">http://x31eq.com/marcel.py</a><br/>&gt;<br/>&gt; I don&apos;t know if it&apos;s working right but it outputs something<br/>&gt; that looks valid.<br/>&gt;<br/>&gt; Graham</p><p>Ok wow thanks, and congratulations you could convert it.<br/>I&apos;ll go figure out how to run a python script later today.<br/>To check the output simply copy paste it to a scala sequence file and use<br/>scala to convert it to a midi file.<br/>(btw if you&apos;re running the php version in a browser you need to look at the<br/>generated page source and copy paste this)<br/>The .scl file only needs a head. I used this one:</p><p>0     exclude   10<br/>0     tempo     120 pm<br/>0     velocity  96<br/>0     frequency 261.626<br/>0     notation  E12<br/>0     text &quot;Harmonic Permutation JI Algorithm Output, Marcel de Velde,<br/>Zwolle, 8 dec 2009&quot;<br/>!</p><p>Below this paste the output of the algorithm and it should give random<br/>music.</p><p>btw I&apos;m curious what the sorting of the array does in your script.<br/>And why did you think it was needed?</p><p>Marcel</p></div><h3><a id=85375 href="#85375">ðŸ”—</a>Graham Breed &#x3C;gbreed@...&#x3E;</h3><span>12/10/2009 6:55:17 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Marcel de Velde &lt;m.develde@...&gt; wrote:</p><p>&gt; btw I&apos;m curious what the sorting of the array does in<br/>&gt; your script. And why did you think it was needed?</p><p>It makes sure the first note in the chord is the lowest,<br/>and the last note is the highest.  I don&apos;t see how else<br/>this is done.</p><p>I&apos;ll look at other things tomorrow.</p><p>                         Graham</p></div><h3><a id=85377 href="#85377">ðŸ”—</a>Marcel de Velde &#x3C;m.develde@...&#x3E;</h3><span>12/10/2009 1:29:24 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt; It makes sure the first note in the chord is the lowest,<br/>&gt; and the last note is the highest. I don&apos;t see how else<br/>&gt; this is done.<br/>&gt;</p><p>It is allready the automatic result, no sorting needed for this.<br/>There are several ways to write the permutations I wanted, but I wrote it<br/>the way that first the permutated chord is built, and then the whole chord<br/>is pitched to the correct frequency.<br/>The php script I posted works perfectly (as long as one doesn&apos;t set an<br/>impossible low or high_freq or voice1 start frequency)<br/>It is the exact code that generated the output I made the mp3 of that I<br/>posted.</p><p>Marcel</p></div><h3><a id=85383 href="#85383">ðŸ”—</a>Graham Breed &#x3C;gbreed@...&#x3E;</h3><span>12/10/2009 11:21:48 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Marcel de Velde &lt;m.develde@...&gt; wrote:</p><p>&gt; It is allready the automatic result, no sorting needed<br/>&gt; for this. &lt;snip&gt;</p><p>Yes, I was wrong.  The chords are always in ascending order.</p><p>                    Graham</p></div>
<a href="/tuning">back to list</a><h1>Re: Smoothing end-points (was re: Sad symmetric septimal minor tune)</h1><h3>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>5/29/2004 5:54:53 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Kurt,</p><p>&gt; Ah, I see, you are doing it by smoothing the end result, not by adjusting<br/>&gt; the spliced-in section to achieve the desired continuity?</p><p>Yes, I think it is probably easier to smooth out the result than to<br/> splice in a spline with all the infinitely many correct derivatives<br/>at the joins.</p><p>What you want is a function which has all its derivatives zero at the origin.<br/>You might think that impossible because its taylor series would be<br/>identically zero so it would surely just be a constant function<br/>- indeed you can&apos;t have a function which can be given by a taylor series<br/>within any finite radius of convergence - but<br/>such functions do exist, it is just that the taylor series only converges<br/>to the function at a single point.</p><p>Here is one:</p><p><a href="http://www.shu.edu/projects/reals/cont/fp_cinf.html">http://www.shu.edu/projects/reals/cont/fp_cinf.html</a></p><p>g(x) = e^-1/x^2 if x!= 0<br/>= 0 at origin</p><p>Then by the product rule if we take<br/>g(x)*h(x) for any function h bounded at the<br/>origin then its derivative<br/>g(x)*h&apos;(x)+g&apos;(x)*h(x)<br/>is zero, and indeed all its derivatives are zero<br/>at the origin once more.</p><p>So if our function is f(x) we want to smooth out<br/>f(x) at the origin and let K*x be a line<br/>at the intermediate slope between the two gradients<br/>for F for 0- and 0+</p><p>Just use<br/>k*x + g(x)*(f(x)-k*x)</p><p>Then it&apos;s derivative at the origin is k<br/>and all its other derivatives are 0.</p><p>I used that for the quarter waves<br/>as it was easy to do with the<br/>average slope for the two curves<br/>as 0 there.</p><p>Could do it for the complete<br/>waveform too, but you would have to<br/>add in a cubic or something and multiply<br/>two copies of this function with the infinitely<br/>many zero derivatives together with it,<br/>(2 copies, one with shifted x values) - or something like<br/>that - in order to get both ends working.</p><p>But actually I was lazy there and did<br/>another method for the complete wave<br/>It just smooths out the first derivative<br/>and probably not the others, but it gives decent<br/>results which is the main thing in a practical<br/>situation like this.</p><p>A couple of screen shots:</p><p><a href="http://www.robertinventor.com/waveform_before_smoothing.png">http://www.robertinventor.com/waveform_before_smoothing.png</a><br/><a href="http://www.robertinventor.com/waveform_after_smoothing.png">http://www.robertinventor.com/waveform_after_smoothing.png</a></p><p>&gt; Maybe we should talk about getting FTS ported to the Mac? How much of the<br/>&gt; code is user-interface and how much of it is sythesis and other<br/>&gt; implementation, and how well are these aspects separated out? If there was<br/>&gt; a quick-and-dirty way to do it it might be worth it. Just a thought. Not<br/>&gt; that I have any time for it at the moment or in the next year! ;)</p><p>Thanks for the thought.</p><p>Some parts are well separated out. The code for generating the waveforms<br/>just calls a number of routines to fill a buffer with waveform audio<br/>data. So that could be ported to any platform. Ditto for<br/>the equation parsing e.g. for the heavyside functions etc.<br/>Indeed one could make that part of the code into<br/>a console app version that did all that fairly easiily<br/>and it would be multi-platfrom code surely, only<br/>standard c routines. Maybe output in .RAW format<br/>(just the waveform data) and input all the user<br/>variables from a file or something. Not saying that<br/>I plan to do that, but it could be done.</p><p>The GUI, writing the waveform to file in the .WAV riff format,<br/>and playing the audio are all coded using many Windows routines and the<br/>Windows architectures, and I&apos;d be surprised if it could<br/>be ported easily. So anyone contemplating the port would<br/>need to code for all that.</p><p>Easiest though is to use FTS with Virtual PC.<br/>Several users now use FTS on Macs like that<br/>and report that it works fine.</p><p>Unfortunately though I don&apos;t know if one<br/>can get a trial version of Virtual PC any more<br/>now that it has been taken over by Windows - one<br/>may have to purchase it to try it out.</p><p>The best way to write a platform indpendent app is<br/>set out to do that from the start and write it using<br/>one of the tools for that such as GtK as Manuel does.<br/>I may give that a go some time in the future with some<br/>small program to see how it goes (probably not this year<br/>yet).</p><p>Thanks,</p><p>Robert</p></div><h3>Kurt Bigler &#x3C;kkb@breathsense.com&#x3E;</h3><span>5/29/2004 8:08:06 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>on 5/29/04 5:54 PM, Robert Walker &lt;<a href="mailto:robertwalker@ntlworld.com">robertwalker@ntlworld.com</a>&gt; wrote:</p><p>&gt; Hi Kurt,<br/>&gt;<br/>&gt;&gt; Ah, I see, you are doing it by smoothing the end result, not by adjusting<br/>&gt;&gt; the spliced-in section to achieve the desired continuity?<br/>&gt;<br/>&gt; Yes, I think it is probably easier to smooth</p><p>Easier, I&apos;m sure.  But you&apos;re doing the work so I don&apos;t need it to be easy.<br/>;)</p><p>But more to the point the result is just different.  Smoothing the entire<br/>result rather directly reduces the higher harmonic content, less so to the<br/>degree the smoothing method has some inherent nonlinearity.  My curiousity<br/>was what if you take the curve the user specified *unmodified* and join it<br/>to itself by some splicing curve.  Change the duty cycle (whatever you want<br/>to call it) and listen to the result.  I used to do this with electronics<br/>using waveforms that mostly had square edges and it gives effects akin to<br/>filter sweeps but much more interesting.  It need not necessarily be dynamic<br/>(e.g. shaped by an envelope or by a modulation input) but if it can be, all<br/>the better.</p><p>&gt; out the result than to<br/>&gt; splice in a spline with all the infinitely many correct derivatives<br/>&gt; at the joins.</p><p>Don&apos;t need infinitely many correct derivatives, just a specified limited<br/>number, with possibly special solution cases offered for particular lower<br/>limits.</p><p>Hey, we&apos;re probably OT, but unfortunately I&apos;m not on tuning-math.</p><p>&gt; What you want is a function which has all its derivatives zero at the origin.</p><p>I can&apos;t figure out why you would want that.</p><p>&gt; You might think that impossible because its taylor series would be<br/>&gt; identically zero so it would surely just be a constant function<br/>&gt; - indeed you can&apos;t have a function which can be given by a taylor series<br/>&gt; within any finite radius of convergence - but<br/>&gt; such functions do exist, it is just that the taylor series only converges<br/>&gt; to the function at a single point.<br/>&gt;<br/>&gt; Here is one:<br/>&gt;<br/>&gt; <a href="http://www.shu.edu/projects/reals/cont/fp_cinf.html">http://www.shu.edu/projects/reals/cont/fp_cinf.html</a></p><p>That&apos;s a very interesting one.  All the movement is hiding away from 0, you<br/>might say.</p><p>&gt; But actually I was lazy there and did<br/>&gt; another method for the complete wave<br/>&gt; It just smooths out the first derivative<br/>&gt; and probably not the others, but it gives decent<br/>&gt; results which is the main thing in a practical<br/>&gt; situation like this.</p><p>There you go.</p><p>&gt; A couple of screen shots:<br/>&gt;<br/>&gt; <a href="http://www.robertinventor.com/waveform_before_smoothing.png">http://www.robertinventor.com/waveform_before_smoothing.png</a><br/>&gt; <a href="http://www.robertinventor.com/waveform_after_smoothing.png">http://www.robertinventor.com/waveform_after_smoothing.png</a></p><p>Well there you probably haven&apos;t lost too many harmonics for that particular<br/>case.</p><p>&gt;&gt; Maybe we should talk about getting FTS ported to the Mac? How much of the<br/>&gt;&gt; code is user-interface and how much of it is sythesis and other<br/>&gt;&gt; implementation, and how well are these aspects separated out? If there was<br/>&gt;&gt; a quick-and-dirty way to do it it might be worth it. Just a thought. Not<br/>&gt;&gt; that I have any time for it at the moment or in the next year! ;)<br/>&gt;<br/>&gt; Thanks for the thought.<br/>&gt;<br/>&gt; Some parts are well separated out. The code for generating the waveforms<br/>&gt; just calls a number of routines to fill a buffer with waveform audio<br/>&gt; data. So that could be ported to any platform. Ditto for<br/>&gt; the equation parsing e.g. for the heavyside functions etc.<br/>&gt; Indeed one could make that part of the code into<br/>&gt; a console app version that did all that fairly easiily<br/>&gt; and it would be multi-platfrom code surely, only<br/>&gt; standard c routines. Maybe output in .RAW format<br/>&gt; (just the waveform data) and input all the user<br/>&gt; variables from a file or something. Not saying that<br/>&gt; I plan to do that, but it could be done.</p><p>Well tell me how many customer&apos;s you have and multiply by a market-share<br/>factor for Mac, and we&apos;ll see whether its worth it.   ;)</p><p>&gt; The GUI, writing the waveform to file in the .WAV riff format,<br/>&gt; and playing the audio are all coded using many Windows routines and the<br/>&gt; Windows architectures, and I&apos;d be surprised if it could<br/>&gt; be ported easily.</p><p>Nah, I&apos;ve cleaned up and ported all kinds of junk.  I often take the<br/>strategy of simulating the original platform and that&apos;s less hard than you&apos;d<br/>imagine in many cases.</p><p>&gt; So anyone contemplating the port would<br/>&gt; need to code for all that.<br/>&gt;<br/>&gt; Easiest though is to use FTS with Virtual PC.<br/>&gt; Several users now use FTS on Macs like that<br/>&gt; and report that it works fine.</p><p>Ah, that&apos;s interesting.  I don&apos;t have Virtual PC yet.</p><p>&gt; Unfortunately though I don&apos;t know if one<br/>&gt; can get a trial version of Virtual PC any more<br/>&gt; now that it has been taken over by Windows - one<br/>&gt; may have to purchase it to try it out.</p><p>I could probably acquire a trial version one way or the other, so to speak.<br/>I&apos;d want it to be able to use my non-built-in audio output devices.<br/>Presumably Virtual PC would let you select your output device, though.</p><p>&gt; The best way to write a platform indpendent app is<br/>&gt; set out to do that from the start and write it using<br/>&gt; one of the tools for that such as GtK as Manuel does.</p><p>Well, unfortunately gtk currently gets ported to MacOS X via the X-Windows<br/>platform which is a slightly ugly result, although better than nothing.  A<br/>native OSX gtk target is planned but is probably years off.</p><p>&gt; I may give that a go some time in the future with some<br/>&gt; small program to see how it goes (probably not this year<br/>&gt; yet).</p><p>Yea, you might want to wait for the OSX-native gtk.  There is an OSX native<br/>tcl/tk, recently finished, FWIW:</p><p>    <a href="http://tcltkaqua.sourceforge.net">http://tcltkaqua.sourceforge.net</a></p><p>But I don&apos;t know what can and can&apos;t be done with tcl/tk.</p><p>-Kurt</p><p>&gt;<br/>&gt; Thanks,<br/>&gt;<br/>&gt; Robert</p></div><h3>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>5/30/2004 8:56:36 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Kurt,</p><p>I let the user set the amount of the smoothing.<br/>So if it is say 1% then only a little bit of the<br/>curve at the ends gets smoothed very strongly.<br/>So it still looks like a pretty sharp corner at<br/>the join. If it is say 80% then much of the curve<br/>gets smoothed and e.g. in sin(1/x^2) the ripples<br/>will all get so small as to be invisible.</p><p>The reason for wanting the derivatives all zero<br/>at the origin is because then when you multiply<br/>it by any other function, the result has all<br/>its derivatives zero there too, whatever the<br/>slope of the other function (if bounded)<br/>even if the other function has discontinuous<br/>derivatives, so the result is going to be smooth.</p><p>&gt; Well tell me how many customer&apos;s you have and multiply by a market-share<br/>&gt; factor for Mac, and we&apos;ll see whether its worth it. ;)</p><p>Not worth it financially. Only because one wants<br/>to do it out of ones own enthusiasm for the work.</p><p>If I were to write a synth of soft synth based<br/>on these waveform ideas for Windows as a separate<br/>program I&apos;d feel very happy indeed if I got<br/>as much as $200 a year  for it. (unless it was<br/>so really excellent that it became one of the<br/>three or four top soft synths<br/>in the market). So for the Mac, guestimate,<br/>maybe $20 a year. Very rough estimate.</p><p>Sorry, I don&apos;t happen to know whether you<br/>can select your output device in Virtual PC<br/>but would be surprised if you can&apos;t.</p><p>Yes one thing about native written programs<br/>for a platform is that they tend to have a<br/>more polished GUI.</p><p>But GtK is looking pretty good for<br/>Windows now indeed, with some neat features<br/>you don&apos;t have in Windows programs even<br/>- particularly the way it handles<br/>window resizing logic.</p><p>thanks,</p><p>Robert</p></div>
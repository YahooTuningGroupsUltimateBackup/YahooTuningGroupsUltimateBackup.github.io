<a href="/tuning">back to list</a><h1>Pitch detection</h1><h3><a id=35801 href="#35801">ðŸ”—</a>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>3/20/2002 6:49:52 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>HI Graham,</p><p>Your remark about the gaussian got me thinking<br/>about distributions, and means, and I hit on a<br/>new idea for peak detection.</p><p>The thing is that these are all three point methods<br/>- only use three data points. One wonders if using<br/>more than three would increase the accuracy - seems<br/>likely. Speed isn&apos;t a consideration here because<br/>one only need do the exact peak positioning<br/>for ones that are already selected as peaks<br/>(or at least, as I do it now, at a preliminary stage in the<br/>processing to find likely peaks).</p><p>If you look at the peaks that get found using<br/>Jain&apos;s method, often you can see that they<br/>are to one side or the other of the position<br/>one would pick out by eye. It isn&apos;t so surprising<br/>as they use only three values to find the peak.</p><p>So I had the idea of going down to, say, 5 %<br/>(or whatever) of the height of the peak to either<br/>side, treating the FFT values as the population,<br/>and finding the mean value.</p><p>Also did a bit extra to cope with the fact that<br/>if you join the points (e.g. using straight lines<br/>as 1st approx) then the point at which the curve<br/>will cross the 5% value will be between two data<br/>points. Anyway I did something reasonable there.</p><p>Here are the results:<br/>.........................................</p><p>Fractal Tune Smithy Custom voice or FFT results As Timbre Partials</p><p>Freq.        Amp. (db)    Cents</p><p>233.925368   99.7772512   0<br/>292.481755   100          386.757972<br/>350.908735   99.320157    702.057048<br/>467.952108   85.0273321   1200.37508<br/>584.983612   85.63987     1586.81747<br/>701.925861   87.2793031   1902.3244<br/>877.336224   77.6246343   2288.49782<br/>935.798521   73.6975563   2400.17955<br/>1052.73478   78.5803097   2604.02615<br/>1169.6912    73.4924172   2786.40898<br/>1403.82061   68.8110042   3102.28604<br/>1462.2193    69.5782544   3172.84737<br/>1637.95775   63.7875717   3369.3335<br/>1754.63814   73.7779475   3488.46397<br/>1871.51156   61.5131567   3600.10048<br/>2047.39581   63.7343926   3755.60377<br/>2105.60418   64.2014453   3804.13684<br/>2339.64795   55.7295876   3986.60548<br/>2456.64434   63.663738    4071.08254<br/>2573.95612   55.9223244   4151.84068<br/>2632.03212   58.2986596   4190.46825<br/>2807.45928   63.9440635   4302.17384<br/>2924.47242   56.8990651   4372.86739<br/>3041.32035   52.0982817   4440.69308<br/>3158.58298   58.8073264   4506.1887<br/>3216.60706   55.9111944   4537.70338<br/>3275.93668   51.3327412   4569.3447<br/>3509.3874    62.4252546   4688.51878<br/>3743.03987   49.2280227   4800.10823<br/>3801.44419   53.1985153   4826.91286<br/>3860.23497   55.018926    4853.48213<br/>3968.51739   47.3203941   4901.37588<br/>4094.58557   51.1834014   4955.51665<br/>4211.5208    53.6240329   5004.26528<br/>4386.87147   49.9039761   5074.88665<br/>4445.60473   46.4831365   5097.91135<br/>4561.87305   52.6391471   5142.60729<br/>4678.98604   52.1244402   5186.49084<br/>4912.7788    46.8231402   5270.90287<br/>4971.37529   47.8706165   5291.42975<br/>5148.49002   43.8881078   5352.03497<br/>5263.46733   48.9118325   5390.27192<br/>5557.09022   46.146928    5484.25132<br/>5614.98615   49.3017419   5502.19469<br/>5966.3571    48.1895215   5607.27612<br/>6141.33306   43.5094321   5657.31794<br/>6316.76146   50.2959451   5706.07784<br/>6668.07435   45.8654647   5799.77996<br/>6726.08279   43.2453498   5814.77557<br/>7019.00832   43.244978    5888.57638<br/>7369.64871   43.2866343   5972.97075<br/>8188.29812   43.2752391   6155.33208</p><p>Analysed on 2 PM Wednesday, March 20, 2002 GMT Standard Time - Flute</p><p>FFT sample analysed: 0.07033 Mb 0.09288 secs (4096 samples)</p><p>From recording of length: 2.268 secs<br/>FFT bin size 10.77 Hz, Peak interpolation method used Mean value</p><p>Truncated from 0.1 secs to make the number of samples a power of two</p><p>.....................................................................</p><p>Better than Jain&apos;s method - this time just as a rough guess<br/>looking at the figures, looks like the  95 % confidence interval<br/>is less than 1Hz for a 0. 09 secs sample!</p><p>Robert</p></div><h3><a id=35816 href="#35816">ðŸ”—</a>paulerlich &#x3C;paul@stretch-music.com&#x3E;</h3><span>3/20/2002 1:25:20 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In tuning@y..., &quot;Robert Walker&quot; &lt;robertwalker@n...&gt; wrote:<br/>&gt; HI Graham,<br/>&gt;<br/>&gt; Your remark about the gaussian got me thinking<br/>&gt; about distributions, and means, and I hit on a<br/>&gt; new idea for peak detection.<br/>&gt;<br/>&gt; The thing is that these are all three point methods<br/>&gt; - only use three data points. One wonders if using<br/>&gt; more than three would increase the accuracy - seems<br/>&gt; likely. Speed isn&apos;t a consideration here because<br/>&gt; one only need do the exact peak positioning<br/>&gt; for ones that are already selected as peaks<br/>&gt; (or at least, as I do it now, at a preliminary stage in the<br/>&gt; processing to find likely peaks).<br/>&gt;<br/>&gt; If you look at the peaks that get found using<br/>&gt; Jain&apos;s method, often you can see that they<br/>&gt; are to one side or the other of the position<br/>&gt; one would pick out by eye. It isn&apos;t so surprising<br/>&gt; as they use only three values to find the peak.<br/>&gt;<br/>&gt; So I had the idea of going down to, say, 5 %<br/>&gt; (or whatever) of the height of the peak to either<br/>&gt; side, treating the FFT values as the population,<br/>&gt; and finding the mean value.<br/>&gt;<br/>&gt; Also did a bit extra to cope with the fact that<br/>&gt; if you join the points (e.g. using straight lines<br/>&gt; as 1st approx) then the point at which the curve<br/>&gt; will cross the 5% value will be between two data<br/>&gt; points. Anyway I did something reasonable there.<br/>&gt;<br/>&gt; Here are the results:<br/>&gt; .........................................<br/>&gt;<br/>&gt; Fractal Tune Smithy Custom voice or FFT results As Timbre Partials<br/>&gt;<br/>&gt; Freq.        Amp. (db)    Cents<br/>&gt;<br/>&gt; 233.925368   99.7772512   0<br/>&gt; 292.481755   100          386.757972<br/>&gt; 350.908735   99.320157    702.057048<br/>&gt; 467.952108   85.0273321   1200.37508<br/>&gt; 584.983612   85.63987     1586.81747<br/>&gt; 701.925861   87.2793031   1902.3244</p><p>you&apos;re clearly doing far better this time. care to try the other<br/>jerries?</p></div><h3><a id=35842 href="#35842">ðŸ”—</a>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>3/21/2002 4:18:31 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Francoise,</p><p>I&apos;ve tried out the calculation in FTS.</p><p>The method I used was to divide the frequency of the<br/>partial by the appropriate integer:</p><p>Freq.        Amp. (db)    Cents</p><p>234.016057   100          0<br/>....<br/>1871.58289   60.7936076   3599.49542</p><p>1871.58289/8 - 234.016057<br/>= 233.947861 - 234.016057<br/>=  -0.068196</p><p>So the higher partials will give increasingly more accurate values<br/>for the pitch of the fundamental, assuming they are exact multiples<br/>of the fundamental.</p><p>E.g if they are accurate to within 1 Hz, then on dividing by 8, you get<br/>a value accurate to within 0.125 Hz.</p><p>When the higher partials are all exact, it might be an idea to weight<br/>the count to preferentially use the higher partials. Maybe count the<br/>nth partial n times?</p><p>Perhaps weighting them all evenly is a reasonable compromise between<br/>preferring the higher ones as the more exact measurements, and preferring<br/>the lowest ones as possibly more likely to be exact multiples of the<br/>pitch for real timbres.</p><p>For the standard deviations, we need a good value for the fundamental<br/>in order to tell if the high partials are accurate. If all the<br/>partials were only known to 1 hz and one multiplied the measured fundamental<br/>by 8 to compare it with the 8th partial, that introduces a possibly<br/>9 Hz difference in frequencies between the two (8 Hz for the fundamental<br/>and 1 Hz for the 8th partial).</p><p>So instead, I used the new adjusted value<br/>for the fundamental, and assumed that is accurate enough to do<br/>the job. This will at worst slightly over-estimate the SD if it<br/>is inaccurate (by using an estimator for the mean that is offset from the<br/>true value).</p><p>Another possibility would have been to instead divide each partial<br/>by the appropriate integer to compare with the original fundamental, and<br/>finding the SD of the differences of those instead, but that<br/>would have seriously underestimated the SD. So I think this is<br/>prob. the best way.</p><p>Here is the result for jerry00:</p><p>Search for harmonic timbres with leeway of 5 hz - 3 fundamentals found</p><p>Fundamental  Mean diff    New Freq.    Cents        SD Hz        SD cents     Partials</p><p>234.01606    -0.059567529 233.95649    0            0.07022305   0.5195594          29<br/>292.52133    -0.073896311 292.44743    386.32448    0.047917301  0.28363822         19<br/>351.03179    -0.088819712 350.94297    701.99563    0.076143648  0.3755829          10</p><p>Mean diff = mean diff from fundamental after dividing freq for nth partial by n<br/>SD = for the differences after subtracting nth partial from n times  new freq. for fundamental</p><p>Jerry01:</p><p>Fundamental  Mean diff    New Freq.    Cents        SD Hz        SD cents     Partials</p><p>234.016047   -0.0599432   233.956104   0            0.0738842    0.546644            21<br/>295.393103   -0.0018082   295.391294   403.667329   0.0904079    0.5297827           22<br/>351.03558    -0.0943342   350.941246   701.989977   0.0971456    0.4791643           17</p><p>Robert</p></div><h3><a id=35844 href="#35844">ðŸ”—</a>paulerlich &#x3C;paul@stretch-music.com&#x3E;</h3><span>3/21/2002 4:23:49 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In tuning@y..., &quot;Robert Walker&quot; &lt;robertwalker@n...&gt; wrote:</p><p>&gt; Here is the result for jerry00:<br/>&gt;<br/>&gt; Search for harmonic timbres with leeway of 5 hz - 3 fundamentals<br/>found<br/>&gt;<br/>&gt; Fundamental  Mean diff    New Freq.    Cents        SD Hz        SD<br/>cents     Partials<br/>&gt;<br/>&gt; 234.01606    -0.059567529 233.95649    0            0.07022305<br/>0.5195594          29<br/>&gt; 292.52133    -0.073896311 292.44743    386.32448    0.047917301<br/>0.28363822         19<br/>&gt; 351.03179    -0.088819712 350.94297    701.99563    0.076143648<br/>0.3755829          10<br/>&gt;<br/>&gt;<br/>&gt; Mean diff = mean diff from fundamental after dividing freq for nth<br/>partial by n<br/>&gt; SD = for the differences after subtracting nth partial from n<br/>times  new freq. for fundamental<br/>&gt;<br/>&gt; Jerry01:<br/>&gt;<br/>&gt; Fundamental  Mean diff    New Freq.    Cents        SD Hz        SD<br/>cents     Partials<br/>&gt;<br/>&gt; 234.016047   -0.0599432   233.956104   0            0.0738842<br/>0.546644            21<br/>&gt; 295.393103   -0.0018082   295.391294   403.667329   0.0904079<br/>0.5297827           22<br/>&gt; 351.03558    -0.0943342   350.941246   701.989977   0.0971456<br/>0.4791643           17<br/>&gt;<br/>&gt; Robert</p><p>looks like you&apos;re nailing it now. note that this does not violate the<br/>classical uncertainty principle, since here it&apos;s *given* that the<br/>signal is to be interpreted as frequencies unchanging over time<br/>(while in many situations that wouldn&apos;t be the case), plus it&apos;s<br/>*given* that the partials are exactly harmonic (while in many<br/>situations *that* wouldn&apos;t be the case).</p><p>congratulations on your achievement here!</p></div><h3><a id=35852 href="#35852">ðŸ”—</a>LAFERRIERE Fran&#xE7;ois &#x3C;francois.laferriere@cegetel.fr&#x3E;</h3><span>3/22/2002 1:38:47 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>HI Robert</p><p>Robert Walker wrote:<br/>&gt; So the higher partials will give increasingly more accurate values<br/>&gt; for the pitch of the fundamental, assuming they are exact multiples<br/>&gt; of the fundamental.<br/>&gt;<br/>&gt; E.g if they are accurate to within 1 Hz, then on dividing by<br/>&gt; 8, you get<br/>&gt; a value accurate to within 0.125 Hz.</p><p>That exactly what I think.</p><p>&gt; When the higher partials are all exact, it might be an idea to weight<br/>&gt; the count to preferentially use the higher partials. Maybe count the<br/>&gt; nth partial n times?</p><p>&gt; Perhaps weighting them all evenly is a reasonable compromise between<br/>&gt; preferring the higher ones as the more exact measurements,<br/>&gt; and preferring<br/>&gt; the lowest ones as possibly more likely to be exact multiples of the<br/>&gt; pitch for real timbres.</p><p>That looks like an excellent idea!! I will probably try to use it on my<br/>natural voice analysis. Up to now, I made no such weighting, I made a manual<br/>confidence interval estimation based on the broadness of the peak, divide it<br/>by N (the harmonic number) ant take the &quot;most reliable&quot;. Perhaps the<br/>weighting method you propose may be of some help to increase the accuracy of<br/>my measurement.</p><p>&gt;<br/>&gt; For the standard deviations, we need a good value for the fundamental<br/>&gt; in order to tell if the high partials are accurate. If all the<br/>&gt; partials were only known to 1 hz and one multiplied the<br/>&gt; measured fundamental<br/>&gt; by 8 to compare it with the 8th partial, that introduces a possibly<br/>&gt; 9 Hz difference in frequencies between the two (8 Hz for the<br/>&gt; fundamental<br/>&gt; and 1 Hz for the 8th partial).<br/>&gt;</p><p>Seemingly this really improved the accuracy of the results. I totally agree<br/>with Paul Erlich:</p><p>&gt; looks like you&apos;re nailing it now. note that this does not violate the<br/>&gt; classical uncertainty principle, since here it&apos;s *given* that the<br/>&gt; signal is to be interpreted as frequencies unchanging over time<br/>&gt; (while in many situations that wouldn&apos;t be the case), plus it&apos;s<br/>&gt; *given* that the partials are exactly harmonic (while in many<br/>&gt; situations *that* wouldn&apos;t be the case).<br/>&gt;<br/>&gt; congratulations on your achievement here!</p><p>I can only share Paul&apos;s enthousiasm for your excellent work on this.</p><p>Fran&ccedil;ois Laferri&egrave;re</p></div>
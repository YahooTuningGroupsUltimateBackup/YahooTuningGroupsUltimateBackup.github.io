<a href="/tuning">back to list</a><h1>From wedgies to mappings?</h1><h3>Petr Pa&#x159;&#xED;zek &#x3C;p.parizek@...&#x3E;</h3><span>7/16/2009 10:48:53 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi tuners,</p><p>a few years ago, there was some discussion here about converting period/generator mappings into wedgies. But how can I do the opposite? Anyone who could help?</p><p>Thanks in advance.</p><p>Petr</p></div><h3>Herman Miller &#x3C;hmiller@...&#x3E;</h3><span>7/16/2009 8:13:57 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Petr Pa&rcaron;&iacute;zek wrote:<br/>&gt; Hi tuners,<br/>&gt; &gt; a few years ago, there was some discussion here about converting &gt; period/generator mappings into wedgies. But how can I do the opposite? &gt; Anyone who could help?<br/>&gt; &gt; Thanks in advance.<br/>&gt; &gt; Petr</p><p>I know a method, but it&apos;s not very straightforward. Maybe someone can figure out a better way.</p><p>For convenience, I&apos;ll notate the period, generator, and wedgie as follows (taking a 7-limit example):</p><p>&lt;p2 p3 p5 p7]<br/>&lt;g2 g3 g5 g7]<br/>&lt;&lt;w2,3 w2,5 w2,7 w3,5 w3,7 w5,7]]</p><p>First, if we assume the usual convention for period/generator mappings (the octave is a period or multiple of periods), we can find the number of periods in an octave by finding the greatest common divisor of the first few wedgie components (the ones starting with w2). Then the number of generators is zero.</p><p>p2 = GCD(w2,3 w2,5 w2,7)<br/>g2 = 0</p><p>The first few wedgie components (the ones starting with w2) then give the generator mapping (when divided by the GCD).</p><p>g3 = w2,3 / p2<br/>g5 = w2,5 / p2<br/>g7 = w2,7 / p2</p><p>Here&apos;s where it gets tricky. In general, there&apos;s more than one possible value for p3 that can work. Take the example of meantone, where the generator can be considered as either a fourth or a fifth; if it&apos;s a fifth, p3 = 1, but if it&apos;s a fourth, p3 = 2 and the generator is negative. I.e.,</p><p>&lt;1, 1, 0, -3] octave<br/>&lt;0, 1, 4, 10] fifth</p><p>&lt;1, 2, 4, 7]     octave<br/>&lt;0, -1, -4, -10] fourth</p><p>So there&apos;s not a unique solution; you need to find an appropriate value for p3 that results in integer values for p5 and p7, while keeping the size of the generator within the desired range (e.g. less than half the period).</p><p>Take miracle as an example:</p><p>&lt;&lt;6, -7, -2, -25, -20, 15]]</p><p>p2 = 1 (the GCD of 6, 7, and 2)<br/>g3 = 6 (or -6)<br/>g5 = -7 (or 7)<br/>g7 = -2 (or 2)</p><p>By trial and error you can find that p3 = 1 results in integer values for p5 and p7. Once you have p3, note that w3,5 = p3g5 - p5g3, so p5 = (p3g5 - w3,5) / g3, and p7 = (p3g7 - w3,7) / g3.</p><p>(If g3 = 0, skip p3 and start with p5, or the first one with a non-zero number of generators...)</p></div><h3>Graham Breed &#x3C;gbreed@...&#x3E;</h3><span>7/19/2009 12:00:52 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>2009/7/16 Petr Pa&rcaron;&iacute;zek &lt;p.parizek@...&gt;:</p><p>&gt; a few years ago, there was some discussion here about converting<br/>&gt; period/generator mappings into wedgies. But how can I do the opposite?<br/>&gt; Anyone who could help?</p><p>Did this come up here or on tuning-math in that past year?  The<br/>easiest way is, of course, not to start from there ;-)  Anyway, it can<br/>be done.</p><p>The wedgie is the distinct entries from a matrix like this:</p><p>(  0  w1  w2  w3)<br/>(-w1   0  w4  w5)<br/>(-w2 -w4   0   w6)<br/>(-w3 -w5 -w6   0)</p><p>The details will be different for different sizes, but it&apos;s the same<br/>pattern.  You take any two linearly independent rows of that matrix<br/>and you get a mapping, which may have contorsion.  Getting a mapping<br/>without contorsion is a problem I still haven&apos;t solved.  (If the rows<br/>aren&apos;t linearly dependent, you&apos;ll get a row of zeros when you try to<br/>reduce them.  So try a different choice.)</p><p>If you have a library for doing exterior algebra, you can choose a<br/>&quot;chromatic unison vector&quot; (or whatever we&apos;re supposed to call them),<br/>wedge it with the comma-space version of the wedgie, and take the<br/>complement.  That gets you the mapping for an equal temperament that<br/>you can use to find the rank 2 mapping.  Note that using an octave as<br/>an &quot;equivalence vector&quot; (something like a unison vector that isn&apos;t<br/>unisonous) gets you the octave-equivalent part of the mapping<br/>multiplied by the number of periods to an octave.</p><p>You can also solve a system of linear equations, probably as explained<br/>here (I haven&apos;t checked that in detail, but I think a good algorithm<br/>was there before):</p><p><a href="http://en.wikipedia.org/wiki/Euclidean_subspace#Null_space_of_a_matrix">http://en.wikipedia.org/wiki/Euclidean_subspace#Null_space_of_a_matrix</a></p><p>I&apos;m not sure where those equations came from.  A while back I found a<br/>thread (sorry, no reference now) where Gene Smith thought it was so<br/>obvious that he wouldn&apos;t explain it to me.  And Paul Erlich thought<br/>the algorithm to solve the equations was so obvious that he wouldn&apos;t<br/>explain that either.  It&apos;s taken me a few years to work out what they<br/>were probably talking about but I still get contorsion.  And I&apos;d<br/>rather not start with wedgies.</p><p>              Graham</p></div><h3>Carl Lumma &#x3C;carl@...&#x3E;</h3><span>7/20/2009 6:27:45 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, Graham Breed &lt;gbreed@...&gt; wrote:</p><p>&gt; I&apos;m not sure where those equations came from.  A while back I found a<br/>&gt; thread (sorry, no reference now) where Gene Smith thought it was so<br/>&gt; obvious that he wouldn&apos;t explain it to me.  And Paul Erlich thought<br/>&gt; the algorithm to solve the equations was so obvious that he wouldn&apos;t<br/>&gt; explain that either.  It&apos;s taken me a few years to work out what they<br/>&gt; were probably talking about but I still get contorsion.  And I&apos;d<br/>&gt; rather not start with wedgies.<br/>&gt;<br/>&gt;               Graham</p><p>Here is some Gene code that may be helpful:</p><p>ml7 := proc(l)<br/># mapping list for 7-limit wedgie<br/>local a;<br/>a := convert(ihermite(lval7(l)), listlist);<br/>fx7([a[1],a[2]]) end:</p><p>listlist looks like a maple datatype, to which the<br/>output of ihermite is being cast.  ihermite is<br/>described here:</p><p><a href="http://www.maplesoft.com/support/help/view.aspx?sid=24763">http://www.maplesoft.com/support/help/view.aspx?sid=24763</a></p><p>Here&apos;s lval7:</p><p>lval7 := proc(l)<br/># subgroup vals of 7-limit wedgie<br/>[[0, -l[1], -l[2], -l[3]], [l[1], 0, -l[4], -l[5]],<br/>[l[2], l[4], 0, -l[6]], [l[3], l[5], l[6], 0]] end:</p><p>Rest of the functions:</p><p>fx7 := proc(m)<br/># reduction of 7-limit mapping in listlist form<br/>local k,n;<br/>k := m;<br/>n := [[0,0,0,0], [0,0,0,0]];<br/>while not k=n do<br/>n := k;<br/>k := fxx7(n) od;<br/>RETURN(k) end:</p><p>fxx7 := proc(m)<br/>local g, u;<br/>u := m;<br/>g := gf7(transpose(matrix(m)));<br/>if g[1]&lt;0 then<br/>RETURN([-u[1],u[2]]) fi;<br/>if g[2]&lt;0 then<br/>RETURN([u[1],-u[2]]) fi;<br/>if g[1]&lt;g[2] then<br/>RETURN([u[1]+u[2], u[2]]) fi;<br/>if g[1]&lt;2*g[2] then<br/>RETURN([u[1]+u[2], -u[2]]) fi;<br/>RETURN(u) end:</p><p>gf7 := proc(m)<br/># 7-limit linear temperament least squares<br/>local l;<br/>l:= ge7(m);<br/>[1200*evalf(l[1]), 1200*evalf(l[2])] end:</p><p>ge7 := proc(m)<br/>local r,s,t, u;<br/>t := tl7(m);<br/>if m[1,1]=0 then print(&grave;Invalid matrix&grave;) else<br/>r := subs(a=1/m[1,1], t) fi;<br/>u := simplify(solve(diff(r,b)));<br/>[1/m[1,1], u] end:</p><p>So I think this first finds the &quot;subgroup vals&quot; of the<br/>wedgie, converts them (when taken as a matrix) to hermite<br/>normal form, and finally fxx7s that matrix until just<br/>before it turns into a matrix of zeros.  Exactly what<br/>fxx7 does is a bit of a mystery, but apparently it&apos;s<br/>finding least-squares fittings of something (generators?).</p><p>-Carl</p></div><h3>Carl Lumma &#x3C;carl@...&#x3E;</h3><span>7/20/2009 11:15:22 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>I wrote:</p><p>&gt; ge7 := proc(m)<br/>&gt; local r,s,t, u;<br/>&gt; t := tl7(m);<br/>&gt; if m[1,1]=0 then print(&grave;Invalid matrix&grave;) else<br/>&gt; r := subs(a=1/m[1,1], t) fi;<br/>&gt; u := simplify(solve(diff(r,b)));<br/>&gt; [1/m[1,1], u] end:</p><p>Whoops, forgot tl7.</p><p>tl7 := proc(m)<br/>local i, t, v;<br/>t := 0;<br/>for i from 1 to 6 do<br/>v := matrix(1,4,[ordp(in7[i], 2), ordp(in7[i], 3), ordp(in7[i],5), ordp(in7[i], 7)]);<br/>v := evalm(v &amp;* m);<br/>t := t + (v[1,1]*a + v[1,2]*b - ll(in7[i]))^2 od;<br/>t end:</p><p>Here&apos;s ordp:</p><p><a href="http://www.maplesoft.com/support/help/view.aspx?path=padic/ordp">http://www.maplesoft.com/support/help/view.aspx?path=padic/ordp</a></p><p>Natch, this leads to in7, which, incredibly, is the end<br/>of the line:</p><p>in7 := {3, 5, 7, 5/3, 7/3, 7/5}:</p><p>-Carl</p></div><h3>Graham Breed &#x3C;gbreed@...&#x3E;</h3><span>7/21/2009 12:46:39 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>2009/7/21 Carl Lumma &lt;carl@...&gt;:</p><p>&gt; Here is some Gene code that may be helpful:</p><p>There was some code like this in the thread I remember as well.</p><p>&gt; ml7 := proc(l)<br/>&gt; # mapping list for 7-limit wedgie<br/>&gt; local a;<br/>&gt; a := convert(ihermite(lval7(l)), listlist);<br/>&gt; fx7([a[1],a[2]]) end:<br/>&gt;<br/>&gt; listlist looks like a maple datatype, to which the<br/>&gt; output of ihermite is being cast. &nbsp;ihermite is<br/>&gt; described here:<br/>&gt;<br/>&gt; <a href="http://www.maplesoft.com/support/help/view.aspx?sid=24763">http://www.maplesoft.com/support/help/view.aspx?sid=24763</a></p><p>Unfortunately that documentation&apos;s inadequate.  It doesn&apos;t define what<br/>Hermite Normal Form (HNF) is, other than being the same as reduced row<br/>echelon form.  But the matrix &quot;B&quot; is plainly not in reduced row<br/>echelon form.  So the function does something else, probably useful,<br/>but exactly what we can only guess at.</p><p>Gene claimed it was this function that removed the torsion.  Maybe it<br/>does.  The documentation doesn&apos;t say anything about that.  It does say<br/>&quot;The Hermite normal form is obtained by doing elementary row<br/>operations. This includes interchanging rows, multiplying through a<br/>row by -1, and adding an integral multiple of one row to another.&quot;<br/>which is guaranteed to *preserve* torsion.</p><p>&gt; Here&apos;s lval7:<br/>&gt;<br/>&gt; lval7 := proc(l)<br/>&gt; # subgroup vals of 7-limit wedgie<br/>&gt; [[0, -l[1], -l[2], -l[3]], [l[1], 0, -l[4], -l[5]],<br/>&gt; [l[2], l[4], 0, -l[6]], [l[3], l[5], l[6], 0]] end:</p><p>That&apos;s the matrix with zero diagonals I gave before.  You can get it<br/>by treating each of the primes as something like a unison vector.<br/>It&apos;s also easy to produce directly from the wedgie, for any number of<br/>prime dimensions, which I hadn&apos;t noticed in the original thread.</p><p>&gt; So I think this first finds the &quot;subgroup vals&quot; of the<br/>&gt; wedgie, converts them (when taken as a matrix) to hermite<br/>&gt; normal form, and finally fxx7s that matrix until just<br/>&gt; before it turns into a matrix of zeros. &nbsp;Exactly what<br/>&gt; fxx7 does is a bit of a mystery, but apparently it&apos;s<br/>&gt; finding least-squares fittings of something (generators?).</p><p>I don&apos;t know what the fxx7 is about, I haven&apos;t seen it before.  It<br/>looks like he&apos;s finding a least squares tuning instead of simply<br/>returning the mapping.</p><p>The point of the HNF is that a rank 2 temperament will always have two<br/>non-zero rows in its HNF (that is the HNF of a matrix containing a<br/>load of mappings for it), which will always be at the top.  So if you<br/>don&apos;t know which rows of the original matrix are linearly independent,<br/>you just find the HNF of all of them, and take the top two rows.  The<br/>problem is that will introduce spurious contorsion.  Gene claimed he<br/>got rid of contorsion and I&apos;d still like to know how he did it.</p><p>                  Graham</p></div><h3>Carl Lumma &#x3C;carl@...&#x3E;</h3><span>7/21/2009 11:34:15 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt; &gt; ihermite is<br/>&gt; &gt; described here:<br/>&gt; &gt;<br/>&gt; &gt; <a href="http://www.maplesoft.com/support/help/view.aspx?sid=24763">http://www.maplesoft.com/support/help/view.aspx?sid=24763</a><br/>&gt;<br/>&gt; Unfortunately that documentation&apos;s inadequate.  It doesn&apos;t define<br/>&gt; what Hermite Normal Form (HNF) is, other than being the same as<br/>&gt; reduced row echelon form.  But the matrix &quot;B&quot; is plainly not in<br/>&gt; reduced row echelon form.  So the function does something else,<br/>&gt; probably useful, but exactly what we can only guess at.</p><p>Just wait till you see the docs for ordp.  Do you understand<br/>p-adic evaluations?  I looked that up on wikipedia and my head<br/>almost exploded.</p><p>A search for &quot;hermite&quot; on tuning-math would probably be very<br/>helpful.  In addition, you can see this page:</p><p><a href="http://lumma.org/tuning/gws/hermbas.htm">http://lumma.org/tuning/gws/hermbas.htm</a></p><p>&gt; &gt; So I think this first finds the &quot;subgroup vals&quot; of the<br/>&gt; &gt; wedgie, converts them (when taken as a matrix) to hermite<br/>&gt; &gt; normal form, and finally fxx7s that matrix until just<br/>&gt; &gt; before it turns into a matrix of zeros.  Exactly what<br/>&gt; &gt; fxx7 does is a bit of a mystery, but apparently it&apos;s<br/>&gt; &gt; finding least-squares fittings of something (generators?).<br/>&gt;<br/>&gt; I don&apos;t know what the fxx7 is about, I haven&apos;t seen it before.  It<br/>&gt; looks like he&apos;s finding a least squares tuning instead of simply<br/>&gt; returning the mapping.<br/>&gt;<br/>&gt; The point of the HNF is that a rank 2 temperament will always<br/>&gt; have two non-zero rows in its HNF (that is the HNF of a matrix<br/>&gt; containing a load of mappings for it), which will always be at<br/>&gt; the top.  So if you don&apos;t know which rows of the original matrix<br/>&gt; are linearly independent, you just find the HNF of all of them,<br/>&gt; and take the top two rows.  The problem is that will introduce<br/>&gt; spurious contorsion.  Gene claimed he got rid of contorsion and<br/>&gt; I&apos;d still like to know how he did it.</p><p>Here&apos;s the blurb from his site where he explains it:</p><p>&quot;&quot;By reducing the wedge product, we eliminate the possibility<br/>that our mappings are not epimorphisms. For instance, we might<br/>take h2 = &lt;2 3 5| and h8 = &lt;8 13 19|, and hope to produce an<br/>icon by [h2, h8]. However, h2+h8 = &lt;10 16 24|; hence the sum<br/>of the two coordinates is always even, and the mapping is not<br/>epimorphic. The cokernel of the mapping is a cyclic group of<br/>order two, so we may say this mapping has torsion problems.</p><p>&quot;&quot;Taking wedge products gives us h2/\h8 = &lt;&lt;2 -2 -8||; the<br/>complement of this is |-8 2 2&gt;, which represents<br/>225/256 = (15/16)^2; hence the wedgie is &lt;&lt;1 -1 -4||, which<br/>we may equate with |-4 1 1&gt;, or 15/16; reducing this a<br/>standard form where the comma in question is greater than<br/>one gives 16/15. If we now find an icon which gives this<br/>for a wedgie, we have eliminated the torsion problem.<br/>All such icons will have the same wedgie, so 16/15 defines<br/>a 5-limit linear temperament (the fourth-thirds temperament.)&quot;&quot;</p><p>Everything is easy except the magic step where we &quot;find<br/>the icon that gives this for a wedgie&quot;.  The icon is the<br/>mapping.</p><p>-Carl</p></div><h3>Graham Breed &#x3C;gbreed@...&#x3E;</h3><span>7/21/2009 2:04:46 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>2009/7/21 Carl Lumma &lt;carl@...&gt;:</p><p>&gt; Just wait till you see the docs for ordp. &nbsp;Do you understand<br/>&gt; p-adic evaluations? &nbsp;I looked that up on wikipedia and my head<br/>&gt; almost exploded.</p><p>The best reference for p-adic valuations (no &quot;e&quot;) is in the Valuation<br/>(algebra) entry:</p><p><a href="http://en.wikipedia.org/wiki/Valuation_(algebra)#p-adic_valuation">http://en.wikipedia.org/wiki/Valuation_(algebra)#p-adic_valuation</a></p><p>But, no, I still don&apos;t understand it.</p><p>&gt; A search for &quot;hermite&quot; on tuning-math would probably be very<br/>&gt; helpful. &nbsp;In addition, you can see this page:<br/>&gt;<br/>&gt; <a href="http://lumma.org/tuning/gws/hermbas.htm">http://lumma.org/tuning/gws/hermbas.htm</a></p><p>I&apos;ve been on tuning-math since the start.  I even went through the<br/>archive last year.  All I find is myself asking the questions I still<br/>want answered.</p><p>That page doesn&apos;t define Hermite Normal Form.  It points to Mathworld,<br/>which says &quot;Given a square  nonsingular integer matrix...&quot;  Well,<br/>great, unfortunately square nonsingular matrices don&apos;t correspond to<br/>temperaments, by definition.  But, still, make some common sense<br/>generalizations and you get a good standard form for the mapping.<br/>Defining the off-diagonal entries to be non-negative instead of<br/>non-positive is better, and the Maple examples show that&apos;s what<br/>they&apos;re doing.  Doesn&apos;t help get rid of torsion.</p><p>&gt; Here&apos;s the blurb from his site where he explains it:</p><p>&lt;snip&gt;</p><p>&gt; Everything is easy except the magic step where we &quot;find<br/>&gt; the icon that gives this for a wedgie&quot;. &nbsp;The icon is the<br/>&gt; mapping.</p><p>That&apos;s it.  Everything&apos;s easy except for the problem we&apos;re trying to<br/>solve, which is swept under the carpet.</p><p>                    Graham</p></div>
<a href="/tuning">back to list</a><h1>Csound expseg function</h1><h3><a id=63242 href="#63242">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>12/30/2005 2:00:12 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Can anyone explain to me exactly what exponential<br/>function Csound uses for the expseg opcode?</p><p>That is, if i want to graph the function, say on<br/>an Excel spreadsheet, how do it get the y-value<br/>for each x-value?</p><p>I&apos;ve looked around in everything i have on Csound<br/>and don&apos;t see this explained in detail anywhere.</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=63244 href="#63244">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>12/30/2005 2:04:51 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, &quot;monz&quot; &lt;monz@t...&gt; wrote:<br/>&gt;<br/>&gt;<br/>&gt; Can anyone explain to me exactly what exponential<br/>&gt; function Csound uses for the expseg opcode?<br/>&gt;<br/>&gt; That is, if i want to graph the function, say on<br/>&gt; an Excel spreadsheet, how do it get the y-value<br/>&gt; for each x-value?</p><p>Of course, i meant to specify that the x-value is time<br/>and the y-value is amplitude.</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=63250 href="#63250">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>12/30/2005 5:57:02 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, &quot;monz&quot; &lt;monz@t...&gt; wrote:<br/>&gt;<br/>&gt; --- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, &quot;monz&quot; &lt;monz@t...&gt; wrote:<br/>&gt; &gt;<br/>&gt; &gt;<br/>&gt; &gt; Can anyone explain to me exactly what exponential<br/>&gt; &gt; function Csound uses for the expseg opcode?<br/>&gt; &gt;<br/>&gt; &gt; That is, if i want to graph the function, say on<br/>&gt; &gt; an Excel spreadsheet, how do it get the y-value<br/>&gt; &gt; for each x-value?<br/>&gt;<br/>&gt;<br/>&gt; Of course, i meant to specify that the x-value is time<br/>&gt; and the y-value is amplitude.</p><p>OK, i guess i can make this a little easier by supplying<br/>some data.</p><p>The scale of the values is arbitrary ... i set up a<br/>Csound expseg envelope which makes the amplitude decay<br/>exponentially from a maximum of 1.94 at 0.1 second<br/>to a minimum close to zero at 4.9 seconds.</p><p>After rendering the Csound file into a .wav file,<br/>i did an analysis of it by taking:</p><p>* 0.1-second snapshots up from 0.1-0.2 to 1.2-1.3 seconds,</p><p>* a 0.2-second snapshot from 1.3-1.5 seconds,</p><p>* 0.5-second snapshots for 1.5-2.0, 2.0-2.5, and 2.5-3.0 seconds,</p><p>* 1-second snapshots for 3.0-4.0 and 4.0-5.0 seconds.</p><p>The only reason i didn&apos;t keep the snapshot size consistent<br/>was because it&apos;s a lot of work doing 0.1-second snapshots,<br/>and (because of the exponential function) the decay levels<br/>off quite a lot by the time the signal reaches ~2 seconds.</p><p>So here&apos;s my data:</p><p>time .. value<br/>0.1 .. 1.940<br/>0.2 .. 1.757<br/>0.3 .. 1.589<br/>0.4 .. 1.432<br/>0.5 .. 1.291<br/>0.6 .. 1.164<br/>0.7 .. 1.054<br/>0.8 .. 0.950<br/>0.9 .. 0.856<br/>1.0 .. 0.772<br/>1.1 .. 0.699<br/>1.2 .. 0.630</p><p>1.3 .. 0.545</p><p>1.5 .. 0.389<br/>2.0 .. 0.233<br/>2.5 .. 0.139</p><p>3.0 .. 0.068<br/>4.0 .. 0.024</p><p>What is the exponential function which produces that<br/>kind of curve?</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=63253 href="#63253">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>12/31/2005 6:08:59 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On 12/31/05, monz &lt;<a href="mailto:monz@tonalsoft.com">monz@tonalsoft.com</a>&gt; wrote:</p><p>&gt; The scale of the values is arbitrary ... i set up a<br/>&gt; Csound expseg envelope which makes the amplitude decay<br/>&gt; exponentially from a maximum of 1.94 at 0.1 second<br/>&gt; to a minimum close to zero at 4.9 seconds.</p><p>I&apos;ll need to know how close to zero to answer this.  An exponential<br/>decay should be</p><p>y = exp(-xt)</p><p>where t is time and x is the decay constant.  In this case,</p><p>y = exp(-x(t-0.1))</p><p>because you start at 0.1.  x can be guessed as</p><p>log(1.94/0.024)/3.9=1.126253697874212...</p><p>with natural logarithms, but would ideally be</p><p>log(1.94/something)/4.8</p><p>where &quot;something&quot; is the &quot;close to zero&quot; you set 4.9 seconds to</p><p>&gt; The only reason i didn&apos;t keep the snapshot size consistent<br/>&gt; was because it&apos;s a lot of work doing 0.1-second snapshots,<br/>&gt; and (because of the exponential function) the decay levels<br/>&gt; off quite a lot by the time the signal reaches ~2 seconds.</p><p>This isn&apos;t a plain exponential, although it&apos;s close to start with.  I<br/>can&apos;t work out what&apos;s happening from the source.  It seems to guess<br/>the decay per time slice and do repeated multiplication.  That should<br/>still be more consistent to an exponential decay than what you&apos;ve<br/>given.  Perhaps it tries to round of the segment boundaries.  If you<br/>really want to know what&apos;s happening you&apos;ll have to bring it up on the<br/>Csound list.</p><p>                       Graham</p></div><h3><a id=63254 href="#63254">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>12/31/2005 7:03:26 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Graham,</p><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, Graham Breed &lt;gbreed@g...&gt; wrote:<br/>&gt;<br/>&gt; On 12/31/05, monz &lt;monz@t...&gt; wrote:<br/>&gt;<br/>&gt; &gt; The scale of the values is arbitrary ... i set up a<br/>&gt; &gt; Csound expseg envelope which makes the amplitude decay<br/>&gt; &gt; exponentially from a maximum of 1.94 at 0.1 second<br/>&gt; &gt; to a minimum close to zero at 4.9 seconds.<br/>&gt;<br/>&gt; I&apos;ll need to know how close to zero to answer this.<br/>&gt; An exponential decay should be<br/>&gt;<br/>&gt; y = exp(-xt)<br/>&gt;<br/>&gt; where t is time and x is the decay constant.  In this case,<br/>&gt;<br/>&gt; y = exp(-x(t-0.1))<br/>&gt;<br/>&gt; because you start at 0.1.  x can be guessed as</p><p>0.1 is the time of the peak value ... everything before<br/>that is &quot;attack&quot;, so it&apos;s less than the peak.</p><p>&gt; log(1.94/0.024)/3.9=1.126253697874212...<br/>&gt;<br/>&gt; with natural logarithms, but would ideally be<br/>&gt;<br/>&gt; log(1.94/something)/4.8<br/>&gt;<br/>&gt; where &quot;something&quot; is the &quot;close to zero&quot; you set 4.9 seconds to</p><p>Ah, thanks!</p><p>My &quot;something&quot; was 0.00003, but i&apos;ll probably switch<br/>to 0.00001 if it works OK.</p><p>Where does the 1.94 come from? Is it some function of e?</p><p>&gt; &gt; The only reason i didn&apos;t keep the snapshot size consistent<br/>&gt; &gt; was because it&apos;s a lot of work doing 0.1-second snapshots,<br/>&gt; &gt; and (because of the exponential function) the decay levels<br/>&gt; &gt; off quite a lot by the time the signal reaches ~2 seconds.<br/>&gt;<br/>&gt; This isn&apos;t a plain exponential, although it&apos;s close to<br/>&gt; start with.  I can&apos;t work out what&apos;s happening from the<br/>&gt; source.  It seems to guess the decay per time slice and<br/>&gt; do repeated multiplication.  That should still be more<br/>&gt; consistent to an exponential decay than what you&apos;ve<br/>&gt; given.  Perhaps it tries to round of the segment boundaries.</p><p>My data is quantized to 0.1 seconds or even more ...<br/>i&apos;m sure that on a per-sample basis you&apos;d get a much<br/>better picture of what&apos;s happening.</p><p>&gt; If you really want to know what&apos;s happening you&apos;ll have<br/>&gt; to bring it up on the Csound list.</p><p>I know ... i&apos;ve been trying to avoid joining yet another list.</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=63256 href="#63256">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>12/31/2005 11:13:02 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt; My &quot;something&quot; was 0.00003, but i&apos;ll probably switch<br/>&gt; to 0.00001 if it works OK.<br/>&gt;<br/>&gt; Where does the 1.94 come from? Is it some function of e?</p><p>It&apos;s your peak.</p><p>&gt; My data is quantized to 0.1 seconds or even more ...<br/>&gt; i&apos;m sure that on a per-sample basis you&apos;d get a much<br/>&gt; better picture of what&apos;s happening.</p><p>If it&apos;s a true exponential decay, it should be possible to tell what&apos;s<br/>happening from 3 data points.  And the whole thing should look like<br/>this:</p><p>0.1 1.940000<br/>0.2 1.540207<br/>0.3 1.222804<br/>0.4 0.970810<br/>0.5 0.770747<br/>0.6 0.611912<br/>0.7 0.485810<br/>0.8 0.385695<br/>0.9 0.306212<br/>1.0 0.243108<br/>1.1 0.193009<br/>1.2 0.153234<br/>1.3 0.121655<br/>1.4 0.096585<br/>1.5 0.076681<br/>1.6 0.060879<br/>1.7 0.048333<br/>1.8 0.038372<br/>1.9 0.030465<br/>2.0 0.024187<br/>2.1 0.019202<br/>2.2 0.015245<br/>2.3 0.012103<br/>2.4 0.009609<br/>2.5 0.007629<br/>2.6 0.006057<br/>2.7 0.004809<br/>2.8 0.003818<br/>2.9 0.003031<br/>3.0 0.002406<br/>3.1 0.001910<br/>3.2 0.001517<br/>3.3 0.001204<br/>3.4 0.000956<br/>3.5 0.000759<br/>3.6 0.000603<br/>3.7 0.000478<br/>3.8 0.000380<br/>3.9 0.000302<br/>4.0 0.000239<br/>4.1 0.000190<br/>4.2 0.000151<br/>4.3 0.000120<br/>4.4 0.000095<br/>4.5 0.000076<br/>4.6 0.000060<br/>4.7 0.000048<br/>4.8 0.000038<br/>4.9 0.000030</p><p>                               Graham</p></div><h3><a id=63265 href="#63265">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>1/1/2006 11:31:42 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, Graham Breed &lt;gbreed@g...&gt; wrote:<br/>&gt;<br/>&gt; &gt; My &quot;something&quot; was 0.00003, but i&apos;ll probably switch<br/>&gt; &gt; to 0.00001 if it works OK.<br/>&gt; &gt;<br/>&gt; &gt; Where does the 1.94 come from? Is it some function of e?<br/>&gt;<br/>&gt; It&apos;s your peak.</p><p>Oops! ... OK.</p><p>&gt; &gt; My data is quantized to 0.1 seconds or even more ...<br/>&gt; &gt; i&apos;m sure that on a per-sample basis you&apos;d get a much<br/>&gt; &gt; better picture of what&apos;s happening.<br/>&gt;<br/>&gt; If it&apos;s a true exponential decay, it should be possible<br/>&gt; to tell what&apos;s happening from 3 data points.  And the<br/>&gt; whole thing should look like this:<br/>&gt;<br/>&gt; 0.1 1.940000<br/>&gt; 0.2 1.540207<br/>&gt; 0.3 1.222804<br/>&gt; &lt;etc. - rest of data snipped&gt;</p><p>OK, thanks.</p><p>So how does your formula:</p><p>y = exp(-x(t-0.1))</p><p>translate into something that would work in an Excel<br/>spreadsheet?</p><p>IOW, to me &quot;exp&quot; is a black-box, and i want to know<br/>how it works.</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=63275 href="#63275">ðŸ”—</a>Yahya Abdal-Aziz &#x3C;yahya@melbpc.org.au&#x3E;</h3><span>1/1/2006 7:52:51 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi monz,</p><p>On Sat, 31 Dec 2005, you wrote:<br/>&gt; &gt; &gt; Can anyone explain to me exactly what exponential<br/>&gt; &gt; &gt; function Csound uses for the expseg opcode?<br/>&gt; &gt; &gt;<br/>&gt; &gt; &gt; That is, if i want to graph the function, say on<br/>&gt; &gt; &gt; an Excel spreadsheet, how do it get the y-value<br/>&gt; &gt; &gt; for each x-value?<br/>&gt; &gt;<br/>&gt; &gt; Of course, i meant to specify that the x-value is time<br/>&gt; &gt; and the y-value is amplitude.<br/>&gt;<br/>&gt; OK, i guess i can make this a little easier by supplying<br/>&gt; some data.</p><p>You bet! :-)</p><p>&gt; The scale of the values is arbitrary ... i set up a<br/>&gt; Csound expseg envelope which makes the amplitude decay<br/>&gt; exponentially from a maximum of 1.94 at 0.1 second<br/>&gt; to a minimum close to zero at 4.9 seconds.</p><p>&gt; After rendering the Csound file into a .wav file,<br/>&gt; i did an analysis of it by taking:<br/>&gt; * 0.1-second snapshots up from 0.1-0.2 to 1.2-1.3 seconds,<br/>&gt; * a 0.2-second snapshot from 1.3-1.5 seconds,<br/>&gt; * 0.5-second snapshots for 1.5-2.0, 2.0-2.5, and 2.5-3.0 seconds,<br/>&gt; * 1-second snapshots for 3.0-4.0 and 4.0-5.0 seconds.</p><p>&gt; The only reason i didn&apos;t keep the snapshot size consistent<br/>&gt; was because it&apos;s a lot of work doing 0.1-second snapshots,<br/>&gt; and (because of the exponential function) the decay levels<br/>&gt; off quite a lot by the time the signal reaches ~2 seconds.</p><p>&gt; So here&apos;s my data:</p><p>&gt; time .. value<br/>&gt; 0.1 .. 1.940<br/>&gt; 0.2 .. 1.757<br/>&gt; 0.3 .. 1.589<br/>&gt; 0.4 .. 1.432<br/>&gt; 0.5 .. 1.291<br/>&gt; 0.6 .. 1.164<br/>&gt; 0.7 .. 1.054<br/>&gt; 0.8 .. 0.950<br/>&gt; 0.9 .. 0.856<br/>&gt; 1.0 .. 0.772<br/>&gt; 1.1 .. 0.699<br/>&gt; 1.2 .. 0.630<br/>&gt; 1.3 .. 0.545<br/>&gt; 1.5 .. 0.389<br/>&gt; 2.0 .. 0.233<br/>&gt; 2.5 .. 0.139<br/>&gt; 3.0 .. 0.068<br/>&gt; 4.0 .. 0.024<br/>&gt;<br/>&gt; What is the exponential function which produces that<br/>&gt; kind of curve?</p><p>Any exponential time decay function will have the general<br/>form:</p><p>y = a exp(-bt)</p><p>Here a and b should be positive constants.</p><p>With data like yours, the usual approach if one suspects<br/>that it follows an exponential function is to simply take<br/>logs of the y values, then plot them against the t values.<br/>The points should fall approximately in a straight line<br/>with slope -b, if your hypothesis is true - see (*) below.<br/>The graph also gives a visual indication of how far from<br/>accurate the exp relationship is, by the amount of<br/>scatter of the data points about the line.  You can then<br/>define a multiplicative error function by:</p><p>err(t) = y/a exp(-bt)</p><p>then graph it (or its log) to see what form it takes.</p><p>That&apos;s the experimental approach for you!</p><p>----------------------</p><p>(*) from y = a exp(-bt), taking logs we get:<br/>log y = log a - bt, which is the equation of a<br/>straight line with slope -b and with y=a when<br/>t=0.</p><p>-------------------------------------------------------------<br/>MATHOPHOBES!  Close your eyes and skip to<br/>the CONCLUSION below (Did you open your<br/>eyes in time?)</p><p>Here&apos;s the experiment:</p><p>time .. y ........ log y<br/>0.1 .. 1.940 .. 0.663<br/>0.2 .. 1.757 .. 0.564<br/>0.3 .. 1.589 .. 0.463<br/>0.4 .. 1.432 .. 0.359<br/>0.5 .. 1.291 .. 0.255<br/>0.6 .. 1.164 .. 0.152<br/>0.7 .. 1.054 .. 0.053<br/>0.8 .. 0.950 .. -0.051<br/>0.9 .. 0.856 .. -0.155<br/>1.0 .. 0.772 .. -0.259<br/>1.1 .. 0.699 .. -0.358<br/>1.2 .. 0.630 .. -0.462<br/>1.3 .. 0.545 .. -0.607<br/>1.5 .. 0.389 .. -0.944<br/>2.0 .. 0.233 .. -1.457<br/>2.5 .. 0.139 .. -1.973<br/>3.0 .. 0.068 .. -2.688<br/>4.0 .. 0.024 .. -3.730</p><p>I get for your equation:<br/>y_est = 2.083 * exp(-0.873 * t)</p><p>What is the error in this formula?&#x9;<br/>Write&#x9;y = y_est * err, or more formally<br/>&#x9;y(t) = y_est(t) * err(t),<br/>Then&#x9;err(t) = y(t) / y_est(t)<br/>Tabulate and graph err(t) against t:&#x9;</p><p>t .. err(t)<br/>0.1 .. 1.016<br/>0.2 .. 1.004<br/>0.3 .. 0.991<br/>0.4 .. 0.975<br/>0.5 .. 0.959<br/>0.6 .. 0.944<br/>0.7 .. 0.932<br/>0.8 .. 0.917<br/>0.9 .. 0.902<br/>1.0 .. 0.887<br/>1.1 .. 0.877<br/>1.2 .. 0.862<br/>1.3 .. 0.814<br/>1.5 .. 0.692<br/>2.0 .. 0.642<br/>2.5 .. 0.592<br/>3.0 .. 0.448<br/>4.0 .. 0.379</p><p>As you can see, there is a systematic error<br/>in the data, which follows the approximate<br/>straight trend line:<br/> err(t) = 1.0472 - 0.1017 * t<br/>(with R^2 = 0.9709).</p><p>Repeating the above process to uncover the<br/>residual error, it is approximately cubic, with<br/>trend equation:<br/> err2(t) = 0.0176t^3 - 0.1036t^2 + 0.0362t + 0.975<br/>(with R^2 = 0.9551).</p><p>To this level of approximation, your data can<br/>be fitted by:</p><p>y_est = 2.083 * exp(-0.873 * t)<br/>              * (1.0472 - 0.1017 * t)<br/>              * (0.0176t^3 - 0.1036t^2 + 0.0362t + 0.975)</p><p>-------------------------------------------------------------<br/>CONCLUSION:<br/>It&apos;s a long way from being a straight exponential<br/>function!</p><p>My guess is that your long samples caused significant<br/>error in the values you got for t=2.0 and greater.<br/>Can you try using shorter (0.1s) samples for a couple<br/>of those values, and see whether they work better?<br/>Even shorter samples would be preferable, say 0.05s<br/>or even 0.02s samples at about 5 points spread across<br/>the total range (0 to 5 seconds).</p><p>Regards,<br/>Yahya</p><p>--<br/>No virus found in this outgoing message.<br/>Checked by AVG Free Edition.<br/>Version: 7.1.371 / Virus Database: 267.14.9/217 - Release Date: 30/12/05</p></div><h3><a id=63278 href="#63278">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>1/2/2006 12:33:26 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Yayha,</p><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, &quot;Yahya Abdal-Aziz&quot; &lt;yahya@m...&gt; wrote:<br/>&gt;<br/>&gt;<br/>&gt; Hi monz,<br/>&gt;<br/>&gt; On Sat, 31 Dec 2005, you wrote:<br/>&gt; &gt; &gt; &gt; Can anyone explain to me exactly what exponential<br/>&gt; &gt; &gt; &gt; function Csound uses for the expseg opcode?<br/>&gt;<br/>&gt; &lt;big snip&gt;<br/>&gt;<br/>&gt; -------------------------------------------------------------<br/>&gt; CONCLUSION:<br/>&gt; It&apos;s a long way from being a straight exponential<br/>&gt; function!<br/>&gt;<br/>&gt; My guess is that your long samples caused significant<br/>&gt; error in the values you got for t=2.0 and greater.<br/>&gt; Can you try using shorter (0.1s) samples for a couple<br/>&gt; of those values, and see whether they work better?<br/>&gt; Even shorter samples would be preferable, say 0.05s<br/>&gt; or even 0.02s samples at about 5 points spread across<br/>&gt; the total range (0 to 5 seconds).</p><p>Thanks for all the explanation of this.</p><p>The problem with doing shorter samples is that the<br/>shorter the sample becomes, the lower the resolution.<br/>There simply isn&apos;t enough time for the FFT do calculate<br/>the spectrum accurately.</p><p>Even at the 0.1-second sample length, my software can<br/>only quantize the frequency spectrum into 4096 divisions,<br/>which is far from accurate enough to get a good plot<br/>of certain partials.</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div>
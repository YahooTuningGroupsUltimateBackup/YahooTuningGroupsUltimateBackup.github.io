<a href="/tuning">back to list</a><h1>Microtonal Helmholtz-Ellis notation in Lilypond: fine-tuning</h1><h3><a id=84579 href="#84579">ðŸ”—</a>Torsten Anders &#x3C;torsten.anders@...&#x3E;</h3><span>9/7/2009 4:29:59 AM</span><div style='margin: 0px 20px; padding: 20px; background-color: #ddd'><b>Attachments</b></div>
            <div style='margin: 0px 20px; padding: 20px; background-color: #ddd'>
                <a target=_blank href=attachments/Lily-HE-accidentals.pdf>
                    Lily-HE-accidentals.pdf
                </a>
            </div>
        <div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Dear Lilyponders,</p><p>Finally, I got some microtonal notation working in Lilypond that uses a special font for the accidentals (i.e. not the usual Feta font), please see the attached example PDF file. The full Lilypond code is included at the end of this mail. This example shows a harmonic seventh chord over C (first as an &quot;arpeggio&quot; and then all notes together) using the &quot;Extended Helmholtz-Ellis JI Pitch Notation&quot; (HE for short) by Marc Sabat and Wolfgang von Schweinitz. Besides non-Feta accidentals, the example also uses accidentals that consist of multiple signs where additional signs show comma inflections (e.g., the septimal comma before the B-flat in the example, the harmonic 7th over C). The required font and further information about this notation is available at</p><p>  <a href="http://music.calarts.edu/~msabat/ms/pdfs/HE-font-2009.zip">http://music.calarts.edu/~msabat/ms/pdfs/HE-font-2009.zip</a>.</p><p>I implemented this microtonal notation by changing the notation of accidentals to markups, following an idea by Graham Breed. Doing so did not only allow for selecting a different font, but also for accidentals that consist of more than a single sign. Changing accidentals for individual notes in a chord was particularly tricky, and I used an idea by Mark Polesky for this.</p><p>Anyway, although this this approach to microtonal notation is already usable, it could use some improvements. I would be grateful for suggestions.</p><p>The main problem is the horizontal spacing. Spacing with single-sign accidentals works fine, Lilypond takes care of that automatically. However, Lilypond does not know about multiple-sign accidentals, so I somehow have to create more horizontal space for these manually. The Lily manual (<a href="http://lilypond.org/doc/v2.12/Documentation/user/lilypond/Horizontal-spacing-overview#Horizontal-spacing-overview">http://lilypond.org/doc/v2.12/Documentation/user/lilypond/Horizontal-spacing-overview#Horizontal-spacing-overview</a>) suggests as a trick to use the following code, however I could not get this approach working. What am I missing?</p><p> \once \override Score.SeparationItem #&apos;padding = #1</p><p>Instead, I globally increased the horizontal spacing (<a href="http://lilypond.org/doc/v2.12/Documentation/user/lilypond/Changing-horizontal-spacing#Changing-horizontal-spacing">http://lilypond.org/doc/v2.12/Documentation/user/lilypond/Changing-horizontal-spacing#Changing-horizontal-spacing</a>).</p><p>Any further idea to insert some additional horizonal space before a note in order to fit in complex accidentals? Spacing of multiple-sign accidentals in a chord is even more tricky...</p><p>The second issue is the readability of the Lilypond code. I defined the music function \accidental that expects a markup and sets the accidental of next note to that markup. I also started defining readable accidental names that are mapped to the respective markup. For example, the following two notes are first an untransposed C and then an E a just major third above it: with respect to the Phythagorean E it is transposed down by a syntonic comma (see the second note in the attached example).</p><p>  c<br/>  \accidental \naturalSyntonicDown<br/>  e</p><p>However, I failed to do the same for chord tones. I need to define a music function that creates the following code, but the markup should be given as an argument, as above.</p><p>\tweak #&apos;before-line-breaking #(accidental-text (markup #:sans &quot;m&quot;))</p><p>The problem might be that I do not know how to automatically translate a Lily-syntax markup (e.g., \markup{\sans &quot;m&quot;}) into the Scheme-syntax markup required here.</p><p>Of course, I also cordially welcome any other ideas for improving this approach to microtonal notation.</p><p>Thank you!</p><p>Best<br/>Torsten</p><p>--<br/>Torsten Anders<br/>Interdisciplinary Centre for Computer Music Research<br/>University of Plymouth<br/>Office: +44-1752-586219<br/>Private: +44-1752-558917<br/><a href="http://strasheela.sourceforge.net">http://strasheela.sourceforge.net</a><br/><a href="http://www.torsten-anders.de">http://www.torsten-anders.de</a></p><p>-----------------------------------------------<br/>%% Lily code (first various defs and then the score at the end)</p><p>\version &quot;2.12.00&quot;</p><p>%% Font &quot;HE&quot; must be installed (e.g., on MacOS in /Library/Fonts)<br/>%% Font HE put in as 2nd font: can be accessed as \sans<br/>\paper{<br/>#(define fonts (make-pango-font-tree &quot;Century Schoolbook L&quot;<br/>                                     &quot;HE&quot;<br/>                                     &quot;Bitstream Vera Sans Mono&quot;<br/>                        1))<br/>}</p><p>\layout {<br/>  \context<br/>  { \Score<br/>    %% more space between all notes (to allow for extra accidentals)<br/>%     \override SpacingSpanner #&apos;base-shortest-duration = #(ly:make-moment 1 32)<br/>    \override SpacingSpanner #&apos;base-shortest-duration = #(ly:make-moment 1 16)<br/>    %% all accidentals are written as markups<br/>    \override Accidental #&apos;stencil = #ly:text-interface::print<br/>    %% default is natural accidental -- causes error...<br/>    \override Accidental #&apos;text = #(markup #:sans &quot;n&quot;)<br/>  }<br/>}</p><p>#(define (modify-accidental note-grob prop-alist)<br/>  ;; notehead before-line-breaking callback<br/>  (let ((accidental (ly:grob-object note-grob &apos;accidental-grob)))<br/>   (if (not (null? accidental))<br/>    (for-each<br/>     (lambda (x)<br/>      (ly:grob-set-property! accidental (car x) (cdr x)))<br/>     prop-alist))))<br/>#(define (accidental-text markup)<br/>  (lambda (grob)<br/>   (modify-accidental grob &grave;((text . ,markup)))))</p><p>%% expects a markup and sets accidental of next note to that markup<br/>accidental =<br/>#(define-music-function (parser location markup) (markup?)<br/>  #{<br/>  \once \override Accidental #&apos;text = #$markup<br/>  #})</p><p>% %% !! Buggy<br/>% %% expects a markup and sets accidental of next chord note to that markup<br/>% chordAccidental =<br/>% #(define-music-function (parser location markup) (markup?)<br/>%   #{<br/>%   \tweak #&apos;before-line-breaking #(accidental-text #$markup)<br/>%   #})</p><p>%%<br/>%% Selection of accidentals to markups mappings, see HE-font-map.pdf provided with font<br/>%%<br/>sharp = \markup{\sans &quot;v&quot;}<br/>natural = \markup{\sans &quot;n&quot;}<br/>flat = \markup{\sans &quot;e&quot;}</p><p>sharpSyntonicUp = \markup{\sans &quot;w&quot;}<br/>naturalSyntonicUp = \markup{\sans &quot;o&quot;}<br/>flatSyntonicUp = \markup{\sans &quot;f&quot;}<br/>sharpSyntonicDown = \markup{\sans &quot;u&quot;}<br/>naturalSyntonicDown = \markup{\sans &quot;m&quot;}<br/>flatSyntonicDown = \markup{\sans &quot;d&quot;}</p><p>%% etc</p><p>%%<br/>%% The score<br/>%%</p><p>{</p><p>  %% there is an accidental for every note<br/>  #(set-accidental-style &apos;dodecaphonic)</p><p>  c&apos;<br/>  \accidental \naturalSyntonicDown<br/>  e&apos;<br/>  g&apos;<br/>  \accidental \markup{\halign #0 \sans &quot;&lt;e&quot;}<br/>  b&apos;</p><p>  %% \override does not work for chords nor for accidentals, but here is a way:<br/>  %% see <a href="http://www.mail-archive.com/lilypond-devel@.../msg22555.html">http://www.mail-archive.com/lilypond-devel@.../msg22555.html</a><br/>  %%<br/>  %% TODO: def Scheme function that only expects markup and returns lambda-expression<br/>  &lt;<br/>    c&apos;!<br/>    \tweak #&apos;before-line-breaking #(accidental-text (markup #:sans &quot;m&quot;))<br/>    e&apos;!<br/>    g&apos;!<br/>    \tweak #&apos;before-line-breaking #(accidental-text (markup #:halign 0 #:sans &quot;&lt;e&quot;))<br/>    b&apos;!&gt;2</p><p>}</p><br/>
<p></p></div><h3><a id=84580 href="#84580">ðŸ”—</a>Torsten Anders &#x3C;torsten.anders@...&#x3E;</h3><span>9/7/2009 4:40:50 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On Sep 7, 2009, at 12:29 PM, Torsten Anders wrote:<br/>&gt; Finally, I got some microtonal notation working in Lilypond that uses<br/>&gt; a special font for the accidentals (i.e. not the usual Feta font)</p><p>Note that in my previous message Yahoo garbled the path names (long names split, dot after path part of it ...).</p><p>Best<br/>Torsten</p></div>
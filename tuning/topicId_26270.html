<a href="/tuning">back to list</a><h1>Re: My pitch reproduction capabilities</h1><h3>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>7/17/2001 8:20:30 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Haresh</p><p>I remember you asked about a tuner accurate to 0.1 cents.</p><p>I&apos;ve been programming FTS to find the frequency of wave sound by counting note crossings.</p><p>It can do this very accurately, by doing a linear interpolation between samples at the zero<br/>crossing. E.g. if one sample is +200 and the next one is -100 then the zero crossing is two thirds<br/>of the way between the first and the second. So it can be much more accurate than the sample rate<br/>would suggest.</p><p>Many timbres have a main peak every so often in the wave sound, followed by secondary peaks, and so<br/>one can choose to ignore secondary peaks less than, say, 85 percent of the primary when counting the<br/>wave crossings.</p><p>It only works for certain timbres at present, but works fine for most birdsong, and for some voices,<br/>also recorder. Basically, if you look at the waveform in an oscilloscope, and it has primary peaks<br/>regularly spaced at the frequency of the note, with the secondary peaks smaller, then it can be<br/>done. (I&apos;ve added a little oscilloscope to FTS to help check this).</p><p>This method can be accurate to up to +-0.1 cents for a 0.1 second clip. That&apos;s much more  accurate<br/>than one would normally expect from Fast Fourier Transforms, even with peak interpolation - one<br/>would expect more like a second or two of sound at least.</p><p>I think it also has potential to be developed for a few more timbres by doing pattern recognition to<br/>look for repeating patterns of waves.</p><p>Requires a fair amount of tweaking at present but I&apos;d do some preset ones that work.</p><p>Anyway, here are two example clips from Veena Sahasrabuddhe&apos;s site - her voice works well.</p><p><a href="http://tunesmithy.netfirms.com/tunes/Veena_Sahasrabuddhe_phrase1.mid">http://tunesmithy.netfirms.com/tunes/Veena_Sahasrabuddhe_phrase1.mid</a><br/><a href="http://tunesmithy.netfirms.com/tunes/Veena_Sahasrabuddhe_phrase2.mid">http://tunesmithy.netfirms.com/tunes/Veena_Sahasrabuddhe_phrase2.mid</a></p><p>(You may find they are overall sharp or flat, e.g. my soundcard is two and a half cents sharp when<br/>playing midi, though it&apos;s relative pitch accuracy for midi is about +- 0.2 cents).</p><p>It&apos;s from:<br/><a href="http://stations.mp3s.com/stations/123/santhaa_notes.html">http://stations.mp3s.com/stations/123/santhaa_notes.html</a> Alap1 where she sings phrases slowly and<br/>clearly for beginner singers to learn, so ideal for my program.</p><p>Two of the phrases - I&apos;m sure you&apos;ll recognise them from the clip. Adds extra notes at times - e.g.<br/>from the attack - means there was enough of that pitch in the attack for the program to recognise it<br/>as an apparently new note.</p><p>In a glissando, then it adds new notes every so often.</p><p>Also as program is working by counting crossings rather than FFT, then there&apos;s no guarantee that<br/>what it finds will actually be single pitches in the recording, rather than some combined effect of<br/>various pitches causing a regularity of the crossings, but if the timbre is appropriate then it&apos;s<br/>fine. Adding pattern recognition (by looking for repeating patterns of peaks that are almost<br/>identical in size) will probably help eliminate false extra notes.</p><p>You can find my birdsong examples here:<br/><a href="http://tunesmithy.netfirms.com/tunes/birdsong.htm">http://tunesmithy.netfirms.com/tunes/birdsong.htm</a></p><p>I&apos;ve also posted the two Veena Sahasrabuddhe midi clips there - I hope that is okay just for<br/>demonstration purposes.</p><p>This isn&apos;t ready to try out yet, unfortunately, as I&apos;m in middle of rather extensive revision of<br/>FTS, just a taste of what&apos;s to come.</p><p>Robert</p></div><h3>X. J. Scott &#x3C;xjscott@earthlink.net&#x3E;</h3><span>7/17/2001 9:06:19 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Robert,</p><p>&gt; I think it also has potential to be developed for a few more<br/>&gt; timbres by doing pattern recognition to<br/>&gt; look for repeating patterns of waves.</p><p>I think you&apos;ll have trouble with that eventually so let<br/>me give you a leapfrog hint.</p><p>For the more complex timbres, do try the FFT method but<br/>you need to do two things for acceptable results:</p><p>1. Separate the harmonic and inharmonic portions of the<br/>sound according to the method pioneered by Sttel and<br/>Lippe.</p><p>2. Consider not just the strongest partial (which is<br/>often not the fundamental), but starting at the<br/>strongest ones, extract a model for the partials (as in<br/>most real world sounds they are inharmonic) and track<br/>the pitch using that model, making sure to have a<br/>weighted score of the current strength of your model in<br/>order to make sure it continues to be the best fit.</p><p>This method appears to work quite well in practice.</p><p>- Jeff</p></div><h3>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>7/17/2001 9:26:50 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Jeff,</p><p>Thanks for the hint. Yes, I&apos;m planning to use FFT for the more complex timbres.</p><p>I&apos;m not going to try to do separating of multiple parts, just a single line so it should be<br/>reasonably possible. I use peak interpolation to improve the accuracy of pitch, and I wonder if you<br/>know anything about that?</p><p>At present, I have the options of quadratic, bayrcentric, Quinns first and second estimator, and<br/>Jain&apos;s method.</p><p>Those are all three point methods. They work quite well, however I&apos;ve been wondering if there is a<br/>way of locating the peak to greater accuracy by using four or more points. Depending on the timbre,<br/>with search for only the most prominent peaks, one may well only find a few, and the time spent<br/>doing the peak interpolation isn&apos;t significant. I wonder if you have any ideas about four or more<br/>point interpolation (or indeed about other three point ones, though these ones seem to work pretty<br/>well).</p><p>I also tried zero padding, which adds a fair amount to the time, to memory needs, and also doesn&apos;t<br/>seem to do that good a job of peak interpolation.</p><p>For locating the pitch of the note, at present I just do it so that it looks for the lowest pitched<br/>partial in the timbre. It works quite well if one sets a background noise level appropriately. But<br/>by no means perfect and does have tendency to occasionally octave jump. Maybe searching for a<br/>harmonic series in the partials will help. Thanks for the suggestion.</p><p>Also at present I&apos;m limiting it to short sound samples that can fit in memory, as idea is just to<br/>use it in order to input a seed into FTS. Also possibly to use as a tuner (with the wave crossings<br/>method and FFT as alternatives). Plus one will be able to play or sing a phrase, then get FTS to<br/>quantise it to any scale / mode one likes and play it back again in that tuning, which could be<br/>quite fun for learning various tunings.</p><p>Robert</p></div><h3>X. J. Scott &#x3C;xjscott@earthlink.net&#x3E;</h3><span>7/17/2001 9:59:54 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Robert,</p><p>&gt; I wonder if you have any ideas about four or more<br/>&gt; point interpolation</p><p>I haven&apos;t ever tried it from this angle and I must<br/>admit I was very surprised you were able to get the<br/>results you did doing what you are doing now, which I<br/>would havwe said would not work that good.</p><p>Sorry I can&apos;t be of help here but it looks to me like<br/>you&apos;re the current expert in this field.</p><p>- Jeff</p></div><h3>Haresh BAKSHI &#x3C;hareshbakshi@hotmail.com&#x3E;</h3><span>7/17/2001 10:39:03 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In tuning@y..., &quot;Robert Walker&quot; &lt;robertwalker@n...&gt; wrote:<br/>&gt; Hi Haresh<br/>&gt;<br/>&gt; I remember you asked about a tuner accurate to 0.1 cents.<br/>&gt;<br/>&gt; I&apos;ve been programming FTS to find the frequency of wave sound by<br/>counting note crossings.<br/> ........................ &gt;&gt;&gt;&gt;&gt;</p><p>Hi Robert, Jeff, thanks for your postings.  This is going to be very<br/>useful.</p><p>I believe that, as long as we deal with slow alap-s in voice, it is<br/>going to be relatively simple.  I will read the details in your<br/>posting carefully and come back if I have any queries.</p><p>Regards,<br/>Haresh.</p></div>
<!DOCTYPE html>
            <html>
            <head>
            <meta charset="utf-8">
                <meta name="viewport"
            content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
                <meta http-equiv="x-ua-compatible" content="ie=edge">
                <title>Yahoo Tuning Groups Ultimate Backup tuning As promised, some Python code for continued fraction convergents</title>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            </head>
            <body>
            </body>
            </html>
        <a href="/tuning">back to list</a><h1>As promised, some Python code for continued fraction convergents</h1><h3><a id=66626 href="#66626">ðŸ”—</a>Aaron Krister Johnson &#x3C;aaron@akjmusic.com&#x3E;</h3><span>5/30/2006 5:39:26 AM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt;     From: &quot;Gene Ward Smith&quot; <a href="mailto:genewardsmith@coolgoose.com">genewardsmith@coolgoose.com</a><br/>&gt;     Date: Sat May 27, 2006 10:46am(PDT)<br/>&gt; Subject: Re: best rational approximation<br/>&gt;<br/>&gt; Gene wrote:<br/>&gt;<br/>&gt; If you have some x, call it x0. Then set n0 = floor(x0), and<br/>&gt; x1 = 1/(x0-n0). Iterate this, n_i = floor(x_i), and<br/>&gt; x_(i+1) = 1/(x_i-n_i). You then get a sequence of positive integers<br/>&gt; &lt;n0, n1, n2, ...&gt; which is the continued fraction for x; for every<br/>&gt; irrational x, there is a *unique* continued fraction, which is pretty<br/>&gt; neat.<br/>&gt;<br/>&gt; Now set h[-2] = 0, h[-1] = 1, h[i] = n_i h[i-1] + h[i-2], and similarly<br/>&gt; k[-2] = 1, k[-1] = 0, k[i] = n_i k[i-1] + k[i-2].  Then Q[i] = h[i]/k[i]<br/>&gt; is the ith continued fraction approximate for x, starting from i=0.</p><p>I&apos;m posting this to the normal tuning groups as well as tuning-math, because I<br/>think it should be dymystified, and it&apos;s quite fun and useful!</p><p>Hopefully, you will understand what Gene wrote above in a very concrete way by<br/>the time you are done reading this...</p><p>This is cool...I figured out that on a calculator with a &apos;1/x&apos; button, to get<br/>the &lt;n0,n1,n2,....&gt; sequence for the simple continued fraction of x, you:<br/>&#x9;<br/>&#x9;1. Write down the integer part of x (floor(x))<br/>&#x9;2. Take the integer part of x away from x (x-floor(x))<br/>&#x9;3. you now have a number between 0 and 1. Take its&apos; inverse<br/>&#x9;&#x9;(i.e. &apos;1/x&apos; on the calculator)<br/>&#x9;4. Goto step &apos;1&apos; and repeat as long as desired...</p><p>The caveat is that a calculator, and most computer situations actually, have<br/>limited decimal point precision. So for instance, the continued fraction<br/>expansion for sqrt(2) should be &lt;1,2,2,2,2,2,2,2,2,2,......&gt;, however, once<br/>the precision runs out on a calculator, you will see that chain of &apos;2&apos;s gets<br/>disrupted......</p><p>Here are some meantone fifths that I figured out by hand with a calculator<br/>using Gene&apos;s algorithm; some Python code do do this &apos;automagically&apos; follows<br/>below. To understand how I got the convergents&apos; numerators and denominators,<br/>take the current continued fraction expansion number, multiply it by the<br/>previous numerator (or denominator) and add the previous-previous numerator<br/>(or denominator).....for example, below, where the top row says &apos;39&apos;, we do<br/>&#x9;(39*3)+1=118<br/>        (39*2)+1=79<br/>..which gives us the next convergent, 118/79.</p><p>1/3-comma fifth:</p><p>    1  2  39    1   ;;;; the cont. fraction expans of 1.49380158....</p><p>0 1 1  3 118  121   ;;;; the convergents (numerators)<br/>- - -  - ---  ---<br/>1 0 1  2  79   81   ;;;; the convergents (denoominators)</p><p>2/7-comma fifth:</p><p>    1  2   46    1</p><p>0 1 1  3  139  142<br/>- - -  -  ---  ---<br/>1 0 1  2   93   95</p><p>1/4-comma fifth:</p><p>    1  2  53    4</p><p>0 1 1  3 160  643<br/>- - -  - ---  ---<br/>1 0 1  2 107  430</p><p>1/5-comma fifth:</p><p>    1  2   66    1</p><p>0 1 1  3  199  202<br/>- - -  -  ---  ---<br/>1 0 1  2  133  135</p><p>1/6-comma fifth:</p><p>    1  2   80    12</p><p>0 1 1  3  241  2895<br/>- - -  -  ---  ----<br/>1 0 1  2  161  1934</p><p>1/7-comma fifth:</p><p>    1  2  93    2</p><p>0 1 1  3 280  563<br/>- - -  - ---  ---<br/>1 0 1  2 187  376</p><p>1/8-comma fifth:</p><p>    1   2  106    1</p><p>0 1 1   3  319  322<br/>- - -   -  ---  ---<br/>1 0 1   2  213  215</p><p>etc, etc........</p><p>here&apos;s some python code, to be put in a library.<br/>I call my own math functions library &apos;math_stuff.py&apos;</p><p>from math import sqrt, log, floor</p><p>def contfrac(a): ### continued fraction expansion<br/>        terms=[]<br/>        count=0<br/>        b=1<br/>        while ((b != 0) and (count &lt; 24)): ### 24 times, emprical accuracy<br/>                                           ### limit<br/>                terms.append(floor(a/(b+0.0)))<br/>                a,b = b, a % b<br/>                count = count + 1<br/>        return terms</p><p>def ra(x): ### &apos;rational approximation&apos;, or convergent<br/>        numerators=[0,1]<br/>        denominators=[1,0]<br/>        expansion=contfrac(x) ### call the contfrac function<br/>        for num in expansion: ### [-1] and [-2] index &apos;previous&apos;<br/>                              ### and &apos;previous-previous&apos;<br/>                numerators.append((num*numerators[-1])+numerators[-2])<br/>                denominators.append((num*denominators[-1])+denominators[-2])<br/>        for index in range(len(numerators)):<br/>                print &quot;%i/%i&quot; % (numerators[index], denominators[index])<br/>        print</p><p>Here&apos;s an example of a shell session where I approximated the sqrt(2) with<br/>rationals:</p><p>akj@aaron:~$ python<br/>Python 2.4.1 (#1, Apr 10 2005, 22:30:36)<br/>[GCC 3.3.5] on linux2<br/>Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.<br/>&gt;&gt;&gt; from math_stuff import *<br/>&gt;&gt;&gt; ra(sqrt(2))<br/>0/1<br/>1/0<br/>1/1<br/>3/2<br/>7/5<br/>17/12<br/>41/29<br/>99/70<br/>239/169<br/>577/408<br/>1393/985<br/>3363/2378<br/>8119/5741<br/>19601/13860<br/>47321/33461<br/>114243/80782<br/>275807/195025<br/>665857/470832<br/>1607521/1136689<br/>3880899/2744210<br/>9369319/6625109<br/>22619537/15994428<br/>54608393/38613965<br/>77227930/54608393<br/>131836323/93222358<br/>209064253/147830751</p><p>&gt;&gt;&gt; 209064253/147830751.0<br/>1.4142135623730951<br/>&gt;&gt;&gt; sqrt(2)<br/>1.4142135623730951 #### they match!!!<br/>&gt;&gt;&gt;</p><p>Notice the use of the &apos;.0&apos; in Python, to tell the interpreter you want a<br/>floating point answer.</p><p>Hope this was enlightening!</p><p>Best,<br/>Aaron.</p></div><h3><a id=66629 href="#66629">ðŸ”—</a>Gene Ward Smith &#x3C;genewardsmith@coolgoose.com&#x3E;</h3><span>5/30/2006 11:37:53 AM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, Aaron Krister Johnson &lt;aaron@...&gt; wrote:</p><p>&gt; This is cool...I figured out that on a calculator with a &apos;1/x&apos;<br/>button, to get<br/>&gt; the &lt;n0,n1,n2,....&gt; sequence for the simple continued fraction of x,<br/>you:<br/>&gt;<br/>&gt; &#x9;1. Write down the integer part of x (floor(x))<br/>&gt; &#x9;2. Take the integer part of x away from x (x-floor(x))<br/>&gt; &#x9;3. you now have a number between 0 and 1. Take its&apos; inverse<br/>&gt; &#x9;&#x9;(i.e. &apos;1/x&apos; on the calculator)<br/>&gt; &#x9;4. Goto step &apos;1&apos; and repeat as long as desired...</p><p>It&apos;s even neater if your calculator has a &quot;frac&quot; key, as some do. That<br/>takes the fractional part, x - floor(x). Then you simply punch the<br/>frac key followed by the 1/x key to get the next value.</p><p>It&apos;s also useful to know that if you simply want the denominators, as<br/>is sometimes the case, then you don&apos;t need the numerators, since<br/>calculating numerators and denominators is a separate calculation.<br/>Also, from just the denominators, you can get the whole sequence as an<br/>infinite series, which also tells you about the closeness of the<br/>approximation.</p><p>If I get just the denominators for log2(5), I get a seqence of equal<br/>temperaments for 1/4 comma meantone: 1, 2, 5, 7, 12, 19, 31, 174,<br/>205... Now I can cook up an infinite series from these denominators:</p><p>1 - 1/(1*2) + 1/(2*5) - 1/(5*7) + 1/(7*12) - 1/(12*19) + 1/(19*31) ...</p><p>The partial sums of this series are simply the convergents of the<br/>continued fraction, which since it is an alternating series tells me<br/>that using 19 as an approximation for 1/4-comma will give an error<br/>less than the next term, 1/(19*31); so the error for 19 is less than<br/>1200/(19*31) = 2.04 cents. In fact the actual error is 1.84 cents. I<br/>also know 19 is flat of the correct value, 31 sharp, and so forth.</p></div><h3><a id=66631 href="#66631">ðŸ”—</a>Aaron Krister Johnson &#x3C;aaron@akjmusic.com&#x3E;</h3><span>5/30/2006 1:08:15 PM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, &quot;Gene Ward Smith&quot; &lt;genewardsmith@...&gt;<br/>wrote:<br/>&gt;<br/>&gt; --- In <a href="mailto:tuning@yahoogroups.com">tuning@yahoogroups.com</a>, Aaron Krister Johnson &lt;aaron@&gt;<br/>wrote:<br/>&gt;<br/>&gt; &gt; This is cool...I figured out that on a calculator with a &apos;1/x&apos;<br/>&gt; button, to get<br/>&gt; &gt; the &lt;n0,n1,n2,....&gt; sequence for the simple continued fraction<br/>of x,<br/>&gt; you:<br/>&gt; &gt;<br/>&gt; &gt; &#x9;1. Write down the integer part of x (floor(x))<br/>&gt; &gt; &#x9;2. Take the integer part of x away from x (x-floor(x))<br/>&gt; &gt; &#x9;3. you now have a number between 0 and 1. Take its&apos; inverse<br/>&gt; &gt; &#x9;&#x9;(i.e. &apos;1/x&apos; on the calculator)<br/>&gt; &gt; &#x9;4. Goto step &apos;1&apos; and repeat as long as desired...<br/>&gt;<br/>&gt; It&apos;s even neater if your calculator has a &quot;frac&quot; key, as some do.<br/>That<br/>&gt; takes the fractional part, x - floor(x). Then you simply punch the<br/>&gt; frac key followed by the 1/x key to get the next value.<br/>&gt;<br/>&gt; It&apos;s also useful to know that if you simply want the denominators,<br/>as<br/>&gt; is sometimes the case, then you don&apos;t need the numerators, since<br/>&gt; calculating numerators and denominators is a separate calculation.<br/>&gt; Also, from just the denominators, you can get the whole sequence<br/>as an<br/>&gt; infinite series, which also tells you about the closeness of the<br/>&gt; approximation.<br/>&gt;<br/>&gt; If I get just the denominators for log2(5), I get a seqence of<br/>equal<br/>&gt; temperaments for 1/4 comma meantone: 1, 2, 5, 7, 12, 19, 31, 174,<br/>&gt; 205... Now I can cook up an infinite series from these<br/>denominators:<br/>&gt;<br/>&gt; 1 - 1/(1*2) + 1/(2*5) - 1/(5*7) + 1/(7*12) - 1/(12*19) +<br/>1/(19*31) ...<br/>&gt;<br/>&gt; The partial sums of this series are simply the convergents of the<br/>&gt; continued fraction, which since it is an alternating series tells<br/>me<br/>&gt; that using 19 as an approximation for 1/4-comma will give an error<br/>&gt; less than the next term, 1/(19*31); so the error for 19 is less<br/>than<br/>&gt; 1200/(19*31) = 2.04 cents. In fact the actual error is 1.84 cents.<br/>I<br/>&gt; also know 19 is flat of the correct value, 31 sharp, and so forth.</p><p>Very cool!</p><p>-Aaron</p></div>
                <script>
                    let monospace = false
                    $('button').on('click', function () {
                      if (monospace) {
                        $('p').css("font-family", "")
                      } else {
                        $('p').css("font-family", "monospace")
                      }
                      monospace = !monospace
                    })
                </script>
            
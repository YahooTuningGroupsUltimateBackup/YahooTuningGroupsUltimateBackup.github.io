<a href="/crazy_music">back to list</a><h1>Re:FFT</h1><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>8/30/2001 7:49:42 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Brian,</p><p>Hello, and thanks for your encouragement about Fractal Tune Smithy!</p><p>The linear predictive coding sounds interesting.</p><p>It&apos;s not the same thing, but I have an idea for improving the<br/>wave counting method of finding the frequency by taking the<br/>pitch one finds at a particular point and predicting future<br/>crossings. Then if one hits a patch where one can&apos;t quite<br/>deterimine the pitch because of a large number of extra<br/>crossings, check for the predicted crossings, and if found,<br/>use those instead.</p><p>I think this might reduce the number of extra notes it<br/>finds. We&apos;ll see how it works.</p><p>Re soudn of FFT. Maybe bell like would be another way<br/>of describing it - kind of crystal bell or something.<br/>That is - the sound if one just adds together the<br/>frequencies as sine waves.</p><p>However another hting one can do is to replace them<br/>with other waves. With FTS, in the FFT section, just<br/>for fun, have option to make the waveform from<br/>trianglular or saw tooth waves insttead of the<br/>usual and &quot;proper&quot; sine waves.</p><p>Also one can try using any of the midi voices for the<br/>pitches.</p><p>That I thnk has quite a different kind of effect.<br/>It&apos;s something that could have been done before<br/>FFT, even back in the C17. If a number of<br/>musicians were present who were able to hear<br/>the partials in a bell sound, they could then<br/>sing them along with the bell, and continue to sing them once<br/>the bell stops sounding, and the result<br/>might perhaps sound somewhat like a bell, and<br/>somewhat like singing.</p><p>I&apos;d have thought, probably not much like FFT synthesis.</p><p>I wonder if anyone has done this experiment?</p><p>I think perhaps some of the qualities you are<br/>attributing to the FFT are really qualities of<br/>the sine waves used to reconstruct it.</p><p>If so, replacing them with other wave forms<br/>would change the effect. Of course that will change<br/>the timbre (whihc I find interesting to do). If one wants<br/>to keep the original timbre as closely as possible,<br/>one could maybe try using a voice such as ocarina<br/>instead of the sine waves, or anything very nearly<br/>sine wave like (recorder in upper register is also<br/>good, or maybe a sample of a suitable note from<br/>bird song), but not actually sine waves.</p><p>One loses some information anyway about the waveform<br/>by choosing the most prominent peaks in the FFT<br/>plot, and ignoring the finer details. Maybe using<br/>some other voice to reconstruct it<br/>can help regain any subtleties lost by doing that.</p><p>Won&apos;t get back the original as one has lost<br/>the attack, and the pitch and volume varying transients,<br/>and the phase info, but could give interesting<br/>timbres. Something I&apos;ve been experimenting with<br/>in FTS using Midi voices, as that&apos;s easy to do.</p><p>Robert</p></div><h3>Graham Breed &#x3C;graham@...&#x3E;</h3><span>8/31/2001 2:15:57 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Robert Walker wrote:</p><p>&gt; However another hting one can do is to replace them<br/>&gt; with other waves. With FTS, in the FFT section, just<br/>&gt; for fun, have option to make the waveform from<br/>&gt; trianglular or saw tooth waves insttead of the<br/>&gt; usual and &quot;proper&quot; sine waves.</p><p>It&apos;s not clear if you&apos;ve done this or not.  But whatever, I&apos;ve<br/>uploaded an example of a guitar resynthesised with square waves to<br/>the MakeMicroMusic Files section.</p><p>I put it there because I can&apos;t upload to this group.  It says the<br/>moderator has disabled uploads.</p><p>If I&apos;d done it properly, I would have processed the same input file<br/>different ways.  But I did it quickly instead.</p><p>&gt; I wonder if anyone has done this experiment?<br/>&gt;<br/>&gt; I think perhaps some of the qualities you are<br/>&gt; attributing to the FFT are really qualities of<br/>&gt; the sine waves used to reconstruct it.</p><p>Ah, but he did list a lot of other kinds of synthesis.  I don&apos;t know<br/>what they mean myself, but Walsh synthesis was among them.  This is<br/>like normal FFT resynthesis but using square waves.  And unlike what<br/>I did above, you can do the analysis with the square-wave equivalent<br/>of an FFT as well.  If you think about it, it shouldn&apos;t be difficult<br/>to see that you can get any waveform by combining square waves the<br/>same as you can with sines.</p><p>The rationale is that you can add together square waves much more<br/>quickly than sines using a digital synthesizer.  I&apos;m not sure if even<br/>this would work in practice, because I don&apos;t think it would degrade<br/>gracefully with small numbers of partials.  There lots of samples<br/>dominated by a few sine-partials, but I&apos;m not sure that many would<br/>work as a few square-partials.  Perhaps this is the reason Walsh<br/>synthesis has yet to take the world by storm.</p><p>Still, you can get some idea what it can do from my example.  It uses<br/>35 inharmonic partials.  A more subtle waveform might work a bit like<br/>an enhancer, but I haven&apos;t tried that yet.</p><p>                   Graham</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>8/31/2001 4:04:40 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Graham,</p><p>&gt; &gt; However another hting one can do is to replace them<br/>&gt; &gt; with other waves. With FTS, in the FFT section, just<br/>&gt; &gt; for fun, have option to make the waveform from<br/>&gt; &gt; trianglular or saw tooth waves insttead of the<br/>&gt; &gt; usual and &quot;proper&quot; sine waves.</p><p>&gt; It&apos;s not clear if you&apos;ve done this or not.  But whatever, I&apos;ve<br/>&gt; uploaded an example of a guitar resynthesised with square waves to<br/>&gt; the MakeMicroMusic Files section.</p><p>Thanks, yes, that&apos;s a lot of fun and a great demo of how some<br/>of the &quot;FFT&quot; quality is because one is resynthesising using sine waves.</p><p>Nice first try at a crumhorn perhaps... Certainly more earthy<br/>than the sine wave FFT in the kind of ethos of the timbre.</p><p>You can resynthesise to square, triangle, and saw tooth in FTS for a single<br/>note in FTS, rather than as an &quot;instrument&quot; to use in a melodic line,<br/>but I suppose the single note can be made into a sample for a midi instrument.</p><p>You can also make the FFT analysis into a timbre with midi instruments<br/>playing all the partials, which one _can_ use in FTS immediately,<br/>and select it into one of the &quot;voice channels&quot; just like any of<br/>the midi voices.</p><p>For the FFT section, see the FFT help section of the FTS beta<br/>download page. I&apos;ve just added a couple of sentences about the saw tooth<br/>and midi instrument resynthesis option.<br/><a href="http://members.tripod.com/~robertinventor/ftsbeta.htm#FFT">http://members.tripod.com/~robertinventor/ftsbeta.htm#FFT</a></p><p>N.B. if you go to Config | Freq Detection | FFT Freq. detection<br/>there are some tick boxes at bottom of the window for<br/>Ooura&apos;s fft - untick that and you get your one, but without<br/>the sine table (because it&apos;s just in the debug code so far) - this<br/>is there by accident, and the FFTW tick box comes up with<br/>message about a dll that doesn&apos;t exist (well, I have it<br/>here, but never uploaded it anywhere as I&apos;m not sure<br/>whether or not I&apos;m supposed to be able to use it<br/>as a &quot;plug in&quot;).</p><p>I&apos;ll do a demo of single recorder note resynthesised as sine,<br/>triangle, saw tooth, and square, some time<br/>soon. Also play a recorder tune into FTS and get it to<br/>find the notes, then play them back with same timing and<br/>pitch, but re-synthesized with some other midi instrument playing<br/>the partials (guitar, tubular bells, violin, or whatever).</p><p>FTS can already do this for the recorder timbre<br/>reasonably well if the tune isn&apos;t too fast,<br/>though as it is at present, one needs to play around with<br/>the various parameters to find the &quot;sweet spot&quot; where everything works well.<br/>(I plan to have a drop list of defaults for the wave counting<br/>section when finished).</p><p>&gt; Ah, but he did list a lot of other kinds of synthesis.  I don&apos;t know<br/>&gt; what they mean myself, but Walsh synthesis was among them.  This is<br/>&gt; like normal FFT resynthesis but using square waves.  And unlike what<br/>&gt; I did above, you can do the analysis with the square-wave equivalent<br/>&gt; of an FFT as well.  If you think about it, it shouldn&apos;t be difficult<br/>&gt; to see that you can get any waveform by combining square waves the<br/>&gt; same as you can with sines.</p><p>The integration would be easy to do anyway. I think I&apos;d need to look<br/>up the proof that the fourier series integration gives you a sequence<br/>of sine waves that sums up to give the original waveform, and then<br/>see how one can do the same for square waves, can well imagine one<br/>might. Could also try to prove it just by showing that one can<br/>make a sine wave out of square waves - then I think with this<br/>as converging series, one would then get convergence easily<br/>from the sum of the sine waves, but don&apos;t know if that would<br/>be any quicker to do.</p><p>&gt; The rationale is that you can add together square waves much more<br/>&gt; quickly than sines using a digital synthesizer.  I&apos;m not sure if even<br/>&gt; this would work in practice, because I don&apos;t think it would degrade<br/>&gt; gracefully with small numbers of partials.  There lots of samples<br/>&gt; dominated by a few sine-partials, but I&apos;m not sure that many would<br/>&gt; work as a few square-partials.  Perhaps this is the reason Walsh<br/>&gt; synthesis has yet to take the world by storm.</p><p>Yes, just as a square wave or saw tooth can be FFT analysed as an<br/>infinite sequence of sine wave harmonics, I suppose a sine wave<br/>would be an infinite sequence of square wave harmonics.</p><p>I wonder if we really do hear sine wave partials? Would be perhaps<br/>a bit surprising if it is a mathematically perfect sine wave, and a close<br/>approximation to a sine wave might be more likely. I wonder if<br/>anyone has tried varying the shape of the sine wave just slightly<br/>for the FFT.</p><p>Come to think of it, in my update of your FFT code, there are no<br/>calls to the sine and cosine functions any more during the<br/>actual calculation, just a sine table that gets filled in<br/>at the start of the calculation.</p><p>I wonder what would happen if one just replaced the sine wave<br/>table there by a saw tooth, or square wave, or whatever, and<br/>did the standard FFT calculation with that instead?</p><p>&gt; Still, you can get some idea what it can do from my example.  It uses<br/>&gt; 35 inharmonic partials.  A more subtle waveform might work a bit like<br/>&gt; an enhancer, but I haven&apos;t tried that yet.</p><p>Could be fun to try...</p><p>Robert</p></div><h3>genewardsmith@...</h3><span>8/31/2001 9:08:14 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In crazy_music@y..., &quot;Graham Breed&quot; &lt;graham@m...&gt; wrote:</p><p>&gt; I did above, you can do the analysis with the square-wave<br/>equivalent<br/>&gt; of an FFT as well.  If you think about it, it shouldn&apos;t be<br/>difficult<br/>&gt; to see that you can get any waveform by combining square waves the<br/>&gt; same as you can with sines.</p><p>It&apos;s not as easy as all that, for in fact Walsh functions consist of<br/>more than just your ordinary square waves--you need 2^n Walsh<br/>functions to get a complete orthogonal basis in a period of length<br/>2^n, so you need other step-functions taking on two values (1, -1.)</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>9/1/2001 7:16:50 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Jeff,</p><p>&gt; &gt; I think I&apos;d need to look up the proof that the fourier series<br/>&gt; &gt; integration gives you a sequence of sine waves that sums up<br/>&gt; &gt; to give the original waveform, and then see how one can do<br/>&gt; &gt; the same for square waves, can well imagine one might.</p><p>&gt; Eeek! I don&apos;t think so!</p><p>Yes, just looked it up on the web, here&apos;s a nice page with<br/>some pretty animations:<br/><a href="http://www.sosmath.com/fourier/fourier1/fourier1.html">http://www.sosmath.com/fourier/fourier1/fourier1.html</a></p><p>One needs to have functions with those properties:</p><p>Need ones to stand in for the cos and the sin.</p><p>First of all, integral over one cycle of the fundamental<br/>for the transform is zero - that&apos;s okay for periodic function.</p><p>Then, integral of the product of the &quot;cos&quot; for m with the &quot;sin&quot;<br/>for n has to be zero, for any m, or n.</p><p>Try case m = n, then it will be true for a periodic function if the<br/>positive and negative sections of the waveform are<br/>reflections of each other, as wave then is (to do it a bit<br/>graphically):</p><p>sin<br/>looks like:<br/> / \<br/>     \ /</p><p>i.e. putting in the signs:</p><p> / \<br/>    -/-\<br/>where -\ is same as \ with sign change, same for / and-/</p><p>cos<br/> \     /<br/>  -/-\</p><p>product<br/>/*\      -/*-\<br/>    -/*\      /*-\</p><p>where /*\ means integral of the product of the / and \ parts of the wave.</p><p>Let&apos;s go to algebraic notation, /=a, \ = b, then we want<br/>a*b + -a*b + -a*-b + a*-b<br/>to integrate to 0, which it does, hurray!</p><p>Since nothing was assumed about the shape of the / or \<br/>it will work for any periodic function with the<br/>positive and negative sections of the curve the same.</p><p>Need this to work for any m or n though, cos(m)*sin(n)<br/>integrating to zero.</p><p>Then, integral of product of the functions for frequencies<br/>m and n with m !=n has to be 0.</p><p>However, just kind of doodling a few possibilities,<br/>looks as this might be possibly be true for any periodic function<br/>that has second half = rpeat of first half with change of<br/>sign, and provided we also have symmetry in each half<br/>of the waveform too, so that the / is the<br/>same as \ backwards in that diagram as well.</p><p>Anyone know if this is the case? I can&apos;t quite see how<br/>to prove it yet, if it is.</p><p>Then, integral of the square of the function has to be<br/>constant independent of the frequency. That&apos;s okay for<br/>periodic function. E.g. if you double the frequency, then<br/>the integral for each cycle of the wave is halved (you&apos;ve<br/>squashed it up by factor of two in the time domain), so<br/>as the number of cycles has also doubled, total integral<br/>remains the same</p><p>Finally of course, one needs to show that any function<br/>of interest _can_ be constructed as a sum of these<br/>stand-in cos and sin functions - that part of the<br/>proof isn&apos;t dealt with on that page.</p><p>That I think is the tricky part that won&apos;t generally<br/>work for all periodic functions.</p><p>Still, could be fun to play around and see what happens.</p><p>One rather wild idea. Suppose one tried to use<br/>an acutal instrument sample in place of teh sine waves.</p><p>E.g. oboe waveform (one cycle). Now analyse, say, recorder<br/>in terms of oboes. Might one get a number of &quot;partials&quot;<br/>which when played on oboes sounded a bit like a single<br/>note on the recorder???... Might be fun just to see<br/>what happens - even if it doesn&apos;t work, the &quot;mistake&quot;<br/>might give an interesting timbre.</p><p>N.B.<br/><a href="http://sepwww.stanford.edu/oldsep/hale/FftLab.html">http://sepwww.stanford.edu/oldsep/hale/FftLab.html</a><br/>Neat applet for experimenting with FFT - drag<br/>the dot for the freq. of FFT analysis in the top part and<br/>the wave shows below.</p><p>Do Zero all, then click for the dot for the freq in<br/>top or bottom half and you&apos;ll get the wave. Or try<br/>making a wave for it to analyse. Great fun.</p><p>To make the graph for the real fft, I.e. input<br/>with zero imaginary component, zero all, and in the bottom<br/>half set, say, the leftmost imaginary dot positive,<br/>and rightmost one negative by same amount (or any<br/>symmetrical pairs of dots in the imaginary section<br/>for F(x)).</p><p>Page of FFT links:<br/><a href="http://www.fftw.org/links.html">http://www.fftw.org/links.html</a></p><p>Robert</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>9/1/2001 7:49:54 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Brian,</p><p>&gt;    The excellent book Wlash Functions (can&apos;t recall the author) goes into all<br/>&gt;    of this, and in fact shows how to generate a near-sine-wave using Wlash sal and<br/>&gt;    cal functions.  In fact, I built a logic circuit to do this in the electronics<br/>&gt;    lab during my university education as a bit of fun. By heavens, it worked.<br/>&gt;    Walsh sal and cal functions are very easy to generate by stacking logic gates.<br/>&gt;    Just add some AND and OR and XOR gates on the outputs and you get any Walsh sal<br/>&gt;    or cal you want.  The sequency depends on the master clock rate and the amount<br/>&gt;    by which the logic gates subdivide the master clock.</p><p>That sounds fun!</p><p>Interesting idea to combine the two, or use different functions depending on<br/>the characteristics of the wave form and how &quot;noisy&quot; it is.</p><p>Robert</p></div><h3>John Starrett &#x3C;jstarret@...&#x3E;</h3><span>9/1/2001 9:32:18 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In crazy_music@y..., &quot;Robert Walker&quot; &lt;robertwalker@n...&gt; wrote:<br/>&lt;snip&gt;<br/>&gt;<br/>&gt; Robert</p><p>Thanks Robert. Here&apos;s another FFT app with sound:<br/><a href="http://www.phy.ntnu.edu.tw/java/sound/sound.html">http://www.phy.ntnu.edu.tw/java/sound/sound.html</a><br/>He has many more applets here, where you see different lists by<br/>putting the mouse over the hyperlinks on the top of the page<br/><a href="http://www.phy.ntnu.edu.tw/java/">http://www.phy.ntnu.edu.tw/java/</a></p><p>John Starrett</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>9/1/2001 11:12:53 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi John</p><p>Thanks Robert. Here&apos;s another FFT app with sound:<br/><a href="http://www.phy.ntnu.edu.tw/java/sound/sound.html">http://www.phy.ntnu.edu.tw/java/sound/sound.html</a><br/>He has many more applets here, where you see different lists by<br/>putting the mouse over the hyperlinks on the top of the page<br/><a href="http://www.phy.ntnu.edu.tw/java/">http://www.phy.ntnu.edu.tw/java/</a></p><p>Thanks!</p><p>You can click the Set button while the sound is<br/>playing and hear the partials pop in and out, which<br/>is fun.</p><p>Robert</p></div>
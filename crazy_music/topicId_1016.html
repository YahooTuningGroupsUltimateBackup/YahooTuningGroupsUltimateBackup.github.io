<a href="/crazy_music">back to list</a><h1>FFT analysis</h1><h3><a id=1016 href="#1016">ðŸ”—</a>jpehrson@...</h3><span>8/9/2001 8:24:42 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In crazy_music@y..., jacky_ligon@y... wrote:</p><p><a href="/crazy_music/topicId_unknown.html#996">/crazy_music/topicId_unknown.html#996</a></p><p>When you play a sound lower than the original, you can<br/>&gt; hear the overtones in the sound more clearly, and when you play in<br/>a scale derived from FFT analysis of the actual sound, you play<br/>chords that are sort of more in tune with the timbre.</p><p>Hi Jacky!</p><p>Could you please explain how you do the FFT analysis  (Fast Fourier<br/>Transforms, I think), what it is, and what software you use??  I know<br/>you&apos;ve explained this before, but I obviously need a &quot;refresher...&quot;</p><p>Thanks!</p><p>___________ __________ _____________<br/>Joseph Pehrson</p></div><h3><a id=1025 href="#1025">ðŸ”—</a>jpehrson@...</h3><span>8/9/2001 12:14:03 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In crazy_music@y..., jacky_ligon@y... wrote:</p><p><a href="/crazy_music/topicId_unknown.html#1023">/crazy_music/topicId_unknown.html#1023</a></p><p>&gt; --- In crazy_music@y..., jpehrson@r... wrote:<br/>&gt; &gt; --- In crazy_music@y..., jacky_ligon@y... wrote:<br/>&gt; &gt;<br/>&gt; &gt; <a href="/crazy_music/topicId_unknown.html#996">/crazy_music/topicId_unknown.html#996</a><br/>&gt; &gt;<br/>&gt; &gt; When you play a sound lower than the original, you can<br/>&gt; &gt; &gt; hear the overtones in the sound more clearly, and when you play<br/>&gt; in<br/>&gt; &gt; a scale derived from FFT analysis of the actual sound, you play<br/>&gt; &gt; chords that are sort of more in tune with the timbre.<br/>&gt; &gt;<br/>&gt; &gt; Hi Jacky!<br/>&gt; &gt;<br/>&gt; &gt; Could you please explain how you do the FFT analysis  (Fast<br/>Fourier<br/>&gt; &gt; Transforms, I think), what it is, and what software you use??  I<br/>&gt; know<br/>&gt; &gt; you&apos;ve explained this before, but I obviously need<br/>a &quot;refresher...&quot;<br/>&gt; &gt;<br/>&gt; &gt; Thanks!<br/>&gt; &gt;<br/>&gt; &gt; ___________ __________ _____________<br/>&gt; &gt; Joseph Pehrson<br/>&gt;<br/>&gt; Joseph,<br/>&gt;<br/>&gt; I use an app called Softest, and I use the Spectrogram for this.<br/>&gt;<br/>&gt; You can play the wave file, and see the partials of the sound in<br/>real<br/>&gt; time. Pitch is horizontal - amplitude is vertical. Then you can use<br/>&gt; this little cross-hair tool, which snaps to the partial you hold it<br/>&gt; over, and right click on it and copy the values to the clipboard<br/>&gt; (amplitude and frequency), then into Excel, where I convert it to<br/>&gt; cents. Very handy!<br/>&gt;<br/>&gt; Also, for Bell and Gong samples, I have used &quot;Wavanal&quot;, which can<br/>do<br/>&gt; resynthesis, so you can hear the results of the FFT. Does a good<br/>job,<br/>&gt; and is freeware used by church bell tuners. Robert Walker turned me<br/>&gt; on to this one. Look it up in Google, and check it out. Works well<br/>&gt; with some other sounds too I&apos;ve found. Has nice ability to export<br/>FFT<br/>&gt; as .par files for Excel.<br/>&gt;<br/>&gt; Jacky</p><p>Thanks so much, Jacky, for this information...  Yes, I<br/>found &quot;Wavanal&quot; but can&apos;t find &quot;Softest...&quot;</p><p>I looked up &quot;Softest&quot; and got &quot;The Softest Kind of Love...&quot; which, I<br/>don&apos;t believe is what I&apos;m looking for... I mean at least on this<br/>forum...</p><p>____________ ___________ _________<br/>Joseph Pehrson</p></div><h3><a id=1056 href="#1056">ðŸ”—</a>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>8/27/2001 7:12:01 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Brian,</p><p>Perhaps I can respond to this as I&apos;ve recently been programming FFT analysis<br/>with FTS, so needed to find out about it for that. I hasten to add that this<br/>isn&apos;t something I&apos;ve researched myself; I&apos;m just quoting various<br/>results that I looked up for the programming, plus my experience in<br/>using these results in FTS.</p><p>When you use the standard FFT algorithm, it produces frequency<br/>bins, and for short sound clips the bins are so far apart as to give<br/>very low frequency resolution. For instance, an 0.1 second clip at 440 Hz<br/>gives a freq resolution of +- 10 cents - not very good!</p><p>However, one can improve the accuracy considerably, maybe achieve a<br/>tenfold improvement of accuracy, by using peak interpolation. The method is<br/>to look not just at the highest amplitude of the frequency bins, but also<br/>the two bins to either side. Then by fitting a curve to it, you can estimate<br/>where the real peak should be, on assumption that it is a response to a<br/>single frequency partial.</p><p>I find it gives quite reasonable accuracy even for fairly short notes, say,<br/>a tenth of a second. One can test it by making a waveform with some random frequencies<br/>accurately pitched (and between FFT frequeny bins), and then see<br/>if the FFT with the peak interpolation recovers them, and FTS has this<br/>programmed in as a test to try out to see how well the FFT works.</p><p>To give a rough idea - of the five interpolation methods I&apos;ve tried, I find<br/>Jain&apos;s method is the one that seems to work best for the frequencies one is<br/>interested in.</p><p>For tenth second random frequencies at around 440 Hz, it often gets the<br/>pitch accurate to within 0.1 cents, but occasionally goes wild by about<br/>1 to 2 cents. So ten times better accuaracy consistently, and most of the time<br/>it has a hundred fold improvement in the accuracy. Pretty good!</p><p>For a 1 second clip, one can get better results, typically reliable to within<br/>0.1 cents nearly all the time with Jain&apos;s method.</p><p>All the FFT programs use the same maths for the FFT, with tweaks to speed<br/>up the calculation (which won&apos;t affect the results), and minor variations<br/>to do with the way the sharp cut off of the sound at start and end of the clip<br/>is treated (perhaps presented as a drop list of &quot;windowing&quot; functions to use).</p><p>HOwever, one could expect variations in the accuracy of freq detection depending<br/>on whether they use peak interpolation, and what methods they use for this.</p><p>Now for the other point about whether the partials that show up in FFT are<br/>&quot;real&quot; or artefacts of the FFT.</p><p>Fourier&apos;s result is that a wide range of mathematical curves<br/>can be represented on a finite domain as a sum of sine waves.</p><p>This includes all continuous functions, and a a large number of discontinuous ones<br/>(including all piecewise continous ones - the ones with only a finite<br/>number of discontinuities).</p><p>The idea of the Fast (or discrete) Fourier Transform is to do the same thing as the<br/>continuous fourier transform, but for a function defined on a finite<br/>number of points (the samples).</p><p>If one adds together all the frequencies found in all the bins,<br/>and also keeps the phase information of the FFT (which is preserved in<br/>the angular component of a complex FFT transform, but lost if one uses<br/>the faster real transform), then one will recover the original wave form<br/>exactly for the sample points.</p><p>However, because of the discrete bin sizes, the only way this can work is<br/>by introducing &quot;artefacts&quot; , e.g. extra frequencies that add together to<br/>give a frequency between two bins.</p><p>The usual FFT artefacts have a characteristic pattern to them. They normally<br/>show up as a widening of the peak, with the tails of the peaks spreading over<br/>the entire frequency range. One may also get a pattern of symmetrical smaller<br/>ripples to either side of the main peak. These are pretty easy to spot when<br/>looking at a FFT graph.</p><p>If one has background noise, then the smaller artefacts and the<br/>tails of the peaks merge into it.</p><p>One can test the results by including an option to reconstruct a wave sound from the<br/>partials. FTS has this (borrowed idea from WAVANAL). Then one can play that<br/>and see if it sounds like the original timbre.</p><p>In practice it seems to work well with timbres with well defined partials that<br/>one can hear; finding them all, and no spurious extra ones (apart from the<br/>FFT artefacts already mentioned), and with reasonable accuracy.</p><p>I hope perhaps this may be useful information.</p><p>Robert</p></div><h3><a id=1063 href="#1063">ðŸ”—</a>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>8/28/2001 5:28:17 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Jeff,</p><p>I&apos;ve tried Quinn&apos;s first and second estimators, which uses the phase information to<br/>improve frequency accuracy - those are two of the five interpolation<br/>methods that are in the list. Jain&apos;s method (which doesn&apos;t use the phase<br/>information) seems to work better than either, at least for the time sample<br/>lengths and frequencies I used (frequencies of 440 Hz +- a few octaves,<br/>and time samples in region 0.1 secs to, say, 30 secs or so).</p><p>I realise, that I gave incorrect info about real FFT. It doesn&apos;t discard the<br/>imaginary part of the data. What it does is to pack both real and imaginary<br/>data into the real buffer, which one later unpacks. So you still have the phase info.</p><p>Sorry about the misdirection. It is a little while ago that I coded it,<br/>maybe a month ago? I actually coded the unpacking of real and imaginary<br/>parts for the real FFT, but had forgotten about all that (nice thing<br/>about programming - even when you foget how you did it, the program<br/>remembers!)</p><p>Real FFT here refers to the input - that the data is given in real form,<br/>with no imaginary part to it - the sample points of the wave are real rather<br/>than complex. It is just a single wave with no phase information added to it.</p><p>A complex FFT needs both real and imaginary parts to be specified,<br/>and one sets the imaginary part to 0. A real FFT only<br/>needs the real part as data, so is faster. It then returns the real<br/>and imaginary parts in the buffer, packed so that the imaginary parts<br/>are in the high end of the buffer, which loses no information for<br/>a real FFT as one can use symmetry to get the missing data, which<br/>is beyond the Nyquist frequency.</p><p>Description of the peak interpolation algorithms:<br/><a href="http://www.dspguru.com/howto/tech/peakfft2.htm">http://www.dspguru.com/howto/tech/peakfft2.htm</a><br/>I used this as my reference for good ones to try out.</p><p>For real FFT I use Ooura&apos;s free c-code from:<br/><a href="http://www-dsp.rice.edu/research/fft/fftnote.asc">http://www-dsp.rice.edu/research/fft/fftnote.asc</a><br/><a href="http://momonga.t.u-tokyo.ac.jp/~ooura/fft.html">http://momonga.t.u-tokyo.ac.jp/~ooura/fft.html</a></p><p>which is about as fast as it gets. FFTW is supposed to be a little faster but in practice<br/>I find no noticeable difference if one uses powers of two for the buffer sizes. If<br/>one uses other buffer sizes, then FFTW (&quot;Fastest Fourier Transform in the West&quot;)<br/>is the one to go for. But, issued under GPL.</p><p>May be okay to supply FFTW in a dll which users can download separately as a kind of<br/>plug in for the program. I&apos;m not entirely sure about this, but I&apos;d have thought<br/>it would be okay.</p><p>There&apos;s free source code available for a FFTW dll for Windows, which I have<br/>compiled and used with the FFTW preview beta. However the tiny speed improvement<br/>doesn&apos;t seem to be worth it, not even noticeable at all, unless one needs the<br/>non powers of two. I may add it in as an option anyway if the plug in idea<br/>is acceptable.</p><p>For the complex FFT I still actually use Graham Breed&apos;s code which he coded<br/>from description of the algorithm in a book on FFT. In practice I find it<br/>is about as fast as FFTW for complex transforms, if one adds a look up sine<br/>table to it!</p><p>It&apos;s also a very short algorithm, - about 100 lines including the look up table<br/>- while Ooura&apos;s real FFT, which is perhaps twice as fast, is getting on for<br/>2000 lines of code. Much of that speed improvement is prob. due to it being<br/>a real FFT - which one can also do by calling a complex FFT and post / pre<br/>processing the arguments with a few lines of code (though I haven&apos;t quite<br/>figured out how one does that, and don&apos;t need to having a very fast real<br/>FFT to hand anyway).</p><p>So, I think this is a field where a lot of research is going into small tweaks<br/>to speed up the algorithm slightly, except of course for the case of non powers<br/>of two, where FFTW rules as far as I gather.</p><p>&gt; Also, there are ways of getting around (eliminating)<br/>&gt; the trade off between frequency resolution and time<br/>&gt; resolution. My stating that such methods exist should<br/>&gt; be sufficient to trigger an &apos;aha!&apos; in the sufficiently<br/>&gt; clever reader. (Right, Robert? It&apos;s easy once you<br/>&gt; realize that it -can- be gotten around easily. I&apos;m<br/>&gt; betting you&apos;ll be able to guess this one fairly<br/>&gt; easily.)</p><p>I can&apos;t imagine what you mean by this. However, I remember you saying you<br/>have some neat ideas in the area of FFT.</p><p>Robert</p></div><h3><a id=1071 href="#1071">ðŸ”—</a>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>8/29/2001 8:03:15 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Brian,</p><p>The QM analogy for FFT is an interesting one, and I think I&apos;ve<br/>seen it used before for FFT somewhere. However, I think it is not exact.<br/>It&apos;s an interesting topic to discuss perhaps.</p><p>- in QM you can&apos;t simultaneously find position and momentum,<br/>but you can find each individually to whatever accuracy you<br/>like, given enough energy for the measurements.</p><p>So far, that&apos;s analagous to frequency / time in FFT.</p><p>However, in QM (and here I&apos;m just relying on popular accounts of<br/>QM I must say), the data is lost to future measurements,<br/>according to the uncertainty principle, because by making<br/>the measurement you have changed the thing you are measuring.<br/>Also all possible measurements methods have to change the data,<br/>according to the theory (if correct of course!). So once you<br/>meauser the momentum to the best accuracy you can, then it is<br/>no longer possible to find the position, because, e.g., the<br/>electron has moved to a new unpredictable position as a<br/>result of your determination of its momentum to great accuracy.</p><p>Determine its new position to great accuracy, and you still<br/>can&apos;t backtrack and find where it came from. E.g. perhaps<br/>you found the momentum by bouncing it off something,<br/>perhaps another particle in a particle accelerator,<br/>but the thing you bounced it off has moved, and both<br/>moved in unpredictable ways, so even though you knew<br/>its momentum to tremendous accuracy at that point,<br/>you had minimal knowledge of where it was (just enough<br/>to know that it was within the region of the measureing<br/>apparatus perhaps).</p><p>In FFT, the data is still there whatever you do, and so<br/>even if there are similarities of one kind or another,<br/>it can&apos;t be an exactly analagous situation, or so it seems<br/>to me.</p><p>So, is the uncertainty in the FFT a result of the method<br/>one is using, or is it in some way intrinsic in the<br/>data, and if so, to what extent?</p><p>If you have a simple sine wave, with rapidly varying<br/>frequency, you can track it pretty well by wave counting,<br/>and do much better that way than with FFT. One can<br/>get very accurate results by suitable interpolation<br/>of the crossing points. this is something I&apos;ve tried and<br/>it works.</p><p>I think that if one knew that the data one is tracking actually _is_ a sine<br/>wave varying in frequency - one could do even better by looking for the<br/>single best fit sine wave for any sequence of data points.<br/>Suppose one also knows that it is unvarying in amplitude<br/>- one could imagine a real application in which both<br/>of those things were true. Then I rather expect one could do very<br/>well indeed with wave counting.</p><p>This shows that hte uncertainty of frequency isn&apos;t something<br/>that has to show up in all possible measruements of the<br/>data (as in QM theory, where no experiment, however well<br/>conceived, will work, according to the theory), but something specific to the<br/>particular way one is matching a measurement technique<br/>with the data and ones assumptions about the data.</p><p>There will always have to be some assumptions about the data<br/>as it is finite and anything could be happening between the<br/>sample points. In principle (though with very low probablility)<br/>one might get a perfect wave form from a sampling of<br/>pure noise. But in practice, with very high probability,<br/>near certainty, if the data appears continuous, then<br/>it is, with maybe tiny ripples superimposed too small<br/>to see with the data set.</p><p>So that leaves open the possiblity of improving frequency + time<br/>accuracy, either by more refined FFT methods (such as<br/>peak interpolation) or by other techniques (wavelets,<br/>or wave counting). All this dependent on what the<br/>particular data is, and what kinds of assumptions are<br/>reasonable to make about it.</p><p>This is something of practical relevance to me - in the<br/>wave counting section of FTS I&apos;m trying to do exactly this<br/>- to improve both pitch and time resolution simultaneously<br/>for a single melody line. If the timbre is suitable, it<br/>seems one can improve on FFT by a fair amount, as my<br/>bird songs page demonstrates - this would be impossible<br/>to do with FFT I venture to suggest, because of the<br/>rapid changes in pitch (but very happy to be proved wrong).</p><p>I&apos;ve posted the birdsong url here before, but here is<br/>the new location for it:<br/><a href="http://members.tripod.com/~robertinventor/tunes/birdsong.htm">http://members.tripod.com/~robertinventor/tunes/birdsong.htm</a></p><p>Robert</p></div>
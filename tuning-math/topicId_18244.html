<a href="/tuning-math">back to list</a><h1>Lattices with Pari/GP</h1><h3><a id=18244 href="#18244">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>10/22/2010 7:27:15 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>I was using Sage before, which is a huge application that<br/>draws together many free and, if you have them, proprietary<br/>and expensive mathematical packages.  I noticed that most<br/>of the clever functions I was using came from Pari.  I&apos;m<br/>now using GP, which is a front end for Pari and nothing<br/>else.</p><p>Here&apos;s some code for the parametric extension of scalar<br/>badness that I&apos;m now calling Cangwu badness:</p><p>Cangwu metric(plimit,Ek) = {<br/>    local(size, H, W, scale);<br/>    size = primepi(plimit);<br/>    H = log(primes(size))/log(2);<br/>    W = matrix(size,size,i,j,(i==j)/H[i]);<br/>    scale = H*W^2*H~;<br/>    W^2*(1+Ek^2)/scale-W^2*H~*H*W^2/scale^2<br/>}</p><p>Cangwu badness(mapping, Ek) = {<br/>    local(plimit, operator);<br/>    plimit = prime(matsize(mapping)[1]);<br/>    operator = Cangwu metric(plimit, Ek);<br/>    sqrt(matdet(mapping~ * operator * mapping))<br/>}</p><p>See <a href="http://x31eq.com/badness.pdf">http://x31eq.com/badness.pdf</a> for my best explanation of<br/>what it&apos;s for.  The mapping is by columns instead of rows<br/>because Pari prefers things that way.  As an example, try</p><p>Cangwu badness([31;49;72;87;107;115], 1/1200)*1200</p><p>which duplicates an example from page 5 of the PDF.  Or</p><p>Cangwu badness([31,41;49,65;72,95;87,115;107,142;115,152],<br/>1/1200)*1200</p><p>(all on one line) for a Miracle from page 9.</p><p>One nice thing about Cangwu badness is that it constitutes<br/>a quadratic form, and qualifies as a lattice norm.  It<br/>happens that Pari knows about such things, and has a<br/>function for finding equal temperaments:</p><p>G = Cangwu metric(11, 1/12e2);<br/>qfminim(G, 0.005, 10, 2)[3]</p><p>This gives</p><p>[-31 -12 41 72 15 46 27 58 -14 22]</p><p>[-49 -19 65 114 24 73 43 92 -22 35]</p><p>[-72 -28 95 167 35 107 63 135 -32 51]</p><p>[-87 -34 115 202 42 129 76 163 -39 62]</p><p>[-107 -42 142 249 52 159 94 201 -48 76]</p><p>They&apos;re as columns, so the first row is the number of steps<br/>to the octave.</p><p>A different algorithm only works with integers, but doesn&apos;t<br/>require the cutoff to be specified.</p><p>qfminim(round(G*1e10), 0, 10, 0)[3]</p><p>gives only the 31 note mapping.</p><p>You can also get the best equal temperaments for a given<br/>rank 2 mapping:</p><p>meantone = [31, 12; 49, 19; 72, 28; 87, 34; 107, 42]<br/>meantone*qfminim(meantone~*G*meantone, 0.006, 10, 2)[3]</p><p>gives</p><p>[31 12 -19]</p><p>[49 19 -30]</p><p>[72 28 -44]</p><p>[87 34 -53]</p><p>[107 42 -65]</p><p>For another trick, find the simplest ETs according to<br/>scalar complexity:</p><p>complexity metric(plimit) = {<br/>    local(size, H, W);<br/>    size = primepi(plimit);<br/>    H = log(primes(size))/log(2);<br/>    W = matrix(size,size,i,j,(i==j)/H[i]);<br/>    W^2 / (H*W^2*H~)<br/>}</p><p>complexity(mapping) = {<br/>    /* scalar complexity */<br/>    local(plimit, operator);<br/>    plimit = prime(matsize(mapping)[1]);<br/>    operator = complexity metric(plimit);<br/>    sqrt(matdet(mapping~ * operator * mapping))<br/>}</p><p>meantone*qfminim(meantone~*K*meantone, 3, 10, 2)[3]</p><p>gives</p><p>[1 2]</p><p>[1 3]</p><p>[0 4]</p><p>[-3 4]</p><p>[-7 4]</p><p>We can also look at stupidly high prime limits. It turns<br/>out that the error parameter has to be stupidly low to get<br/>what pass for sensible results.  The simplest equal<br/>temperaments it&apos;ll vouch for over all 2 digit ratios have<br/>5,882,736 and 3,386,123 steps to the octave.  They probably<br/>aren&apos;t consistent.  You can get the mappings from</p><p>qfminim(Cangwu metric(100, 1e-9), 0.0008, 10, 2)[3]</p><p>                      Graham</p></div>
<!DOCTYPE html>
            <html>
            <head>
            <meta charset="utf-8">
                <meta name="viewport"
            content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
                <meta http-equiv="x-ua-compatible" content="ie=edge">
                <title>Yahoo Tuning Groups Ultimate Backup tuning-math help with ratio/vector algorithm</title>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            </head>
            <body>
            </body>
            </html>
        <a href="/tuning-math">back to list</a><h1>help with ratio/vector algorithm</h1><h3><a id=3414 href="#3414">ðŸ”—</a>monz &#x3C;joemonz@yahoo.com&#x3E;</h3><span>3/3/2002 7:27:00 PM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>i need help with an algorithm.</p><p>within the 3-limit, i&apos;m trying to get an Excel<br/>spreadsheet to automatically calculate the exponent<br/>of 2 when it knows the exponent of 3, so that the<br/>resulting ratio is in the usual form where n &gt; d.</p><p>my first attempt worked fairly well, but had a<br/>few systematic errors.  i&apos;ll give it in a format<br/>that will look familiar to programmers:</p><p>ratio r = 2^p * 3^q</p><p>if q &lt; 0<br/>   then p =  int((log(3^abs(q)) / log(2)) + 0.5)<br/>   else p = (int((log(3^abs(q)) / log(2)) + 1.5)) * -1<br/>end if</p><p>but it&apos;s not foolproof: sometimes the exponent of 2 is<br/>one less or one more than it should be.  i&apos;ve tried<br/>setting up further nested if-statements, to check if<br/>the absolute value of p is greater than that of q and<br/>adjust accordingly, but there&apos;s always an error somewhere.</p><p>help!</p><p>-monz</p><p>_________________________________________________________<br/>Do You Yahoo!?<br/>Get your free <a href="https://twitter.com/yahoo">@yahoo</a>.com address at <a href="http://mail.yahoo.com">http://mail.yahoo.com</a></p></div><h3><a id=3415 href="#3415">ðŸ”—</a>monz &#x3C;joemonz@yahoo.com&#x3E;</h3><span>3/3/2002 7:33:39 PM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>&gt; From: monz &lt;<a href="mailto:joemonz@yahoo.com">joemonz@yahoo.com</a>&gt;<br/>&gt; To: &lt;<a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>&gt;<br/>&gt; Sent: Sunday, March 03, 2002 7:27 PM<br/>&gt; Subject: [tuning-math] help with ratio/vector algorithm<br/>&gt;<br/>&gt;<br/>&gt; i need help with an algorithm.<br/>&gt;<br/>&gt; within the 3-limit, i&apos;m trying to get an Excel<br/>&gt; spreadsheet to automatically calculate the exponent<br/>&gt; of 2 when it knows the exponent of 3, so that the<br/>&gt; resulting ratio is in the usual form where n &gt; d.<br/>&gt;<br/>&gt; my first attempt worked fairly well, but had a<br/>&gt; few systematic errors.  i&apos;ll give it in a format<br/>&gt; that will look familiar to programmers:<br/>&gt;<br/>&gt; ratio r = 2^p * 3^q<br/>&gt;<br/>&gt; if q &lt; 0<br/>&gt;    then p =  int((log(3^abs(q)) / log(2)) + 0.5)<br/>&gt;    else p = (int((log(3^abs(q)) / log(2)) + 1.5)) * -1<br/>&gt; end if<br/>&gt;<br/>&gt; but it&apos;s not foolproof: sometimes the exponent of 2 is<br/>&gt; one less or one more than it should be.  i&apos;ve tried<br/>&gt; setting up further nested if-statements, to check if<br/>&gt; the absolute value of p is greater than that of q and<br/>&gt; adjust accordingly, but there&apos;s always an error somewhere.</p><p>the errors are occurring because the spreadsheet has to<br/>check to see if n &gt; d, and i can&apos;t figure out how to<br/>implement that without getting a circular reference.</p><p>-monz</p><p>_________________________________________________________<br/>Do You Yahoo!?<br/>Get your free <a href="https://twitter.com/yahoo">@yahoo</a>.com address at <a href="http://mail.yahoo.com">http://mail.yahoo.com</a></p></div><h3><a id=3429 href="#3429">ðŸ”—</a>graham@microtonal.co.uk</h3><span>3/4/2002 3:34:00 AM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>In-Reply-To: &lt;<a href="mailto:004101c1c32d$603c6540$af48620c@dsl.att.net">004101c1c32d$603c6540$af48620c@dsl.att.net</a>&gt;<br/>monz wrote:</p><p>&gt; &gt; ratio r = 2^p * 3^q<br/>&gt; &gt;<br/>&gt; &gt; if q &lt; 0<br/>&gt; &gt;    then p =  int((log(3^abs(q)) / log(2)) + 0.5)<br/>&gt; &gt;    else p = (int((log(3^abs(q)) / log(2)) + 1.5)) * -1<br/>&gt; &gt; end if<br/>&gt; &gt;<br/>&gt; &gt; but it&apos;s not foolproof: sometimes the exponent of 2 is<br/>&gt; &gt; one less or one more than it should be.  i&apos;ve tried<br/>&gt; &gt; setting up further nested if-statements, to check if<br/>&gt; &gt; the absolute value of p is greater than that of q and<br/>&gt; &gt; adjust accordingly, but there&apos;s always an error somewhere.<br/>&gt;<br/>&gt;<br/>&gt; the errors are occurring because the spreadsheet has to<br/>&gt; check to see if n &gt; d, and i can&apos;t figure out how to<br/>&gt; implement that without getting a circular reference.</p><p>I think =MOD(N20, 1)-N20 does it where N20 is the magnitude of the<br/>original interval in octaves.  So you have to substitute that with<br/>log(3^abs(q)) / log(2).</p><p>                       Graham</p></div><h3><a id=3436 href="#3436">ðŸ”—</a>Robert Walker &#x3C;robertwalker@ntlworld.com&#x3E;</h3><span>3/4/2002 4:49:12 PM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Monz,</p><p>It could be your (int)(expression + 0.5)</p><p>In this type of situation sometimes one needs<br/>(int)(expression + 1e-12), or (int)(expression - 1e-12).<br/>- replace 1e-12 by whatever precision you have.</p><p>It is usually 1e-14 for double precision arithmetic; one could add<br/>a bit extra so say 1e-12 to have plenty of leeway.</p><p>That&apos;s because you are looking for the first integer above (or below)<br/>rather than the nearest integer. The nearest integer will sometimes<br/>be above, and sometimes be below.</p><p>Alternatively, find p, do the calculation, and then at the end<br/>after you have calculated p, in a separate step,<br/>check to see if the ratio is below 1. If so, add 1,<br/>or if it is above 2, subtract 1 at the end.</p><p>Robert</p></div><h3><a id=3440 href="#3440">ðŸ”—</a>paulerlich &#x3C;paul@stretch-music.com&#x3E;</h3><span>3/5/2002 1:12:49 PM</span><button style="float: right; margin-right: 20px">toggle monospace</button><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In tuning-math@y..., graham@m... wrote:<br/>&gt; In-Reply-To: &lt;004101c1c32d$603c6540$af48620c@d...&gt;<br/>&gt; monz wrote:<br/>&gt;<br/>&gt; &gt; &gt; ratio r = 2^p * 3^q<br/>&gt; &gt; &gt;<br/>&gt; &gt; &gt; if q &lt; 0<br/>&gt; &gt; &gt;    then p =  int((log(3^abs(q)) / log(2)) + 0.5)<br/>&gt; &gt; &gt;    else p = (int((log(3^abs(q)) / log(2)) + 1.5)) * -1<br/>&gt; &gt; &gt; end if<br/>&gt; &gt; &gt;<br/>&gt; &gt; &gt; but it&apos;s not foolproof: sometimes the exponent of 2 is<br/>&gt; &gt; &gt; one less or one more than it should be.  i&apos;ve tried<br/>&gt; &gt; &gt; setting up further nested if-statements, to check if<br/>&gt; &gt; &gt; the absolute value of p is greater than that of q and<br/>&gt; &gt; &gt; adjust accordingly, but there&apos;s always an error somewhere.<br/>&gt; &gt;<br/>&gt; &gt;<br/>&gt; &gt; the errors are occurring because the spreadsheet has to<br/>&gt; &gt; check to see if n &gt; d, and i can&apos;t figure out how to<br/>&gt; &gt; implement that without getting a circular reference.<br/>&gt;<br/>&gt; I think =MOD(N20, 1)-N20 does it where N20 is the magnitude of the<br/>&gt; original interval in octaves.  So you have to substitute that with<br/>&gt; log(3^abs(q)) / log(2).<br/>&gt;<br/>&gt;<br/>&gt;                        Graham</p><p>in my periodicity block programs, i have a line that brings all<br/>ratios to the octave between 1/1 and 2/1:</p><p>r=r./2.^(floor(log(r)/log(2)));</p></div>
                <script>
                    let monospace = false
                    $('button').on('click', function () {
                      if (monospace) {
                        $('p').css("font-family", "")
                      } else {
                        $('p').css("font-family", "monospace")
                      }
                      monospace = !monospace
                    })
                </script>
            
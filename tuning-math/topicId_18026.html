<a href="/tuning-math">back to list</a><h1>Unison Vectors from Sage</h1><h3>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>7/15/2010 1:57:01 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>It&apos;s alarmingly easy to get unison vectors out of Sage, so here are<br/>the full instructions.  First, define the mapping for meantone like<br/>so:</p><p>M = matrix([[19, 30, 44, 53], [12, 19, 28, 34]])</p><p>Get the unison vectors as</p><p>M.transpose().kernel_matrix()</p><p>This is not in echelon form, and the result is generally simpler than<br/>echelon form.  There is an option</p><p>M.transpose().kernel_matrix(LLL=True)</p><p>which doesn&apos;t make any difference in this case.  And the result is</p><p>[ 1  2 -3  1]<br/>[ 4 -4  1  0]</p><p>which means 126:125 and 81:80.</p><p>It looks like the hard work is done by PARI, which GP is also a<br/>wrapper around.  So that&apos;s where to go to find the method.</p><p>There are some other nice things Sage does, like</p><p>M.row_space()</p><p>gives</p><p>Free module of degree 4 and rank 2 over Integer Ring<br/>Echelon basis matrix:<br/>[  1   0  -4 -13]<br/>[  0   1   4  10]</p><p>which is essentially an object representing the temperament class.<br/>You can test if an equal temperament belongs to it:</p><p>vector([43, 68, 100, 121]) in M.row_space()</p><p>is true but</p><p>vector([41, 65, 95, 115]) in M.row_space()</p><p>is false.</p><p>To get that echelon basis matrix directly:</p><p>M.echelon_form()</p><p>Because the Sage interpreter is Python with a pre-processor, it&apos;s very<br/>easy to call my Python modules from it.  So this hopefully checks that<br/>the kernel basis never has torsion:</p><p>import parametric, regular, temper<br/>plimit = regular.limit11<br/>for rt in parametric.survey2(plimit, 1/12e2, 1000):<br/>    M = matrix(rt.melody)<br/>    uvs = M.transpose().kernel_matrix()<br/>    w = reduce(temper.wedgeProduct, uvs).flatten()<br/>    assert gcd(w)==1</p><p>And a rank 3 test:</p><p>import parametric, regular, temper<br/>plimit = regular.limit11<br/>for rt in parametric.survey(3, plimit, 1/12e2, 1000):<br/>    M = matrix(rt.melody)<br/>    uvs = M.transpose().kernel_matrix()<br/>    w = reduce(temper.wedgeProduct, uvs).flatten()<br/>    assert gcd(w)==1</p><p>Both pass.</p><p>What I haven&apos;t worked out how to do yet is find the Smith normal form.</p><p>                          Graham</p></div><h3>Carl Lumma &#x3C;carl@lumma.org&#x3E;</h3><span>7/15/2010 2:11:08 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>That&apos;s pretty sweet!  -Carl</p><p>At 01:57 AM 7/15/2010, you wrote:<br/>&gt;Content-Transfer-Encoding: 7bit<br/>&gt;<br/>&gt;It&apos;s alarmingly easy to get unison vectors out of Sage, so here are<br/>&gt;the full instructions.  First, define the mapping for meantone like<br/>&gt;so:<br/>&gt;<br/>&gt;M = matrix([[19, 30, 44, 53], [12, 19, 28, 34]])<br/>&gt;<br/>&gt;Get the unison vectors as<br/>&gt;<br/>&gt;M.transpose().kernel_matrix()<br/>&gt;<br/>&gt;This is not in echelon form, and the result is generally simpler than<br/>&gt;echelon form.  There is an option<br/>&gt;<br/>&gt;M.transpose().kernel_matrix(LLL=True)<br/>&gt;<br/>&gt;which doesn&apos;t make any difference in this case.  And the result is<br/>&gt;<br/>&gt;[ 1  2 -3  1]<br/>&gt;[ 4 -4  1  0]<br/>&gt;<br/>&gt;which means 126:125 and 81:80.<br/>&gt;<br/>&gt;It looks like the hard work is done by PARI, which GP is also a<br/>&gt;wrapper around.  So that&apos;s where to go to find the method.<br/>&gt;<br/>&gt;There are some other nice things Sage does, like<br/>&gt;<br/>&gt;M.row_space()<br/>&gt;<br/>&gt;gives<br/>&gt;<br/>&gt;Free module of degree 4 and rank 2 over Integer Ring<br/>&gt;Echelon basis matrix:<br/>&gt;[  1   0  -4 -13]<br/>&gt;[  0   1   4  10]<br/>&gt;<br/>&gt;which is essentially an object representing the temperament class.<br/>&gt;You can test if an equal temperament belongs to it:<br/>&gt;<br/>&gt;vector([43, 68, 100, 121]) in M.row_space()<br/>&gt;<br/>&gt;is true but<br/>&gt;<br/>&gt;vector([41, 65, 95, 115]) in M.row_space()<br/>&gt;<br/>&gt;is false.<br/>&gt;<br/>&gt;To get that echelon basis matrix directly:<br/>&gt;<br/>&gt;M.echelon_form()<br/>&gt;<br/>&gt;Because the Sage interpreter is Python with a pre-processor, it&apos;s very<br/>&gt;easy to call my Python modules from it.  So this hopefully checks that<br/>&gt;the kernel basis never has torsion:<br/>&gt;<br/>&gt;import parametric, regular, temper<br/>&gt;plimit = regular.limit11<br/>&gt;for rt in parametric.survey2(plimit, 1/12e2, 1000):<br/>&gt;    M = matrix(rt.melody)<br/>&gt;    uvs = M.transpose().kernel_matrix()<br/>&gt;    w = reduce(temper.wedgeProduct, uvs).flatten()<br/>&gt;    assert gcd(w)==1<br/>&gt;<br/>&gt;And a rank 3 test:<br/>&gt;<br/>&gt;import parametric, regular, temper<br/>&gt;plimit = regular.limit11<br/>&gt;for rt in parametric.survey(3, plimit, 1/12e2, 1000):<br/>&gt;    M = matrix(rt.melody)<br/>&gt;    uvs = M.transpose().kernel_matrix()<br/>&gt;    w = reduce(temper.wedgeProduct, uvs).flatten()<br/>&gt;    assert gcd(w)==1<br/>&gt;<br/>&gt;Both pass.<br/>&gt;<br/>&gt;What I haven&apos;t worked out how to do yet is find the Smith normal form.<br/>&gt;<br/>&gt;<br/>&gt;                          Graham<br/>&gt;</p></div><h3>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>7/15/2010 4:30:09 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Some more fun with this: the term for a matrix without torsion that<br/>came out of Gene&apos;s correspondence was &quot;saturation&quot;.  Well, Sage can<br/>find that directly.  So it&apos;s simple to tell if two mapping matrices<br/>define the same temperament class, or one is a contorted version of<br/>the other.  Here&apos;s the example:</p><p>vicentino = matrix([[7, 11, 16], [31, 49, 72]])<br/>meantone = matrix([[19, 30, 44], [31, 49, 72]])<br/>print meantone.index_in_saturation()<br/>print vicentino.index_in_saturation()<br/>print vicentino.saturation() == meantone.saturation()<br/>print vicentino.saturation().echelon_form() == meantone.echelon_form()<br/>print vicentino.row_space() == meantone.row_space()<br/>print vicentino.right_kernel() == meantone.right_kernel()<br/>print vicentino.saturation().row_space() == meantone.row_space()</p><p>It gives:</p><p>1<br/>2<br/>False<br/>True<br/>False<br/>True<br/>True</p><p>I&apos;m guessing that index_in_saturation() is giving the contorsion but I<br/>don&apos;t understand the help message so I can&apos;t be sure.</p><p>There&apos;s also a smith_form() method for the lower level algorithm.</p><p>              Graham</p></div><h3>genewardsmith &#x3C;genewardsmith@sbcglobal.net&#x3E;</h3><span>7/15/2010 12:52:39 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Graham Breed &lt;gbreed@...&gt; wrote:<br/>&gt;<br/>&gt; It&apos;s alarmingly easy to get unison vectors out of Sage, so here are<br/>&gt; the full instructions.  First, define the mapping for meantone like<br/>&gt; so:<br/>&gt;<br/>&gt; M = matrix([[19, 30, 44, 53], [12, 19, 28, 34]])<br/>&gt;<br/>&gt; Get the unison vectors as<br/>&gt;<br/>&gt; M.transpose().kernel_matrix()</p><p>The old Maple routines didn&apos;t do this right, but they&apos;ve completely reworked linear algebra and I find NullSpace works just the same way.</p><p>&gt; Free module of degree 4 and rank 2 over Integer Ring<br/>&gt; Echelon basis matrix:<br/>&gt; [  1   0  -4 -13]<br/>&gt; [  0   1   4  10]<br/>&gt;<br/>&gt; which is essentially an object representing the temperament class.</p><p>It&apos;s also the Hermite normal form.</p><p>&gt; What I haven&apos;t worked out how to do yet is find the Smith normal form.</p><p>What&apos;s the hangup?</p></div><h3>genewardsmith &#x3C;genewardsmith@sbcglobal.net&#x3E;</h3><span>7/15/2010 1:09:07 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, &quot;genewardsmith&quot; &lt;genewardsmith@...&gt; wrote:</p><p>&gt; The old Maple routines didn&apos;t do this right, but they&apos;ve completely reworked linear algebra and I find NullSpace works just the same way.</p><p>Eh, no, it seems it doesn&apos;t. But the saturation thing can easily cure what ails it.</p></div><h3>genewardsmith &#x3C;genewardsmith@sbcglobal.net&#x3E;</h3><span>7/15/2010 1:50:58 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Graham Breed &lt;gbreed@...&gt; wrote:</p><p>&gt; I&apos;m guessing that index_in_saturation() is giving the contorsion but I<br/>&gt; don&apos;t understand the help message so I can&apos;t be sure.</p><p>The index of one abelian group in another can be defined in terms of the size of the quotient group, so you might say it&apos;s pretty explicitly about torsion/contorsion.</p><p>Here&apos;s something more or less relevant:</p><p><a href="http://xenharmonic.wikispaces.com/Just+intonation+subgroups">http://xenharmonic.wikispaces.com/Just+intonation+subgroups</a></p></div><h3>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>7/16/2010 1:59:14 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On 15 July 2010 21:50, genewardsmith &lt;<a href="mailto:genewardsmith@sbcglobal.net">genewardsmith@sbcglobal.net</a>&gt; wrote:<br/>&gt;<br/>&gt;<br/>&gt; --- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Graham Breed &lt;gbreed@...&gt; wrote:<br/>&gt;<br/>&gt;&gt; I&apos;m guessing that index_in_saturation() is giving the contorsion but I<br/>&gt;&gt; don&apos;t understand the help message so I can&apos;t be sure.<br/>&gt;<br/>&gt; The index of one abelian group in another can be defined in terms of the size of the quotient group, so you might say it&apos;s pretty explicitly about torsion/contorsion.</p><p>That means the index labels contorsion, does it?  Same as the GCD of<br/>the wedge product.</p><p>&gt; Here&apos;s something more or less relevant:<br/>&gt;<br/>&gt; <a href="http://xenharmonic.wikispaces.com/Just+intonation+subgroups">http://xenharmonic.wikispaces.com/Just+intonation+subgroups</a></p><p>It doesn&apos;t seem to help me understand torsion.</p><p>          Graham</p></div><h3>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>7/16/2010 2:13:25 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On 15 July 2010 20:52, genewardsmith &lt;<a href="mailto:genewardsmith@sbcglobal.net">genewardsmith@sbcglobal.net</a>&gt; wrote:<br/>&gt;<br/>&gt; --- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Graham Breed &lt;gbreed@...&gt; wrote:<br/>&gt;&gt;<br/>&gt;&gt; Free module of degree 4 and rank 2 over Integer Ring<br/>&gt;&gt; Echelon basis matrix:<br/>&gt;&gt; [ &nbsp;1 &nbsp; 0 &nbsp;-4 -13]<br/>&gt;&gt; [ &nbsp;0 &nbsp; 1 &nbsp; 4 &nbsp;10]<br/>&gt;&gt;<br/>&gt;&gt; which is essentially an object representing the temperament class.<br/>&gt;<br/>&gt; It&apos;s also the Hermite normal form.</p><p>Sage treats echelon_form and hermite_form as synonyms, yes.  But the<br/>object there isn&apos;t a matrix in echelon form it&apos;s only being<br/>represented that way.</p><p>For another example, this is 13-limit mystery:</p><p>Free module of degree 6 and rank 4 over Integer Ring<br/>Echelon basis matrix:<br/>[  1   0   0   3  -7   4]<br/>[  0   1   0   5 -12   7]<br/>[  0   0   1   6 -28  21]<br/>[  0   0   0   7 -26  19]</p><p>Actually, according to Wikipedia that is Hermite normal form.  So<br/>that&apos;s what I&apos;ve been using as my standard reduction.  But I&apos;m sure<br/>I&apos;ve seen definitions that say the fourth column should be mostly<br/>negative, which is a better way of defining a Hermite reduced basis of<br/>unison vectors.  You should also reverse the vectors to do the<br/>reduction, of course.</p><p>&gt;&gt; What I haven&apos;t worked out how to do yet is find the Smith normal form.<br/>&gt;<br/>&gt; What&apos;s the hangup?</p><p>It showed up on the extreme right hand side of the dir() listing, and<br/>I missed it.</p><p>I&apos;ve confirmed that all the clever stuff is being delegated to PARI.<br/>So if somebody wants to look at it without the overhead of a full Sage<br/>installation (or a web connection), PARI&apos;s the thing to go for.</p><p>                 Graham</p></div><h3>genewardsmith &#x3C;genewardsmith@sbcglobal.net&#x3E;</h3><span>7/16/2010 9:37:04 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Graham Breed &lt;gbreed@...&gt; wrote:</p><p>&gt; &gt; The index of one abelian group in another can be defined in terms of the size of the quotient group, so you might say it&apos;s pretty explicitly about torsion/contorsion.<br/>&gt;<br/>&gt; That means the index labels contorsion, does it?  Same as the GCD of<br/>&gt; the wedge product.</p><p>Exactly.</p></div><h3>genewardsmith &#x3C;genewardsmith@sbcglobal.net&#x3E;</h3><span>7/16/2010 9:44:25 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Graham Breed &lt;gbreed@...&gt; wrote:</p><p>&gt; I&apos;ve confirmed that all the clever stuff is being delegated to PARI.<br/>&gt; So if somebody wants to look at it without the overhead of a full Sage<br/>&gt; installation (or a web connection), PARI&apos;s the thing to go for.</p><p>Pari is a terrific program which I have mentioned before. I am sorry I didn&apos;t know it came in a Python wrapper. It&apos;s written in C, runs fast, and has scads of powerful number theory functions.</p></div>
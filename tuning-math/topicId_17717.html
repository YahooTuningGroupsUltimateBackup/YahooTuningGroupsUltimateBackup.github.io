<a href="/tuning-math">back to list</a><h1>TOP-RMS in Scheme</h1><h3><a id=17717 href="#17717">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>5/7/2010 11:12:40 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Here&apos;s the full code for rank 2 TOP-RMS optimization in Scheme.  The<br/>standard meantone example is</p><p>(generators &apos;(31 49 72 87) &apos;(19 30 44 53) (limit 7))</p><p>which should give the &quot;Step Tunings&quot; from</p><p><a href="http://x31eq.com/cgi-bin/rt.cgi?ets=31+19&limit=7">http://x31eq.com/cgi-bin/rt.cgi?ets=31+19&limit=7</a></p><p>; Intervals are measured in terms of 2:1 octaves.<br/>(define prime-numbers &apos;(2 3 5 7 11 13 17 19 23 29 31))<br/>(define (log2 f) (/ (log f) (log 2)))<br/>(define primes (map log2 prime-numbers))</p><p>(define (limit n)<br/>    (let more-primes ((basis primes) (nums prime-numbers))<br/>        (cond<br/>            ((null? nums)     (display &quot;Number is not a registered prime&quot;))<br/>            ((= (car nums) n) (list (car basis)))<br/>            (else             (cons (car basis)<br/>                                    (more-primes (cdr basis) (cdr nums)))))))</p><p>(define (mean X) (/ (apply + X) (length X)))<br/>(define (square x) (* x x))<br/>(define (weight val basis) (map / val basis))</p><p>(define (generators val1 val2 basis)<br/>    (let* ((m1 (weight val1 basis))<br/>           (m2 (weight val2 basis))<br/>           (mm1 (mean m1))<br/>           (mm2 (mean m2))<br/>           (mm1sq (mean (map square m1)))<br/>           (mm2sq (mean (map square m2)))<br/>           (mm12  (mean (map * m1 m2)))<br/>           (common (/ 1200 (- (* mm1sq mm2sq) (square mm12)))))<br/>    (cons (* common (- (* mm1 mm2sq) (* mm2 mm12)))<br/>          (* common (- (* mm2 mm1sq) (* mm1 mm12))))))</p></div><h3><a id=17734 href="#17734">ðŸ”—</a>Carl Lumma &#x3C;carl@lumma.org&#x3E;</h3><span>5/8/2010 4:02:33 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Now here&apos;s something I can understand!  Except, what&apos;s<br/>&quot;common&quot;?  My scheme doesn&apos;t have it, anyway.  -C.</p><p>Graham wrote:</p><p>&gt;Here&apos;s the full code for rank 2 TOP-RMS optimization in Scheme.  The<br/>&gt;standard meantone example is<br/>&gt;<br/>&gt;(generators &apos;(31 49 72 87) &apos;(19 30 44 53) (limit 7))<br/>&gt;<br/>&gt;which should give the &quot;Step Tunings&quot; from<br/>&gt;<br/>&gt;<a href="http://x31eq.com/cgi-bin/rt.cgi?ets=31+19&limit=7">http://x31eq.com/cgi-bin/rt.cgi?ets=31+19&limit=7</a><br/>&gt;<br/>&gt;; Intervals are measured in terms of 2:1 octaves.<br/>&gt;(define prime-numbers &apos;(2 3 5 7 11 13 17 19 23 29 31))<br/>&gt;(define (log2 f) (/ (log f) (log 2)))<br/>&gt;(define primes (map log2 prime-numbers))<br/>&gt;<br/>&gt;(define (limit n)<br/>&gt;    (let more-primes ((basis primes) (nums prime-numbers))<br/>&gt;        (cond<br/>&gt;            ((null? nums)     (display &quot;Number is not a registered prime&quot;))<br/>&gt;            ((= (car nums) n) (list (car basis)))<br/>&gt;            (else             (cons (car basis)<br/>&gt;                                    (more-primes (cdr basis) (cdr nums)))))))<br/>&gt;<br/>&gt;(define (mean X) (/ (apply + X) (length X)))<br/>&gt;(define (square x) (* x x))<br/>&gt;(define (weight val basis) (map / val basis))<br/>&gt;<br/>&gt;(define (generators val1 val2 basis)<br/>&gt;    (let* ((m1 (weight val1 basis))<br/>&gt;           (m2 (weight val2 basis))<br/>&gt;           (mm1 (mean m1))<br/>&gt;           (mm2 (mean m2))<br/>&gt;           (mm1sq (mean (map square m1)))<br/>&gt;           (mm2sq (mean (map square m2)))<br/>&gt;           (mm12  (mean (map * m1 m2)))<br/>&gt;           (common (/ 1200 (- (* mm1sq mm2sq) (square mm12)))))<br/>&gt;    (cons (* common (- (* mm1 mm2sq) (* mm2 mm12)))<br/>&gt;          (* common (- (* mm2 mm1sq) (* mm1 mm12))))))<br/>&gt;<br/>&gt;<br/>&gt;------------------------------------<br/>&gt;<br/>&gt;Yahoo! Groups Links<br/>&gt;<br/>&gt;<br/>&gt;</p></div><h3><a id=17738 href="#17738">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>5/8/2010 5:04:22 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On 8 May 2010 15:02, Carl Lumma &lt;<a href="mailto:carl@lumma.org">carl@lumma.org</a>&gt; wrote:<br/>&gt; Now here&apos;s something I can understand! &nbsp;Except, what&apos;s<br/>&gt; &quot;common&quot;? &nbsp;My scheme doesn&apos;t have it, anyway. &nbsp;-C.</p><p>It&apos;s a chunk of calculations you need to do for both generators, and<br/>so can be assigned to a variable (or whatever let* defines) to save<br/>doing them twice.</p><p>                Graham</p></div><h3><a id=17741 href="#17741">ðŸ”—</a>Carl Lumma &#x3C;carl@lumma.org&#x3E;</h3><span>5/8/2010 2:49:46 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Graham wrote:</p><p>&gt;&gt; Now here&apos;s something I can understand!  Except, what&apos;s<br/>&gt;&gt; &quot;common&quot;?  My scheme doesn&apos;t have it, anyway.  -C.<br/>&gt;<br/>&gt;It&apos;s a chunk of calculations you need to do for both generators, and<br/>&gt;so can be assigned to a variable (or whatever let* defines) to save<br/>&gt;doing them twice.</p><p>Can you give the code for it?</p><p>-Carl</p></div><h3><a id=17743 href="#17743">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>5/8/2010 10:06:21 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On 9 May 2010 01:49, Carl Lumma &lt;<a href="mailto:carl@lumma.org">carl@lumma.org</a>&gt; wrote:<br/>&gt; Graham wrote:<br/>&gt;<br/>&gt;&gt;&gt; Now here&apos;s something I can understand! &nbsp;Except, what&apos;s<br/>&gt;&gt;&gt; &quot;common&quot;? &nbsp;My scheme doesn&apos;t have it, anyway. &nbsp;-C.<br/>&gt;&gt;<br/>&gt;&gt;It&apos;s a chunk of calculations you need to do for both generators, and<br/>&gt;&gt;so can be assigned to a variable (or whatever let* defines) to save<br/>&gt;&gt;doing them twice.<br/>&gt;<br/>&gt; Can you give the code for it?</p><p>What do you mean?  We&apos;re talking about the code for it.</p><p>                    Graham</p></div><h3><a id=17744 href="#17744">ðŸ”—</a>Carl Lumma &#x3C;carl@lumma.org&#x3E;</h3><span>5/8/2010 10:19:57 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>At 10:06 PM 5/8/2010, you wrote:<br/>&gt;<br/>&gt;On 9 May 2010 01:49, Carl Lumma &lt;<a href="mailto:carl@lumma.org">carl@lumma.org</a>&gt; wrote:<br/>&gt;&gt; Graham wrote:<br/>&gt;&gt;<br/>&gt;&gt;&gt;&gt; Now here&apos;s something I can understand!  Except, what&apos;s<br/>&gt;&gt;&gt;&gt; &quot;common&quot;?  My scheme doesn&apos;t have it, anyway.  -C.<br/>&gt;&gt;&gt;<br/>&gt;&gt;&gt;It&apos;s a chunk of calculations you need to do for both generators, and<br/>&gt;&gt;&gt;so can be assigned to a variable (or whatever let* defines) to save<br/>&gt;&gt;&gt;doing them twice.<br/>&gt;&gt;<br/>&gt;&gt; Can you give the code for it?<br/>&gt;<br/>&gt;What do you mean?  We&apos;re talking about the code for it.</p><p>For &quot;common&quot;.  If it&apos;s a keyword, my scheme doesn&apos;t have it.<br/>If it&apos;s a custom function, let&apos;s see it.</p><p>-Carl</p></div><h3><a id=17745 href="#17745">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>5/8/2010 10:23:34 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On 9 May 2010 09:19, Carl Lumma &lt;<a href="mailto:carl@lumma.org">carl@lumma.org</a>&gt; wrote:</p><p>&gt; For &quot;common&quot;. &nbsp;If it&apos;s a keyword, my scheme doesn&apos;t have it.<br/>&gt; If it&apos;s a custom function, let&apos;s see it.</p><p>It&apos;s not a keyword or a function.  It&apos;s a symbol, or a variable that<br/>doesn&apos;t vary.  I see the definition right there in my message, give or<br/>take trailing parentheses.:</p><p>(common (/ 1200 (- (* mm1sq mm2sq) (square mm12))))</p><p>If your Scheme barfs on the it, let&apos;s see the error message.</p><p>                    Graham</p></div><h3><a id=17756 href="#17756">ðŸ”—</a>Carl Lumma &#x3C;carl@lumma.org&#x3E;</h3><span>5/9/2010 1:30:59 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Graham wrote:</p><p>&gt;&gt; For &quot;common&quot;.  If it&apos;s a keyword, my scheme doesn&apos;t have it.<br/>&gt;&gt; If it&apos;s a custom function, let&apos;s see it.<br/>&gt;<br/>&gt;It&apos;s not a keyword or a function.  It&apos;s a symbol, or a variable that<br/>&gt;doesn&apos;t vary.  I see the definition right there in my message, give or<br/>&gt;take trailing parentheses.:<br/>&gt;(common (/ 1200 (- (* mm1sq mm2sq) (square mm12))))<br/>&gt;If your Scheme barfs on the it, let&apos;s see the error message.</p><p>Sorry I missed that.  Maybe I&apos;ll need eye work next.</p><p>Because I have log2 and mean in my libraries, and because I don&apos;t<br/>mind writing the formula for the basis in the input each time, I<br/>can use</p><p>(define (square x) (* x x))<br/>(define (weight val basis) (map / val basis))</p><p>(define generators<br/>   (lambda (val1 val2 basis)<br/>      (let* ((m1 (weight val1 basis))<br/>             (m2 (weight val2 basis))<br/>             (mm1 (mean m1))<br/>             (mm2 (mean m2))<br/>             (mm1sq (mean (map square m1)))<br/>             (mm2sq (mean (map square m2)))<br/>             (mm12  (mean (map * m1 m2)))<br/>             (common (/ 1200 (- (* mm1sq mm2sq) (square mm12)))))<br/>         (cons (* common (- (* mm1 mm2sq) (* mm2 mm12)))<br/>            (* common (- (* mm2 mm1sq) (* mm1 mm12)))))))</p><p>Whereupon</p><p>(generators &apos;(31 49 72 87) &apos;(19 30 44 53) (map log2 &apos;(2 3 5 7)))</p><p>yields</p><p>(33.437588751882345 . 8.667205527055183)</p><p>I wanted the tuning of the generator and period but hey, it&apos;s<br/>progress.  How many notes of the rank 2 temperament give these<br/>step sizes?</p><p>-Carl</p></div><h3><a id=17760 href="#17760">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>5/9/2010 2:52:06 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>On 9 May 2010 12:30, Carl Lumma &lt;<a href="mailto:carl@lumma.org">carl@lumma.org</a>&gt; wrote:</p><p>&gt; (generators &apos;(31 49 72 87) &apos;(19 30 44 53) (map log2 &apos;(2 3 5 7)))<br/>&gt;<br/>&gt; yields<br/>&gt;<br/>&gt; (33.437588751882345 . 8.667205527055183)<br/>&gt;<br/>&gt; I wanted the tuning of the generator and period but hey, it&apos;s<br/>&gt; progress. &nbsp;How many notes of the rank 2 temperament give these<br/>&gt; step sizes?</p><p>Oh, now *you* want the generator and period, do you?  This function<br/>happens not to need them.  You can feed in the generator/period<br/>mapping and you should get the generator/period tunings out.</p><p>What you have are the sizes of the 31-step and 19-step.  So you should<br/>get an octave as</p><p>(+ (* 31 33.437588751882345) (* 19 8.667205527055183))</p><p>and check it against the TOP-RMS stretch.</p><p>                   Graham</p></div>
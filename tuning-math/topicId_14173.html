<a href="/tuning-math">back to list</a><h1>monz FFT question</h1><h3><a id=14173 href="#14173">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>1/20/2006 11:55:33 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>OK, i&apos;ll just post my question here and welcome whatever<br/>answers i can get.</p><p>I&apos;m doing FFT (Fast Fourier Transform) spectral analysis of<br/>sampled sounds (in the form of .wav files). My software<br/>quantizes the specified frequency range into a number of<br/>&quot;buckets&quot; (for lack of a better term) which must be<br/>powers-of-2, and it will give maximum FFT resolution of<br/>16384 (= 2^14) &quot;buckets&quot; into which it quantizes the specified<br/>frequency range.</p><p>However, in order to get the 16384 resolution, my sampled<br/>sound needs to be at least 16384 samples long. At the standard<br/>sampling rate of 44100 samples per second, that translates into<br/>a section of the .wav file which is 0.371519274 second long.</p><p>The problem is: i want to be able to analyze the spectrum<br/>for much shorter periods of time, say around .01 second.</p><p>So i know that to do this i have to analyze two sections of<br/>the .wav file which are .01 second apart, and find some kind<br/>of &quot;delta&quot; (change) between them. I tried using a simple<br/>average (adding together the two amplitudes for each &quot;bucket&quot;<br/>and then dividing by 2), but i&apos;m sure that that&apos;s not the<br/>right way to do it.</p><p>I can&apos;t simply analyze sections of the .wav file which are<br/>only 0.01 second long, because that&apos;s only 441 samples and<br/>therefore the maximum resolution i can get is only 256 (= 2^8)<br/>&quot;buckets&quot;, and that&apos;s nowhere near fine enough.</p><p>So what&apos;s the proper method for doing this with the 16384<br/>resolution? Thanks.</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=14193 href="#14193">ðŸ”—</a>Herman Miller &#x3C;hmiller@IO.COM&#x3E;</h3><span>1/20/2006 8:55:09 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>monz wrote:<br/>&gt; OK, i&apos;ll just post my question here and welcome whatever<br/>&gt; answers i can get.<br/>&gt; &gt; I&apos;m doing FFT (Fast Fourier Transform) spectral analysis of<br/>&gt; sampled sounds (in the form of .wav files). My software &gt; quantizes the specified frequency range into a number of<br/>&gt; &quot;buckets&quot; (for lack of a better term) which must be<br/>&gt; powers-of-2, and it will give maximum FFT resolution of<br/>&gt; 16384 (= 2^14) &quot;buckets&quot; into which it quantizes the specified<br/>&gt; frequency range.<br/>&gt; &gt; However, in order to get the 16384 resolution, my sampled<br/>&gt; sound needs to be at least 16384 samples long. At the standard<br/>&gt; sampling rate of 44100 samples per second, that translates into<br/>&gt; a section of the .wav file which is 0.371519274 second long.<br/>&gt; &gt; The problem is: i want to be able to analyze the spectrum<br/>&gt; for much shorter periods of time, say around .01 second.<br/>&gt; &gt; So i know that to do this i have to analyze two sections of<br/>&gt; the .wav file which are .01 second apart, and find some kind<br/>&gt; of &quot;delta&quot; (change) between them. I tried using a simple<br/>&gt; average (adding together the two amplitudes for each &quot;bucket&quot;<br/>&gt; and then dividing by 2), but i&apos;m sure that that&apos;s not the<br/>&gt; right way to do it.<br/>&gt; &gt; I can&apos;t simply analyze sections of the .wav file which are<br/>&gt; only 0.01 second long, because that&apos;s only 441 samples and<br/>&gt; therefore the maximum resolution i can get is only 256 (= 2^8)<br/>&gt; &quot;buckets&quot;, and that&apos;s nowhere near fine enough.<br/>&gt; &gt; &gt; So what&apos;s the proper method for doing this with the 16384<br/>&gt; resolution? Thanks.</p><p>There&apos;s an inherent tradeoff between frequency resolution and time resolution with FFT, so what you&apos;re looking for might be tricky. You can get some information about the time domain by looking at the phase. In particular, you can get a better estimate of the frequency of a wave by comparing the relative phase from adjacent &quot;frames&quot;, and calculating what frequency would result in that phase difference over that length of time. Overlapping the frames is supposed to help with this. The results can also be improved by selecting an appropriate window for the FFT analysis.</p></div><h3><a id=14194 href="#14194">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>1/20/2006 9:23:42 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Herman,</p><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Herman Miller &lt;hmiller@I...&gt; wrote:</p><p>&gt; There&apos;s an inherent tradeoff between frequency resolution<br/>&gt; and time resolution with FFT, so what you&apos;re looking for<br/>&gt; might be tricky. You can get some information about the<br/>&gt; time domain by looking at the phase. In particular, you can<br/>&gt; get a better estimate of the frequency of a wave by<br/>&gt; comparing the relative phase from adjacent &quot;frames&quot;,<br/>&gt; and calculating what frequency would result in that phase<br/>&gt; difference over that length of time. Overlapping the<br/>&gt; frames is supposed to help with this. The results can<br/>&gt; also be improved by selecting an appropriate window<br/>&gt; for the FFT analysis.</p><p>Thanks. I am using the idea of overlapping frames, with<br/>the averaging method i described. But i&apos;m sure that<br/>averaging is not giving me good results. It might work,<br/>if i used a small enough time difference between the<br/>overlapping frames, but that would entail too much work.</p><p>Can you tell me how to do the phase calculations you<br/>describe? Can anyone else offer any help with this?</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=14195 href="#14195">ðŸ”—</a>Carl Lumma &#x3C;ekin@lumma.org&#x3E;</h3><span>1/20/2006 1:22:12 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>At 11:55 AM 1/20/2006, you wrote:<br/>&gt;OK, i&apos;ll just post my question here and welcome whatever<br/>&gt;answers i can get.<br/>&gt;<br/>&gt;I&apos;m doing FFT (Fast Fourier Transform) spectral analysis of<br/>&gt;sampled sounds (in the form of .wav files). My software<br/>&gt;quantizes the specified frequency range into a number of<br/>&gt;&quot;buckets&quot; (for lack of a better term) which must be<br/>&gt;powers-of-2, and it will give maximum FFT resolution of<br/>&gt;16384 (= 2^14) &quot;buckets&quot; into which it quantizes the specified<br/>&gt;frequency range.<br/>&gt;<br/>&gt;However, in order to get the 16384 resolution, my sampled<br/>&gt;sound needs to be at least 16384 samples long. At the standard<br/>&gt;sampling rate of 44100 samples per second, that translates into<br/>&gt;a section of the .wav file which is 0.371519274 second long.<br/>&gt;<br/>&gt;The problem is: i want to be able to analyze the spectrum<br/>&gt;for much shorter periods of time, say around .01 second.<br/>&gt;<br/>&gt;So i know that to do this i have to analyze two sections of<br/>&gt;the .wav file which are .01 second apart, and find some kind<br/>&gt;of &quot;delta&quot; (change) between them. I tried using a simple<br/>&gt;average (adding together the two amplitudes for each &quot;bucket&quot;<br/>&gt;and then dividing by 2), but i&apos;m sure that that&apos;s not the<br/>&gt;right way to do it.<br/>&gt;<br/>&gt;I can&apos;t simply analyze sections of the .wav file which are<br/>&gt;only 0.01 second long, because that&apos;s only 441 samples and<br/>&gt;therefore the maximum resolution i can get is only 256 (= 2^8)<br/>&gt;&quot;buckets&quot;, and that&apos;s nowhere near fine enough.<br/>&gt;<br/>&gt;So what&apos;s the proper method for doing this with the 16384<br/>&gt;resolution? Thanks.</p><p>There&apos;s no straightforward method -- you&apos;re running into the<br/>classical uncertainty principle.  You can use a moving, overlapping<br/>window to try and spot what you&apos;re looking for, depending on what<br/>that is.  Wavelets are related way to balance the tradeoffs --<br/>they&apos;re a generalized type of moving-window FFT (in a sense).</p><p>-Carl</p></div><h3><a id=14199 href="#14199">ðŸ”—</a>Graham Breed &#x3C;gbreed@gmail.com&#x3E;</h3><span>1/21/2006 9:01:44 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>monz wrote:</p><p>&gt; Thanks. I am using the idea of overlapping frames, with<br/>&gt; the averaging method i described. But i&apos;m sure that<br/>&gt; averaging is not giving me good results. It might work,<br/>&gt; if i used a small enough time difference between the<br/>&gt; overlapping frames, but that would entail too much work.</p><p>Getting hold of a text book would probably help.  These are well-trodden paths.  Sethares &quot;Tuning, Timbre, Spectrum, Scale&quot; has some details. The window is important.  There&apos;s also a description of extracting the pitch of a signal in The Csound Book.</p><p>&gt; Can you tell me how to do the phase calculations you<br/>&gt; describe? Can anyone else offer any help with this?</p><p>If you&apos;re trying to extract the pitch of a periodic wave, you can do better than the classical uncertainty principle would suggest.  The Csound Book explains this, but unfortunately my copy is on another continent so I can&apos;t check it.  A search for &quot;heterodyning&quot; might help, either on the web or in a library.</p><p>                Graham</p></div><h3><a id=14201 href="#14201">ðŸ”—</a>Herman Miller &#x3C;hmiller@IO.COM&#x3E;</h3><span>1/21/2006 9:07:20 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>monz wrote:<br/>&gt; Hi Herman,<br/>&gt; &gt; &gt; --- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Herman Miller &lt;hmiller@I...&gt; wrote:<br/>&gt; &gt; &gt;&gt;There&apos;s an inherent tradeoff between frequency resolution<br/>&gt;&gt;and time resolution with FFT, so what you&apos;re looking for<br/>&gt;&gt;might be tricky. You can get some information about the<br/>&gt;&gt;time domain by looking at the phase. In particular, you can<br/>&gt;&gt;get a better estimate of the frequency of a wave by &gt;&gt;comparing the relative phase from adjacent &quot;frames&quot;,<br/>&gt;&gt;and calculating what frequency would result in that phase<br/>&gt;&gt;difference over that length of time. Overlapping the<br/>&gt;&gt;frames is supposed to help with this. The results can<br/>&gt;&gt;also be improved by selecting an appropriate window<br/>&gt;&gt;for the FFT analysis.<br/>&gt; &gt; &gt; &gt; Thanks. I am using the idea of overlapping frames, with<br/>&gt; the averaging method i described. But i&apos;m sure that<br/>&gt; averaging is not giving me good results. It might work,<br/>&gt; if i used a small enough time difference between the<br/>&gt; overlapping frames, but that would entail too much work.<br/>&gt; &gt; Can you tell me how to do the phase calculations you<br/>&gt; describe? Can anyone else offer any help with this?</p><p>If anything, I&apos;d think that averaging the amplitudes would blur the time resolution even more than the FFT inherently does on its own. But doing the phase calculation could allow you to use a shorter FFT window and still get enough information about the frequency to be useful. This technique has been used for voice compression, and has some application to pitch shifting algorithms as well -- search for &quot;phase vocoder&quot;, &quot;pitch shifting&quot;, &quot;short time Fourier transform&quot; and similar topics and see what you can dig up. Or as Carl Lumma suggested, you could look into wavelet transforms.</p><p>I&apos;m not too familiar with the details, but basically you want to compare the phase difference you get from the analysis with the phase difference you&apos;d expect to see. Each of the &quot;bins&quot; in the FFT responds most strongly to a frequency that&apos;s an integer multiple of a fundamental frequency, related to the length of the sample (2.69 Hz in your case). So a 440 Hz sine wave would produce the highest amplitude in bins 163 and 164, with frequencies of 438.74 Hz and 441.43 Hz respectively. But say that you have a .01 second delay between samples; in .01 second, the 440 Hz wave will have advanced 4.4 cycles, so the phase difference would be 0.4 * 2pi, while a 438.74 Hz wave would be expected to have a phase difference of 0.3874 * 2pi, and a 441.43 Hz wave would result in a phase difference of 0.4143 * 2pi.</p></div><h3><a id=14204 href="#14204">ðŸ”—</a>monz &#x3C;monz@tonalsoft.com&#x3E;</h3><span>1/21/2006 1:35:40 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Herman,</p><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, Herman Miller &lt;hmiller@I...&gt; wrote:</p><p>&gt; If anything, I&apos;d think that averaging the amplitudes would<br/>&gt; blur the time resolution even more than the FFT inherently<br/>&gt; does on its own.</p><p>Yes, that&apos;s what i think too.</p><p>&gt; But doing the phase calculation could allow you to use<br/>&gt; a shorter FFT window and still get enough information about<br/>&gt; the frequency to be useful. This technique has been used<br/>&gt; for voice compression, and has some application to pitch<br/>&gt; shifting algorithms as well -- search for &quot;phase vocoder&quot;,<br/>&gt; &quot;pitch shifting&quot;, &quot;short time Fourier transform&quot; and similar<br/>&gt; topics and see what you can dig up. Or as Carl Lumma<br/>&gt; suggested, you could look into wavelet transforms.<br/>&gt;<br/>&gt; I&apos;m not too familiar with the details, but basically you<br/>&gt; want to compare the phase difference you get from the<br/>&gt; analysis with the phase difference you&apos;d expect to see.<br/>&gt; Each of the &quot;bins&quot; in the FFT responds most strongly to<br/>&gt; a frequency that&apos;s an integer multiple of a fundamental<br/>&gt; frequency, related to the length of the sample<br/>&gt; (2.69 Hz in your case).<br/>&gt;<br/>&gt; So a 440 Hz sine wave would produce the highest amplitude<br/>&gt; in bins 163 and 164, with frequencies of 438.74 Hz and<br/>&gt; 441.43 Hz respectively. But say that you have a .01 second<br/>&gt; delay between samples; in .01 second, the 440 Hz wave will<br/>&gt; have advanced 4.4 cycles, so the phase difference would<br/>&gt; be 0.4 * 2pi, while a 438.74 Hz wave would be expected to<br/>&gt; have a phase difference of 0.3874 * 2pi, and a 441.43 Hz<br/>&gt; wave would result in a phase difference of 0.4143 * 2pi.</p><p>Thanks for describing that.</p><p>The really good FFT software costs hundreds of dollars,<br/>and i can&apos;t afford to spend that right now ... the software<br/>i&apos;m using only gives frequency and time data, and says<br/>nothing about phase.</p><p>I fear that i&apos;d have to study it a lot more to really get<br/>it working, and i don&apos;t have time for that now. Maybe i&apos;ll<br/>just go back to using the direct analysis values, and use<br/>the 0.4-second frame size.</p><p>Thanks to everyone for the advice.</p><p>-monz<br/><a href="http://tonalsoft.com">http://tonalsoft.com</a><br/>Tonescape microtonal music software</p></div><h3><a id=14248 href="#14248">ðŸ”—</a>wallyesterpaulrus &#x3C;perlich@aya.yale.edu&#x3E;</h3><span>2/6/2006 10:59:35 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Monz, you&apos;ve run into the &quot;classical&quot; or &quot;mathematical&quot; uncertainty<br/>principle. There&apos;s absolutely no way around it, by the very<br/>definition of &quot;frequency&quot; and &quot;time&quot;. I provided Yahya with some<br/>links on this during my last session on the main tuning list -- I<br/>suggest you study them carefully.</p><p>--- In <a href="mailto:tuning-math@yahoogroups.com">tuning-math@yahoogroups.com</a>, &quot;monz&quot; &lt;monz@...&gt; wrote:<br/>&gt;<br/>&gt; OK, i&apos;ll just post my question here and welcome whatever<br/>&gt; answers i can get.<br/>&gt;<br/>&gt; I&apos;m doing FFT (Fast Fourier Transform) spectral analysis of<br/>&gt; sampled sounds (in the form of .wav files). My software<br/>&gt; quantizes the specified frequency range into a number of<br/>&gt; &quot;buckets&quot; (for lack of a better term) which must be<br/>&gt; powers-of-2, and it will give maximum FFT resolution of<br/>&gt; 16384 (= 2^14) &quot;buckets&quot; into which it quantizes the specified<br/>&gt; frequency range.<br/>&gt;<br/>&gt; However, in order to get the 16384 resolution, my sampled<br/>&gt; sound needs to be at least 16384 samples long. At the standard<br/>&gt; sampling rate of 44100 samples per second, that translates into<br/>&gt; a section of the .wav file which is 0.371519274 second long.<br/>&gt;<br/>&gt; The problem is: i want to be able to analyze the spectrum<br/>&gt; for much shorter periods of time, say around .01 second.</p><p>It&apos;s inherently impossible, indeed mathematically meaningless, to do<br/>so with anything like the same resolution.</p><p>&gt; So i know that to do this i have to analyze two sections of<br/>&gt; the .wav file which are .01 second apart, and find some kind<br/>&gt; of &quot;delta&quot; (change) between them.</p><p>?</p><p>&gt; I tried using a simple<br/>&gt; average (adding together the two amplitudes for each &quot;bucket&quot;<br/>&gt; and then dividing by 2), but i&apos;m sure that that&apos;s not the<br/>&gt; right way to do it.</p><p>Can you elaborate on what you did?</p><p>&gt; I can&apos;t simply analyze sections of the .wav file which are<br/>&gt; only 0.01 second long, because that&apos;s only 441 samples and<br/>&gt; therefore the maximum resolution i can get is only 256 (= 2^8)<br/>&gt; &quot;buckets&quot;, and that&apos;s nowhere near fine enough.</p></div>
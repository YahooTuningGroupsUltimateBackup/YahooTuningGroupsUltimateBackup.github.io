<a href="/tuning-math">back to list</a><h1>Adaptive tuning program - working details</h1><h3><a id=127 href="#127">ðŸ”—</a>John A. deLaubenfels &#x3C;jdl@adaptune.com&#x3E;</h3><span>6/5/2001 4:45:15 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>A list member has asked that I describe the meaning of the input<br/>parameters to my leisure tuning program.  This list member shall remain<br/>nameless, but Monz, you know who you are.</p><p>When I retune a General Midi piece, I insert some text records into the<br/>top of the file that list the input used values.  For example:</p><p>   E0 4C 3F  (For pitch  0, we have target bend  -1.2917)<br/>   E1 52 40  (For pitch  1, we have target bend   2.0139)<br/>   E2 06 41  (For pitch  2, we have target bend   3.2750)<br/>   E3 0B 3E  (For pitch  3, we have target bend  -5.9821)<br/>   E4 06 40  (For pitch  4, we have target bend   0.1546)<br/>   E5 6D 3D  (For pitch  5, we have target bend  -6.7344)<br/>   E6 24 40  (For pitch  6, we have target bend   0.8917)<br/>   E7 0B 42  (For pitch  7, we have target bend   6.5429)<br/>   E8 41 41  (For pitch  8, we have target bend   4.7193)<br/>   EA 15 3F  (For pitch  9, we have target bend  -2.6272)<br/>   EB 67 3F  (For pitch 10, we have target bend  -0.6167)<br/>   EC 02 40  (For pitch 11, we have target bend   0.0573)<br/>   jSez: DThalf        = 1000.0000<br/>   jSez: DriftHalf     = 1000.0000<br/>   jSez: Kslide        =   0.00100000<br/>   jSez: Kgood         =   0.00010000<br/>   jSez: Kdrift        =   0.00000100<br/>   jSez: KcontPainFact =  10.0000<br/>   jSez: KextraCredit  =   1.1000<br/>   jSez: DTmaxPSE      =  64.0000<br/>   jSez: Rslide        =   0.40000000<br/>   jSez: Rgood         =   0.00250000<br/>   jSez: Rdrift        =   0.00100000<br/>   jSez: SRFfact       =   0.50000000<br/>   jSez: HighNote      =   1.00000000<br/>   jSez: VolFlatn      =   0.50000000<br/>   jSez: KeyedTunable  =   1.00000000<br/>   jSez: Rmelody  =   1.00000000<br/>   jSez: Stretch  =   2.00000000<br/>   jSez: minSeven      =   0<br/>   jSez: maxSeven      =   0<br/>   jSez: jdebug        = 0000</p><p>The first set of values is the target grounding bend for each pitch<br/>class (0 == C, 1 == C#/Db, etc.) in cents relative to 12-tET.  This is<br/>closely aligned to the COFT tuning, but has been allowed to move as<br/>needed to suit the adaptive case.  Each note of each pitch class is<br/>connected by a &quot;grounding spring&quot; to the target tuning of that pitch<br/>class.  These springs counteract the tendency of the piece&apos;s tuning to<br/>drift as a result of comma pumps and other drift-inducing forces.</p><p>Next we come to input coefficients, which are quickly described as:</p><p>   1. msec for volume memory to cut in half                 (default 1000).<br/>   2. msec for drift to fall to half                        (default 1000).<br/>   3. pain coefficient for sliding a pitch&apos;s tuning         (default 0.0010000)<br/>   4. goodness coefficient for well-tuned intervals         (default 0.0001000)<br/>   5. pain coefficient for drift of center tuning           (default 0.0000010)<br/>   6. pain factor for sliding continuously sounding notes   (default 10.0000)<br/>   7. extra credit multiplier for adjacent tunings the same (default  1.1000)<br/>   8. maximum time (msec) for pseudo-simultaneous events    (default 64)<br/>   9. pain coefficient for sliding a pitch&apos;s tuning, sprng. (default 0.4000000)<br/>  10. goodness coefficient for well-tuned intervals, sprng. (default 0.0100000)<br/>  11. pain coefficient for drift of center tuning,   sprng. (default 0.0010000)<br/>  12. SRF reduction exponent (1.0 full SRF; 0.0 none)       (default 0.5000000)<br/>  13. High note extra credit (0.0 none; 1.0 double)         (default 1.0000000)<br/>  14. Volume flattening exp (1.0 no flattening; 0.0 flat)   (default 0.5000000)<br/>  15. Keyed instrument tunability (1.0 fully; 0.0 COFT)     (default 1.0000000)<br/>  16. Melodic spring coefficient                            (default 1.0000000)<br/>  17. Stretch extent                                        (default 0.0000000)</p><p>More details:</p><p>DThalf reflects the idea that we gradually forget the intonation of a<br/>particular pitch class if it has been silent a long time.  Thus it<br/>allows a pitch class&apos;s tuning to change with less calculated pain when<br/>that is the case.  This value represents the &quot;half-life&quot; of tuning<br/>memory.</p><p>DriftHalf was used in the pre-spring version of the program to work away<br/>drift that had accumulated.  It is no longer used (unless the program is<br/>instructed to skip the spring step, something I no longer ask it to do).</p><p>Kslide is a coefficient of pain for retuning a continuously sounding<br/>note; i.e., horizontal unison pain.</p><p>Kgood is a coefficient of pain for deviation from ideal in vertical<br/>tuning (notes sounding simultaneously).</p><p>Kdrift is a coefficient of pain for drift (overall tuning changes over<br/>time).</p><p>The above three refer to calculations done pre-spring.  During this<br/>phase, a tuning for each moment in time is picked, but then adjacent<br/>tunings are compared and possibly merged, when merging reduces<br/>horizontal and drift pain more than it increases vertical pain.</p><p>KcontPainFact causes greater horizontal unison pain to be calculated<br/>when a note is continuously sounding vs. when the pitch class is<br/>interrupted and then restarted.</p><p>KextraCredit gives slight extra incentive for two adjacent tuning<br/>specifications to merge, if they&apos;re almost tied in desirability.</p><p>DTmaxPSE, defaulting to 64 milliseconds, is the maximum duration of a<br/>&quot;Pseudo Simultaneous Event&quot; (PSE).  During a PSE, one or more notes may<br/>end and one or more notes may begin, but they are treated by the program<br/>as if all had happened together.</p><p>Rslide is a spring coefficient of pain for retuning a continuously<br/>sounding note; i.e., horizontal unison pain.</p><p>Rgood is a spring coefficient of pain for deviation from ideal in<br/>vertical tuning (notes sounding simultaneously).</p><p>Rdrift is a spring coefficient of pain for drift (overall tuning changes<br/>over time), i.e. for grounding springs.</p><p>SRFfact.  The Stress Reduction Factor (SRF) is a means by which<br/>horizontal unison pain calculation is reduced when many notes are<br/>sounding.  The raw SRF is raised to the power SRFfact, tending to<br/>reduce its effect.</p><p>HighNote is a means by which the highest note sounding is given<br/>greater effective volume than it otherwise would have, since the ear<br/>may bend to be more greatly attuned to the highest voice.</p><p>VolFlatn is a means by which the raw absolute volume of a voice is<br/>&quot;flattened&quot; somewhat against other voices, reflecting the tendency of<br/>the ear to hear volume in a somewhat logarithmic fashion.</p><p>KeyedTunable is the extent to which keyed voices (piano, etc.) are<br/>to be treated as tunable.  If 0.0, these voices will not be retuned.</p><p>Rmelody is a coefficient for future horizontal non-unison &quot;melody&quot;<br/>springs.  This will be a way to make melody steps somewhat more uniform.</p><p>Stretch is for tapping into a &quot;stretched piano&quot; tuning curve.</p><p>minSeven and maxSeven are for attempting to reconstruct an extended<br/>meantone set of notes, at present not well functioning.</p><p>jdebug is a flag by which a number of other on/off switches can be<br/>set:</p><p>   0x0001: debug writes<br/>   0x0002: absurdly many debug writes<br/>   0x0004: bendToP31s()<br/>   0x0008: use stdout, not a file.<br/>   0x0010: use old tch rather than new tsp for final tuning.<br/>   0x0020: special TChoiceBase::calcSeam() writes<br/>   0x0040: write absolute time into the output file<br/>   0x0080: iNoRelax of tsprings<br/>   0x0100: suppress shift of ideal ground using doCOFT()<br/>   0x0200: suppress re-spring of 12-tET intervals<br/>   0x0400: suppress adaptive re-grounding AFTER doCOFT()<br/>   0x0800: suppress capture of input pitch bends for gliss<br/>   0x1000: [not used]<br/>   (higher): [not used as of 10-31-00]</p><p>Hmmm, I see that I&apos;m not writing out the list of tuning files in use!<br/>Gotta do that!!</p><p>JdL</p></div>
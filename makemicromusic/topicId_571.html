<a href="/makemicromusic">back to list</a><h1>A benign use of a form of music, to learn to retune...</h1><h3>Jon Szanto &#x3C;JSZANTO@...&#x3E;</h3><span>8/11/2001 1:05:32 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>My friends,</p><p>Help. I need somebody.<br/>Help. Not just anybody.<br/>Help. You know I need somebody.</p><p>I need someone who really understands retuning midi files!</p><p>I&apos;m asking the list as a group, but I&apos;m also asking for people like<br/>Robert Walker, John de Laubenfels, Jacky maybe, and anyone else who<br/>has worked with midi music construction and wants to tune synths that<br/>don&apos;t store tuning tables.</p><p>The piece I&apos;ve uploaded, a segment of something called &quot;Gamelan Moon&quot;<br/>(find it in the ListMom folder), is something that I want to use as a<br/>template for &apos;laying on&apos; differing tunings to an existing piece. The<br/>recording is about 70-80% synth, and the rest acoustic. There are<br/>multiple tracks/layers of synth stuff, so maybe I would have to plan<br/>either rewrites or record in layers and combine them later in a multi-<br/>track digital recorder.</p><p>How can I take an idea, currently locked in the frozen tundra of 12-<br/>tET, and give it freedom in a new tuning?</p><p>Help. I need somebody.</p><p>{Please note that the piece was written on spec for commercial<br/>purposes, and is not intended as a reflection of my soul. I would<br/>never proffer something like this as a proxy for true gamelan music<br/>and artistry, and if anyone would want to call me out on<br/>philosophical grounds as a dilettante, they wouldn&apos;t have an argument<br/>from me. I&apos;m using this as a springboard for a texture and (future)<br/>tuning world that might evolve a similar but differing musical<br/>style...}</p><p>Longingly yours,<br/>White-man Szanto</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>11/11/2001 8:34:20 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Jon,</p><p>If you have a 12-tet midi clip already, and want<br/>to retune it to some other tuning, using any arbitrary mapping<br/>of midi clips to pitches, this is easy.</p><p>SCALA is the one to use if one wants to keep the<br/>exact timings of the midi clip. Keeps quantization<br/>so makes the midi file easy to read in sequencer, and chords may<br/>be a bit more crisp at millisecond level, if in midi file<br/>they are exactly simultaneous (may be relayed as not exactly<br/>simultaneous as notes are relayed one at a time). One may be<br/>able to hear this, especially in chord with many notes.</p><p>Only thing need to remember with SCALA is to do set/exclude 10<br/>first to exclude the non melodic percussion channel from the mapping<br/>- one can do a .cmd file with all the necessary instructions.<br/>This is the one I use:</p><p>...........................<br/>! retune.cmd<br/>! retune in.mid using retune.scl<br/>load retune.scl<br/>show<br/>set exclude 10<br/>example/midi in.mid out.mid<br/>...........................</p><p>Then use in SCALA as:<br/><a href="https://twitter.com/retune">@retune</a><br/>to retune in.mid to out.mid using the scale retune.scl</p><p>If one wants to try it out to hear what it sounds like, or play<br/>in scale yourself (which prob. won&apos;t be to the two or three milliseconds<br/>accuracy anyway) and hear what it sounds like, you can midi relay.<br/>E.g. in FTS.</p><p>On the other hand, if you want to recover a midi file from a mp3 file, this<br/>is v. challenging computationally, because the mp3 as wave recording has<br/>lost all the original midi information used to create it. Sort of like<br/>the difference between working with bitmaps, and with vector graphics.</p><p>So one can&apos;t expect too much from programs that claim to do<br/>this, at present anyway.</p><p>The computer has to recognise the instruments and disentangle them all,<br/>and this is very hard to do. It has a hard enough time finding a single<br/>line with no accompaniment.</p><p>Finding the instruments in an mp3 recording can be compared with<br/>tasks such as trying find the ingredients of an already baked cake, or find<br/>the amount of tea, milk and sugar in a cup of tea, from computer<br/>programmer&apos;s point of view.</p><p>I.e. can&apos;t be done directly, but if you know enough about the<br/>ingredients, it might be possible to do it indirectly.</p><p>We can do such a thing when listening, and hear what are the instruments<br/>playing, and the separate lines, but I&apos;m sure nobody really knows how we<br/>do it!</p><p>Computer can recognise all sorts of things in an mp3, but it<br/>doesn&apos;t have our ready familiarity with things like the sound<br/>of an oboe or flute, so that&apos;s why it can&apos;t pick those out.</p><p>Even recovering a single melodic line is somehwat like this<br/>(because of the complexity of a note, the attack, changes in<br/>timbre as it progresses, etc).</p><p>Computer is very liable to either add in extra notes, target the wrong<br/>partial, or leave some of the notes out altogether, though progress is being<br/>made in that.</p><p>I&apos;m working on options in FTS to recover a single melodic line<br/>with as much pitch accuracy as I can from a short wave recording<br/>(for seeds for fractal tunes, but could be more generally useful).</p><p>I&apos;m using FFT, and also a particular technique involving counting the waves directly.<br/>It&apos;s quite promising, especially for sine waves and birdsong,<br/>some other timbres too (recorder works pretty well if the notes aren&apos;t<br/>too short) with varying success in terms of number<br/>of &quot;extra notes&quot; it finds, or desired notes it leaves out.</p><p>I have no plans at all to try to extend that to polyphony, however,<br/>as I expect that to be several orders of magnitude harder to do.</p><p>It&apos;s not just a question of the amount of computation involved. One<br/>doesn&apos;t know exactly what to check for anyway, even with unlimited<br/>computation. Though, people have ideas, and good luck to them;<br/>hope they crack it eventually!</p><p>Robert</p></div><h3>Jonathan M. Szanto &#x3C;JSZANTO@...&#x3E;</h3><span>8/11/2001 4:43:04 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Robert,</p><p>I&apos;m sorry if I gave a wrong impression: I&apos;d *never* try to reverse-engineer a .wav or .mp3 file into a midi file. I&apos;d rather just replay/resequence it.</p><p>Your first couple of paragraphs seemed to answer my question, but I can see that the denser the polyphony, the more stress on the system (in terms of getting good output, and not making things ragged, rhythmically). Also, would I be correct in understanding that with synth timbres/patches that have a lot of sustain I would be letting myself in for audible &apos;bending&apos; of the pitches?</p><p>I won&apos;t ask too many questions before I actually get the thing running and play with it - I&apos;m sure basic experimentation will settle some of the issues.</p><p>Cheers,<br/>Jon</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>8/11/2001 10:00:55 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Jon,</p><p>&gt; I&apos;m sorry if I gave a wrong impression: I&apos;d *never* try to reverse-engineer<br/>&gt; a .wav or .mp3 file into a midi file. I&apos;d rather just replay/resequence it.</p><p>I was a little surprised; didn&apos;t think you would. But, frequently<br/>asked q. Sorry to have misunderstood too.</p><p>&gt; Your first couple of paragraphs seemed to answer my question, but I can see<br/>&gt; that the denser the polyphony, the more stress on the system (in terms of<br/>&gt; getting good output, and not making things ragged, rhythmically). Also,<br/>&gt; would I be correct in understanding that with synth timbres/patches that<br/>&gt; have a lot of sustain I would be letting myself in for audible &apos;bending&apos; of<br/>&gt; the pitches?</p><p>Thought I&apos;d better do some experiments here. Of course SCALA will be best,<br/>retuning the actual midi file. In that case, will just depend on capabilities<br/>of the synth, as it will be sent delta times of 0 for the notes of the chord.</p><p>However, how does midi relaying do in practice?</p><p>In theory Windows has 1 ms resolution for midi relaying. However in practice<br/>one usually sets the resolution to 2 ms because 1 ms puts a lot of stress<br/>on Windows. (1 ms. just possibly could cause Windows to run low on system resources<br/>and stop responding in very fast dense passages).</p><p>The actual resolution achieved can be less than that,<br/>could easily be 4 ms per note or more. However, in practice<br/>successive note ons on my system anyway seem to be often relayed<br/>simultaneously, or with very short time step of 2 ms.</p><p>In fact, with 20 or more note ons, mixed with pitch bends too,<br/>one may have, say, at most glitch of 12 ms total, or a bit over<br/>1/100th of a sec.</p><p>It&apos;s not uncommon to have 10 or 20 consecutive midi messages<br/>all relayed with 0 delta t, and if nothing else mixed with the<br/>note ons, say, 20 note ons with 4 ms glitch.</p><p>So, not as bad as one might think.</p><p>So, I think what I said about raggedness doesn&apos;t really apply much except for<br/>_very_ dense polyphony. I have had some very noticeable raggedness in the past<br/>with fractal tunes for chords with fairly large numbers of notes, but that&apos;s<br/>for first chord in the tune, and it is setting the patches and other things<br/>for each channel too, so I fixed it by changing the sequence of the messages<br/>to put all the note ons together.</p><p>As for sustain, with the midi relaying through FTS anyway, if scale requires<br/>15 or less pitches in total (as for most octave repeating scales) then<br/>as FTS uses a least recently used algorithm for the pitch bends, often<br/>only one pitch bend is applied per channel in entire piece. So it often isn&apos;t<br/>a problem.</p><p>More likely to need them if you have modulation varied as well,<br/>etc, as that is on a per channel basis as well, so one might need new channels<br/>for pitch bends _and_ new channs for varying amounts of modulation for each pitch bend.</p><p>Basically if at any particular time you have at most 15 or less pitch bends<br/>in play at once (not counting octaves, as they have same pitch bend)<br/>and all with same modulation etc., then you are okay, none of the notes<br/>get cut off.</p><p>Or, if say at most 5 pitch bends at a time, then you can have average<br/>of three combinations of modulation etc for each one.</p><p>If a new pitch bend is needed, FTS sends an all sound off before applying it.</p><p>Does this if any notes have been played in the channel at all since midi<br/>out was opened as one can&apos;t set an upper bound on how long a note (e.g. harp)<br/>might sustain after it is switched off.</p><p>Another case which takes one over the 15 channels is if you have<br/>two simultaneous note ons with the same note number and varied<br/>patch. As one can imagine, this could easily happen with full orchestral<br/>piece being midi relayed, as JdL has reported on TL with some adaptive<br/>retunings. Some soundcards / synths switch off the first note when<br/>the second is sounded.</p><p>Depends on whether your synth supports multiple note ons for same midi note<br/>number and channel (and varied patch) - obv. a midi clip has<br/>to support the least common denominator. But if it is for making an<br/>mp3, then one can go along with whatever ones synth does, and it might<br/>be perfectly okay to have sim. note ons with same note number and varied<br/>patch as this is sometimes supported.</p><p>With this in mind, I&apos;ve just added option to FTS beta preview which one can<br/>tick to allow multiple patches for same note and chann. I&apos;ll be uploading<br/>it soon; prob. tomorrow as it&apos;s not quite ready tonight.</p><p>&gt; I won&apos;t ask too many questions before I actually get the thing running and<br/>&gt; play with it - I&apos;m sure basic experimentation will settle some of the issues.</p><p>Okay fine. If you wish to experiment with FTS then the latest beta preview is the<br/>one to try for midi relaying as I gradually add more things to it. For a while<br/>it was a bit buggy as I&apos;d done a major overhaul of some things to do with the<br/>midi relaying, but is pretty okay now I think. Also means if you have a bug<br/>report or want a new option, I can fix it very easily as it is in the code<br/>I&apos;m actually working with at present.</p><p>Robert</p></div><h3>John A. deLaubenfels &#x3C;jdl@...&#x3E;</h3><span>8/13/2001 4:13:02 AM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Jon, I&apos;d be glad to give you any help I&apos;m able to.  Unfortunately, I<br/>don&apos;t have any friendly tools to offer; my software works in batch mode,<br/>without human interaction beyond launching it.</p><p>Certainly I _can_ help if you have any questions about how to translate<br/>a particular tuning into a particular pitch bend, but you probably<br/>already know how to do this (?).</p><p>Another thing I could do, if you like, is run your .mid file thru my<br/>program, just to see if it is able to reassign channels without running<br/>out.  If it works, I could (I _think_) return a file with all new<br/>channel assignments, ready for tuning, but not actually tuned by my<br/>program.</p><p>I have contemplated, but have never actually done, a splitting of a<br/>work into separate files for later recombination in the .wav world.  I<br/>do have the means for removing one or more voices from a given .mid<br/>file, in case that helps.</p><p>Please let me know if I&apos;ve understood your questions correctly and if<br/>any of this might be helpful.</p><p>JdL</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>8/14/2001 8:50:46 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Jon,</p><p>I&apos;ve realised that what I said wasn&apos;t quite right.</p><p>Problem is that the midi note off message has no provision<br/>for saying which patch you want to switch off. E.g.<br/>if you have a flute and oboe playing the same note in the<br/>same channel, there&apos;s no way to say one wants to switch off<br/>the flute rather than the oboe.</p><p>I suppose one could have a synth designed so that it<br/>switches off the note for whichever patch was applied most recently,<br/>for that note; then one could say which note to switch off by doing an extra<br/>patch before the note off. One could design other systems too.<br/>If any such system is used on an actual synth, I could program FTS accordingly.</p><p>HOwever, on listening to your gamelan piece, I think it is<br/>hardly likely to run out of channels for the pitch bends.</p><p>I enjoyed listening to it. I hear 12-tet as having<br/>something of a gamelan flavour to it anyway somehow; not sure why<br/>as gamelans aren&apos;t equal temperament. Sort of that kind of timeless<br/>gamelan quality about it somehow. Strange. I wonder if anyone<br/>else feels that? (Maybe this is more a topic for spiritual_tuning).</p><p>Anyway, your piece brings out this quality nicely. Especially like<br/>those repeating gong like descending 12-tet fifths. Might be interesting<br/>to see what happens if they are justly intonated - subtle difference<br/>but might be interesting to see if they make them too much points of<br/>rest / cadential for the overall flow of the piece - I think it might.</p><p>Also enjoyed your fallen angels piece, the excerpt. Haven&apos;t<br/>yet tried to download the complete piece.</p><p>I&apos;ve added a section to the fts preview download page, which is<br/>a draft for new help section on midi relaying with FTS.</p><p>The fts preview is up to date, and I have even added a tick box<br/>Out | Options | Mult patches for same note and chann. Could be<br/>useful when midi relaying if one knows that the only unison notes<br/>begin and end simultaneously for all the instruments playing them.</p><p><a href="http://robertinventor.tripod.com/ftsbeta.htm">http://robertinventor.tripod.com/ftsbeta.htm</a></p><p>Robert</p></div>
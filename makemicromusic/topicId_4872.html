<a href="/makemicromusic">back to list</a><h1>Midi relaying speed test</h1><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>6/19/2003 7:14:55 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi there,</p><p>I&apos;ve just been improving my midi relaying speed test in FTS (found a few<br/>bugs - mainly that if the relaying app changed the channel then it wouldn&apos;t<br/>find the note again after it got relayed around).</p><p>With a 14 note cluster, Scala averages a bit over 0.4 milliseconds for<br/>the note on and a bit under 0.3 for the note off, you&apos;ll be glad to know!</p><p>That&apos;s not much more than direct relaying from in to out which is 0.2 to 0.3 ms<br/>here for the round trip. There seems to be an overhead of about 0.1 milliseconds to send<br/>a midi note on via midi out (if I time how long the Windows function call takes),<br/>and then if it gets relayed by another app. and sent back again, that timing overhead<br/>is incurred twice, and maybe there is another fraction of a millisecond involved<br/>somewhere else in the relaying process. It seems a little over 0.25 milliseconds is<br/>about as fast as it can go. (That&apos;s just for my particular machine of course).<br/>SCALA would be sending pitch bend messages as well which probably accounts for<br/>most of the extra time for the note on.</p><p>(BTW in Windows programming you can only time things to the nearest millisecond - but<br/>if you make hundreds of identical calls and then average the times then you get<br/>accurate values for the time taken to a fraction of a millisecond)</p><p>FTS averages about 1.7 ms for the note on and about 0.7 ms<br/>for the note off. So SCALA is faster. When FTS relays directly from<br/>Midi in to Midi out it is approximately the same speed as SCALA.</p><p>So I think all the midi relaying features in FTS are slowing things<br/>down a bit. I did a timing check in FTS to find out where the<br/>delays are happening, and there is no one place<br/>that is particularly delaying it. Rather, it is a case of<br/>0.1 milliseconds or so here, another 0.1 here, and it all adds up.</p><p>I&apos;ve got a tiny retuning sequencer that I did that relays<br/>its notes using a single instrument (which simplifies the channel remapping),<br/>and that one is as fast as SCALA.</p><p>So, I need to work on this. I think 1.7 ms is large enough to<br/>be occasionally noticeable e.g. in a very fast glissando or dense chords.</p><p>I&apos;ll maybe work from the top down and see if I can make faster tests<br/>to skip the various sections that are only needed occasionally.</p><p>Or - I suppose I might work the other way and start with the code from the<br/>tiny retuning sequencer which is already as fast as it can possibly<br/>go, and add all the FTS features to it gradually, carefully checking<br/>the latency at each stage.</p><p>Anyway more later. But I think one would be hard pressed to notice<br/>anything here in a chord of say six notes (six notes = one hundredth<br/>of a second latency at 1.7 ms per note which is the same as the minimum<br/>latency setting for the FM7). With SCALA you would need a 25 note<br/>chord to get this much latency.</p><p>Anyone know what is the smallest variation in note onset that<br/>leads to perception of a chord as ragged? I suppose like<br/>most of these things it probably depends a lot on ones experiences<br/>or training.</p><p>(Of course real life music nearly always has perceptibly slightly<br/>ragged chords anyway if you listen for them - sometimes<br/>deliberately with a soloist either ahead or behind<br/>the accompaniment by a tiny fraction of a second for effect<br/>- before is incisive, after is laid back and dreamy).</p><p>Cheers,</p><p>Robert</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>6/19/2003 7:30:20 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi there,</p><p>Just another note on the test.</p><p>It uses midi relaying twice - to send the note to the<br/>midi in of the other app and to receive it back again.</p><p>Test -&gt; SCALA -&gt; Test</p><p>   0.1 ms    0.1 ms</p><p>+ 0.5 ms or so somewhere, not known yet where it happens.</p><p>If relaying from midi in it would be</p><p>Midi In -&gt; SCALA -&gt; Midi Out.</p><p>      ??        0.1 ms</p><p>where ?? is the time it takes to get<br/>from your midi keyboard to SCALA.</p><p>Thanks,</p><p>Robert</p></div><h3>Robert Walker &#x3C;robertwalker@...&#x3E;</h3><span>6/19/2003 9:21:48 PM</span><div style='margin: 0px 20px 20px; padding: 20px; background-color: #eee'><p>Hi Jeff,</p><p>Thanks!</p><p>Robert</p></div>